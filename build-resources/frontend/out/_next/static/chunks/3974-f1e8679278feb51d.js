(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3974],{19049:function(e,t,i){"use strict";var s=i(68328),n=i(89043),l=i(41224),o=i(22614),r=i(22041),a=i(11114),c=i(32451),d=i(29259),u=i(91952),h=i(58185),x=i(60609),p=i(76283),f=i(4505),m=i(12450),j=i(23583),g=i(25499),w=i(24848),v=i(30742),y=i(86405),b=i(40599),T=i(8431);t.Z=e=>{let{value:t,onChange:i,onBlur:D,error:z,subTotalAmount:B,setBillModalOpen:C,setIsPrintIsTriggered:k,setPaidAmount:G,paidAmount:P,onTop:A=!1,duePaid:N,setFieldValue:M,individualBill:S,values:R,billServiceCharge:I,accessories:F}=e,Z="true"===(0,m.useSearchParams)().get("edit"),{isDiscountFocused:E,setDiscountFocused:_}=(0,w.Z)(),V=(0,g.C)(e=>e.auth.user),Y=(0,g.C)(e=>e.auth.diagnostic),{data:L}=(0,v.A3)();(0,f.useEffect)(()=>{G(Number(t)),M("amountDue",B-Number(t))},[B,t]);let{values:O,isSubmitting:W,handleBlur:q,touched:H,errors:X,setFieldTouched:U,submitForm:$}=(0,j.u6)();console.log(O,"v1 values in billing popup");let[J,K]=(0,f.useState)(""),[Q,ee]=(0,f.useState)(!1),et=(0,f.useMemo)(()=>{let e=0;if(F)for(let{accessoryId:s,quantity:n}of F){var t,i;let l=null==L?void 0:null===(t=L.data)||void 0===t?void 0:t.find(e=>e.id===s);e+=(null!==(i=null==l?void 0:l.price)&&void 0!==i?i:0)*n}return e},[F,null==L?void 0:L.data]),ei=(O.totalAmout||0)-I-et,{discountPermissions:es,equivalentValue:en,handleDiscountTypeChange:el,handleDiscountChange:eo,handleEquivalentChange:er,isDiscountDisabled:ea,isAmountTypeDisabled:ec}=(0,y.t)({totalAmount:ei,discount:O.hospitalDiscount,discountType:O.hospitalDiscountType,setFieldValue:M,isIndoorBill:S,useStoredType:!Z}),ed=(0,f.useMemo)(()=>"amount"===O.hospitalDiscountType?"number"==typeof O.hospitalDiscount?O.hospitalDiscount:isNaN(O.hospitalDiscount)||""===O.hospitalDiscount?0:parseInt(O.hospitalDiscount):Math.ceil(ei*O.hospitalDiscount/100),[O.hospitalDiscount,O.hospitalDiscountType,ei]);(0,f.useEffect)(()=>{"number"==typeof J&&J>0?M("duePaid",J):M("duePaid",Math.max(0,B-ed-Number(t)))},[ed,B,t,J]);let eu=(0,f.useMemo)(()=>Math.floor(B-Number(t)),[B,t]),eh=async()=>{if(eu>0){let e=ed+eu;M("hospitalDiscountType","amount"),M("hospitalDiscount",e),M("duePaid",0),setTimeout(()=>{$()},100)}};return(0,s.jsx)(n.X,{shadow:"sm",radius:"md",p:"xs",withBorder:!0,className:"bg-white",children:(0,s.jsxs)(l.Stack,{gap:6,children:[(0,s.jsxs)(o.Group,{justify:"space-between",align:"center",wrap:"nowrap",children:[(0,s.jsx)(r.Text,{fw:600,size:"sm",children:"Billing"}),(0,s.jsx)(u.Z,{onClick:()=>k(!0),buttonText:"Save & Print",variant:"light",color:"blue",type:"submit",size:"xs",buttonIcon:(0,s.jsx)(h.Z,{size:14})})]}),A&&(0,s.jsx)(n.X,{withBorder:!0,p:6,radius:"sm",bg:"gray.0",children:(0,s.jsxs)(o.Group,{grow:!0,align:"flex-start",gap:"xs",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(r.Text,{size:"xs",c:"dimmed",children:"Total"}),(0,s.jsx)(r.Text,{size:"md",fw:700,children:Math.floor(B)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(r.Text,{size:"xs",c:"dimmed",children:"Paid"}),B-t<=3?(0,s.jsx)(a.C,{color:"green",variant:"light",size:"xs",children:"Full"}):(0,s.jsx)(r.Text,{size:"md",fw:600,children:t})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(r.Text,{size:"xs",c:"dimmed",children:"Discount"}),(0,s.jsx)(r.Text,{size:"md",fw:600,children:Math.floor(ed)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(r.Text,{size:"xs",c:"red",children:"Due"}),(0,s.jsx)(r.Text,{size:"md",fw:700,c:"red",children:Math.floor(B-Number(t))})]})]})}),(0,s.jsx)(c.Box,{children:(0,s.jsx)(b.y,{hospitalDiscount:O.hospitalDiscount,hospitalDiscountType:O.hospitalDiscountType,discountReference:O.discountReference,isDiscountFocused:E,setDiscountFocused:_,isDiscountDisabled:ea,isAmountTypeDisabled:ec,canEditDiscount:!(S&&(null==V?void 0:V.role)==="receptionist"&&!es.canEditDiscount),equivalentValue:en,maximumDiscountPercent:es.maximumDiscountPercent,totalAmount:ei,touched:H,errors:X,handleDiscountChange:eo,handleDiscountTypeChange:el,handleEquivalentChange:er,handleBlur:q,setFieldTouched:U,showDiscountSection:!(null==Y?void 0:Y.isTestDiscountIncludeInBill),onDiscountReferenceChange:(e,t)=>{M("discountReferrerId",e),M("discountReference",t)},showAddToDiscount:!0,initialDiscount:(null==R?void 0:R.hospitalDiscount)||0,initialDiscountType:null==R?void 0:R.hospitalDiscountType,customDiscountLogic:{onChange:(e,i)=>{let s=parseFloat(e.target.value)||0,n="amount"===R.hospitalDiscountType?R.hospitalDiscount:Math.floor(R.hospitalDiscount*B/100);s<0?M("hospitalDiscount",0):ed>B+n-Number(t)?M("hospitalDiscount",B+n-Number(t)):(i(s),M("duePaid",(O.totalAmout||0)-O.paidAmount-ed))},onBlur:(e,i)=>{let s=parseFloat(e.target.value)||0,n="amount"===R.hospitalDiscountType?R.hospitalDiscount:Math.floor(R.hospitalDiscount*B/100);s<0?(M("hospitalDiscount",0),M("duePaid",(O.totalAmout||0)-O.paidAmount-ed)):ed>B+n-Number(t)?M("hospitalDiscount",B+n-Number(t)):i(s),q(e),_(!1)}}})}),!(null==Y?void 0:Y.isTestDiscountIncludeInBill)&&eu>0&&(0,s.jsx)(d.Y,{label:"Set Due To",description:"Due: ".concat(eu),placeholder:"Amount to pay",value:J,onChange:e=>{let t="number"==typeof e?e:0;if(t<0)return;let i=t;t>eu?(i=eu,K(eu)):K(t);let s=R.totalAmout-R.totalAmountWithDiscount;if(t<=0||t>eu)return;let n=eu-i;M("hospitalDiscountType","amount"),M("hospitalDiscount",Math.floor(s+n)),M("duePaid",i)},onFocus:()=>ee(!0),onBlur:()=>ee(!1),min:0,max:eu,size:"xs"}),(0,s.jsx)(T.n,{value:t,subTotalAmount:B,isPaidAmountDisabled:!!A&&!Z||Z,duePaid:O.duePaid,showClearDue:A,showServiceCharge:!1,error:z,onChange:i,onBlur:D,setFieldValue:M,valueFormatter:e=>Math.floor(e).toString(),showAddToPaidAmount:A&&Z,initialPaidAmount:(null==R?void 0:R.paidAmount)||0}),B-t<0&&(0,s.jsx)(r.Text,{c:"red",fw:600,size:"xs",children:"Error: Paid amount cannot exceed the total amount due. Please adjust the payment."}),(0,s.jsxs)(o.Group,{justify:"flex-end",gap:4,children:[A&&eu>0&&(0,s.jsx)(u.Z,{type:"button",buttonText:"Waive (".concat(eu,")"),onClick:eh,disabled:W||"number"==typeof J&&J>0,buttonIcon:(0,s.jsx)(x.Z,{size:14}),variant:"outline",color:"red",size:"xs"}),(0,s.jsx)("div",{id:"due-bill-save-btn",children:(0,s.jsx)(u.Z,{type:"submit",buttonText:"Save",disabled:W||B-t<0,buttonIcon:(0,s.jsx)(p.Z,{size:14}),variant:"filled",color:"blue",size:"xs"})})]})]})})}},5703:function(e,t,i){"use strict";i.d(t,{V:function(){return T}});var s=i(68328),n=i(71256),l=i(7203),o=i(51762),r=i(25499),a=i(29663),c=i(63901),d=i(22614),u=i(22041),h=i(54632),x=i(29593),p=i(4505),f=i(77644),m=i(97698),j=i(15964),g=i(91952),w=i(88412),v=i(58185),y=i(8778),b=i.n(y);let T=e=>{var t,i,y,T;let{billId:D}=e,[z,B]=(0,p.useState)(null),[C,k]=(0,p.useState)(null),G=(0,r.C)(e=>e.auth.diagnostic),P=(0,p.useRef)(null),A=(0,w.useReactToPrint)({content:()=>P.current,documentTitle:"Refunded Bill Report-".concat(D)});return((0,p.useEffect)(()=>{(async()=>{try{let e=(await (0,o.y)(D)).data.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime());B(e[e.length-1])}catch(e){console.error(e)}})()},[D]),z)?(0,s.jsxs)("div",{className:"p-4",ref:P,children:[(0,s.jsx)(n.Z,{diagnostic:G}),(0,s.jsx)(j.Z,{text:"Refunded"}),(0,s.jsxs)(a.Grid,{gutter:0,my:2,align:"center",justify:"space-between",children:[(0,s.jsx)(c.GridCol,{span:5,children:(0,s.jsxs)(d.Group,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"8",viewBox:"0 0 4 4",fill:"none",children:(0,s.jsx)("circle",{cx:"2",cy:"2",r:"2",fill:"black"})}),(0,s.jsxs)(u.Text,{size:"lg",fw:600,children:["Patient ID: ",null==z?void 0:null===(t=z.patient)||void 0===t?void 0:t.patientId]})]})}),(0,s.jsx)(c.GridCol,{span:4,children:(0,s.jsx)(u.Text,{ta:"center",my:"md",size:"xl",fw:"bold",style:{textTransform:"uppercase",border:"2px solid black",display:"inline-block",margin:"auto",padding:4},children:"ফেরৎ বিভাগ"})}),(0,s.jsx)(c.GridCol,{span:3,children:(0,s.jsxs)(d.Group,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"8",viewBox:"0 0 4 4",fill:"none",children:(0,s.jsx)("circle",{cx:"2",cy:"2",r:"2",fill:"black"})}),(0,s.jsxs)(u.Text,{size:"lg",fw:600,children:["Date:"," ",(null==z?void 0:z.createdAt)?(0,m.Z)(new Date(null==z?void 0:z.createdAt),"dd-MMM-yyyy"):(0,m.Z)(new Date,"dd-MMM-yyyy")]})]})})]}),(0,s.jsxs)(a.Grid,{gutter:0,my:2,justify:"space-between",children:[(0,s.jsx)(c.GridCol,{span:5,children:(0,s.jsxs)(d.Group,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"8",viewBox:"0 0 4 4",fill:"none",children:(0,s.jsx)("circle",{cx:"2",cy:"2",r:"2",fill:"black"})}),(0,s.jsxs)(u.Text,{size:"lg",fw:600,children:["Lab ID : ",null==z?void 0:z.labId]})]})}),(0,s.jsx)(c.GridCol,{span:4,children:(0,s.jsxs)(d.Group,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"8",viewBox:"0 0 4 4",fill:"none",children:(0,s.jsx)("circle",{cx:"2",cy:"2",r:"2",fill:"black"})}),(0,s.jsxs)(u.Text,{size:"lg",fw:600,children:["Phone : ",z.phone]})]})}),(0,s.jsx)(c.GridCol,{span:3,children:(0,s.jsxs)(d.Group,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"8",viewBox:"0 0 4 4",fill:"none",children:(0,s.jsx)("circle",{cx:"2",cy:"2",r:"2",fill:"black"})}),(0,s.jsxs)(u.Text,{size:"lg",fw:600,children:["Bill Id : ",D||""]})]})}),(0,s.jsx)(c.GridCol,{span:5,children:(0,s.jsxs)(d.Group,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"8",viewBox:"0 0 4 4",fill:"none",children:(0,s.jsx)("circle",{cx:"2",cy:"2",r:"2",fill:"black"})}),(0,s.jsx)(u.Text,{tt:"capitalize",size:"lg",fw:600,children:"Name :"})," ",(0,s.jsx)(u.Text,{tt:"capitalize",size:"lg",fw:600,children:z.name})]})}),(0,s.jsx)(c.GridCol,{span:4,children:(0,s.jsxs)(d.Group,{wrap:"nowrap",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"8",viewBox:"0 0 4 4",fill:"none",children:(0,s.jsx)("circle",{cx:"2",cy:"2",r:"2",fill:"black"})})," ",(0,s.jsx)(u.Text,{size:"lg",fw:600,children:"Age :"}),(0,s.jsxs)(u.Text,{className:"text-break",size:"lg",fw:600,children:[z.ageYear?z.ageYear+" Y":""," ",z.ageMonth?z.ageMonth+" M":""," ",z.ageDay?z.ageDay+" D":""]})]})}),(0,s.jsxs)(c.GridCol,{span:3,children:[" ",(0,s.jsxs)(d.Group,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"8",viewBox:"0 0 4 4",fill:"none",children:(0,s.jsx)("circle",{cx:"2",cy:"2",r:"2",fill:"black"})})," ",(0,s.jsx)(u.Text,{size:"lg",fw:600,children:"Gender :"}),(0,s.jsx)(u.Text,{tt:"capitalize",size:"lg",fw:600,children:z.gender})]})]})]}),(0,s.jsxs)("div",{className:b().referenceBy,children:[(0,s.jsx)("div",{children:(0,s.jsxs)(d.Group,{wrap:"nowrap",className:"d-flex ",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:"8",viewBox:"0 0 4 4",fill:"none",children:(0,s.jsx)("circle",{cx:"2",cy:"2",r:"2",fill:"black"})}),(0,s.jsx)(u.Text,{size:"lg",fw:600,children:"Referred by :"})]})}),(0,s.jsx)("div",{children:(0,s.jsx)(u.Text,{size:"lg",fw:600,children:["doctor","pc"].includes(z.referenceBy)?(0,s.jsxs)(s.Fragment,{children:[null===(i=z.doctor)||void 0===i?void 0:i.name,",",null===(y=z.doctor)||void 0===y?void 0:y.designation]}):z.referenceBy})})]}),(0,s.jsxs)(h.i,{className:b().table,highlightOnHover:!0,withRowBorders:!0,children:[(0,s.jsxs)(h.i.Thead,{children:[(0,s.jsx)(h.i.Th,{children:"Test Name"}),(0,s.jsx)(h.i.Th,{children:"Room"}),(0,s.jsx)(h.i.Th,{children:"Price"}),(0,s.jsx)(h.i.Th,{children:"Status"})]}),(0,s.jsx)(h.i.Tbody,{children:null==z?void 0:null===(T=z.tests)||void 0===T?void 0:T.map((e,t)=>100===e.discount?(0,s.jsxs)(h.i.Tr,{children:[(0,s.jsx)(h.i.Td,{children:e.name}),(0,s.jsx)(h.i.Td,{children:e.roomNo}),(0,s.jsx)(h.i.Td,{children:(0,s.jsx)(f.Z,{test:{...e,discount:0}})}),(0,s.jsx)(h.i.Td,{children:"Refunded"})]},t):(0,s.jsx)(s.Fragment,{}))})]}),(0,s.jsx)(x.Space,{h:20}),(0,s.jsxs)(u.Text,{fw:600,size:"xl",children:["Total Refunded Amount : ",null==z?void 0:z.refundedAmount]}),(0,s.jsx)(d.Group,{justify:"end",children:(0,s.jsx)(g.Z,{onClick:()=>A(),buttonText:"Print",variant:"filled",buttonIcon:(0,s.jsx)(v.Z,{size:20})})})]}):(0,s.jsx)(l.Z,{})}},71256:function(e,t,i){"use strict";var s=i(68328),n=i(22614),l=i(22041),o=i(77303),r=i(62471);t.Z=e=>{let{diagnostic:t,email:i,children:a,color:c,patientId:d,small:u,large:h,isBigLogo:x,idLabel:p,idBorder:f,labId:m}=e,j=(0,r._)({key:"print-show-division-name",defaultValue:"true"});return(0,s.jsxs)("div",{className:"diagnostic-info1",children:[(0,s.jsx)(n.Group,{children:x&&(0,s.jsx)("img",{style:{aspectRatio:"auto",width:"100%",height:"100px"},src:"/images/heathcare.png",alt:"Diagnotic Image"})}),(0,s.jsxs)(n.Group,{wrap:"nowrap",justify:x?"center":"space-between",children:[(0,s.jsxs)(n.Group,{wrap:"nowrap",bg:"white",py:1,mb:1,align:"center",children:[null!=x?x:(0,s.jsx)("img",{width:u?50:100,height:u?50:100,style:{objectFit:"cover"},src:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.hostname.includes("local")?null==t?void 0:t.offlineLogo:null==t?void 0:t.logo,alt:"Diagnotic Image"}),(0,s.jsx)(n.Group,{wrap:"nowrap",children:(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Text,{styles:{root:{fontSize:"".concat(h?32:u?14:24)}},size:"xl",style:{fontSize:h?16:void 0},fw:700,children:null==t?void 0:t.name}),(0,s.jsxs)(l.Text,{fw:500,my:1,styles:{root:{wordBreak:"break-word",fontSize:h?12:void 0}},children:["Address: ",null==t?void 0:t.address,"true"===j&&(null==t?void 0:t.division)?";".concat(null==t?void 0:t.division):""]}),(0,s.jsxs)(n.Group,{children:[(0,s.jsxs)(l.Text,{my:1,fw:500,styles:{root:{wordBreak:"break-word",fontSize:h?12:void 0}},children:["Phone: ",null==t?void 0:t.phone1," , ",null==t?void 0:t.phone2]}),i?(0,s.jsxs)(l.Text,{my:1,fw:500,styles:{root:{wordBreak:"break-word",fontSize:h?16:void 0}},children:["; Email : ",i]}):(0,s.jsx)(s.Fragment,{})]})]})})]}),m&&(0,s.jsxs)(l.Text,{fw:700,mt:"auto",mb:9,style:{border:f?"2px solid #555":"none",padding:f?"4px":"0px",borderRadius:f?"2px":"0px"},styles:{root:{fontSize:"calc(var(--mantine-scale) * ".concat(h?16:u?12:14,")")}},children:["Lab\xa0ID:\xa0",m]}),d&&(0,s.jsxs)(l.Text,{fw:700,mt:"auto",mb:9,style:{border:f?"2px solid #555":"none",padding:f?"4px":"0px",borderRadius:f?"2px":"0px"},styles:{root:{fontSize:"calc(var(--mantine-scale) * ".concat(h?16:u?12:14,")")}},children:["Patient\xa0ID:\xa0",d]}),a]}),(0,s.jsx)(o.Divider,{size:"sm",color:c||"black",style:{marginBottom:"2px"}})]})}},10713:function(e,t,i){"use strict";i.d(t,{E:function(){return h}});var s=i(68328),n=i(30331),l=i(30293),o=i(55911),r=i(87513),a=i(58689),c=i(73626),d=i(23583),u=i(4505);let h={size:"md",variant:"default",radius:"md"},x=(0,l.F)((0,u.forwardRef)(function(e,t){let{labelText:i,labelTextColor:l,size:x=h.size,variant:p=h.variant,radius:f=h.radius,mt:m="md",withAsterisk:j=!1,onChange:g,onBlur:w,onClick:v,readonly:y,styles:b,value:T,...D}=e,z=Object.assign({label:{color:null!=l?l:"black"}},b),[{value:B,onChange:C,onBlur:k,...G},P,A]=(0,d.U$)(D.name),N=(0,u.useRef)(null),M=(0,a.Yx)(t,N),S=(0,c.y)(()=>{if(N.current){let e;let{type:t,value:i}=N.current;A.setValue("number"===t?isNaN(e=parseFloat(i))?"":e:i)}},200);return(0,u.useEffect)(()=>{N.current&&N.current.value!==B&&!(document.hasFocus()&&document.activeElement===N.current)&&(N.current.value=null!=B?B:"")},[B]),(0,s.jsx)(o.TextInput,{label:i,readOnly:y,ref:M,error:P.touched&&P.error,styles:z,defaultValue:B,onChange:e=>{S()},onBlur:e=>{null==w||w(e),k(e)},onClick:e=>{"number"===D.type&&"0"===e.currentTarget.value&&e.currentTarget.select(),null==v||v(e)},onWheel:n.P,rightSectionPointerEvents:"all",rightSection:(0,s.jsx)(r.P,{"aria-label":"Clear input",onClick:()=>{A.setValue(""),N.current&&(N.current.value="")},style:{display:B?void 0:"none"}}),...G,size:x,variant:p,radius:f,mt:m,withAsterisk:j,...D})}));t.Z=x},51762:function(e,t,i){"use strict";i.d(t,{y:function(){return o}});var s=i(72940),n=i(6780),l=i(67732);let o=async e=>{try{let t=(await n.default.get("".concat("http://sasthotech.local:5000/api/v1","/bill/").concat(e),s.FD)).data.data;for(let e=0;e<t.length;++e){let i=t[e].tests;for(let e=0;e<i.length;++e)"undefined"===i[e].roomNo&&(i[e].roomNo="")}return{success:!0,data:t}}catch(e){if(e instanceof l.d7){var t;return{success:!1,data:null===(t=e.response)||void 0===t?void 0:t.data.message}}return{success:!1,data:"An error occurred"}}}},13394:function(e,t,i){"use strict";i.d(t,{N:function(){return o}});var s=i(72940),n=i(6780),l=i(67732);let o=async(e,t)=>{try{let i=await n.default.patch("".concat("http://sasthotech.local:5000/api/v1","/bill/").concat(t),e,{...s.FD,...s.Hn});return{success:!0,data:i.data.data}}catch(e){if(e instanceof l.d7){var i;return{success:!1,data:null===(i=e.response)||void 0===i?void 0:i.data.message}}return{success:!1,data:"An error occurred"}}}},30331:function(e,t,i){"use strict";function s(e){e.currentTarget.blur(),e.stopPropagation(),setTimeout(()=>{var t;null==e||null===(t=e.currentTarget)||void 0===t||t.focus()},0)}i.d(t,{P:function(){return s}})},8778:function(e){e.exports={referenceBy:"RefundedBillModal_referenceBy__YGjjw",table:"RefundedBillModal_table__Rtb_M"}}}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6727],{77644:function(e,t,n){"use strict";var r=n(68328);n(4505),t.Z=e=>{let{test:t}=e;return(0,r.jsx)("div",{children:(t.price-("amount"===t.discountType?t.discount:t.price*t.discount/100)).toFixed(2)})}},66951:function(e,t,n){"use strict";n.d(t,{r:function(){return u}});var r=n(68328),a=n(39215),i=n(14587),o=n(4505),l=n(27191);let u=e=>{let{value:t,onChange:n,onBlur:u,show:s,label:c,placeholder:d,hideLabel:m}=e,{data:p=[],isLoading:v}=(0,l.v6)(void 0,{skip:!s}),[f,{isLoading:h}]=(0,l.a9)(),[g,x]=(0,o.useState)(""),y=(0,o.useRef)(!1),D=(0,o.useRef)(void 0);(0,o.useEffect)(()=>{(D.current!==t||!y.current)&&(D.current=t,y.current=!0,t?"string"==typeof t?x(t):t&&"object"==typeof t&&"name"in t&&x(t.name):x(""))},[t]);let b=(0,o.useMemo)(()=>g?p.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())):p,[g,p]),A=async e=>{let t=((null==g?void 0:g.trim())||"").replace(/\s*\(New\)\s*$/i,"").trim();if(!t){n("",""),u(e);return}let r=p.find(e=>e.name.toLowerCase()===t.toLowerCase());if(r)n(r.id,r.name);else try{let e=await f({name:t}).unwrap();n(e.id,e.name)}catch(e){console.error("Error creating discount referrer:",e),n("",t)}u(e)},S=(0,o.useMemo)(()=>{let e=b.map(e=>e.name);if(g&&!e.some(e=>e.toLowerCase()===g.toLowerCase())){let t="".concat(g," (New)");if(!e.some(e=>e===t))return[...e,t]}return e},[b,g]);return s?(0,r.jsx)(a.F,{label:m?void 0:c||"Reference",placeholder:d||"Reference",value:g,onChange:e=>{x(e)},onBlur:A,data:S,limit:10,w:"100%",my:"5",selectFirstOptionOnChange:!0,maxDropdownHeight:200,rightSection:v||h?(0,r.jsx)(i.Loader,{size:"xs"}):null,filter:e=>{let{options:t}=e;return t},styles:{label:{marginBottom:0,fontWeight:600,fontSize:"var(--mantine-font-size-sm)"}}}):null}},40599:function(e,t,n){"use strict";n.d(t,{y:function(){return h}});var r=n(68328),a=n(55911),i=n(87967),o=n(29259),l=n(22041),u=n(49238),s=n(4505),c=n(70818),d=n(42062),m=n(10713),p=n(94787),v=n.n(p),f=n(66951);let h=e=>{let{hospitalDiscount:t,hospitalDiscountType:n,discountReference:p,isDiscountFocused:h,setDiscountFocused:g,isDiscountDisabled:x,isAmountTypeDisabled:y,canEditDiscount:D,equivalentValue:b,maximumDiscountPercent:A,totalAmount:S,touched:j,errors:C,handleDiscountChange:R,handleDiscountTypeChange:_,handleEquivalentChange:T,handleBlur:w,setFieldTouched:B,showDiscountSection:I,onDiscountReferenceChange:E,customDiscountLogic:N,showAddToDiscount:F=!1,initialDiscount:M=0,initialDiscountType:P}=e,[k,L]=(0,s.useState)(0),[G,z]=(0,s.useState)(!1),[q,Q]=(0,s.useState)(F?M:t),[Z,O]=(0,s.useState)(n);if((0,s.useEffect)(()=>{F||Q(t)},[t,F]),(0,s.useEffect)(()=>{F&&n!==Z&&(L(0),Q(t),O(n))},[n,F,t,Z]),!I)return null;let H=e=>{let t=parseFloat(e.target.value)||0,r=t;null!==A&&(r="percentage"===n?Math.min(t,A):Math.min(t,S*A/100)),R(Math.max(0,r))},W=e=>{let t=parseFloat(e.target.value)||0,r=t;null!==A&&(r="percentage"===n?Math.min(t,A):Math.min(t,S*A/100)),R(Math.max(0,r)),w(e),g(!1)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(c.default,{className:v().discount,style:{gap:"4px",marginBottom:"4px"},children:[(0,r.jsx)(d.default,{children:(0,r.jsx)(m.Z,{labelText:"Discount",placeholder:"Discount",value:0===t&&h?"":null==t?void 0:t.toString(),disabled:x||!D,onChange:e=>{Q(Number(e.target.value)||0),(null==N?void 0:N.onChange)?N.onChange(e,R):H(e)},onBlur:e=>{(null==N?void 0:N.onBlur)?N.onBlur(e,R):W(e)},type:"number",name:"hospitalDiscount",mt:"",error:j.hospitalDiscount&&C.hospitalDiscount?"".concat(C.hospitalDiscount):void 0})}),F&&(0,r.jsx)(d.default,{children:(0,r.jsx)(a.TextInput,{label:"Add to Discount",placeholder:"Amount",size:"xs",variant:"default",radius:"md",mt:5,value:0===k&&G?"":k.toString(),onChange:e=>{let t=e.target.value;if(""===t||"-"===t){L(t),Q(M),R(M);return}let n=parseFloat(t);if(!isNaN(n)){L(t);let e=M+n;Q(e),R(e)}},onBlur:e=>{if(z(!1),""===k||"-"===k)L(0),Q(M),R(M);else if("string"==typeof k){let e=parseFloat(k);if(!isNaN(e)){L(e);let t=M+e;Q(t),R(t)}}},onFocus:()=>{z(!0)},type:"text",inputMode:"numeric"})}),(0,r.jsx)(d.default,{children:(0,r.jsx)(i.P,{label:" ",description:" ",size:"xs",rightSection:(0,r.jsx)(u.Z,{size:14}),variant:"default",radius:"md",mt:5,disabled:y||!D,placeholder:"Type",value:n,onChange:e=>{e&&_(e)},onBlur:()=>B("hospitalDiscountType",!0),type:"text",name:"hospitalDiscountType",defaultValue:"Percentage",data:[{value:"percentage",label:"%"},{value:"amount",label:"৳",disabled:y}]})}),(0,r.jsx)(d.default,{children:(0,r.jsx)(o.Y,{description:" ",value:"amount"===n?b.toFixed(2):Math.round(b),onChange:e=>{T(Math.max(0,Math.min("number"==typeof e?e:parseFloat(e)||0,"percentage"===n?null!==A?S*A/100:S:null!=A?A:100)))},size:"xs",variant:"default",rightSection:(0,r.jsx)(r.Fragment,{}),radius:"md",mt:5,min:0,max:"percentage"===n?null!==A?S*A/100:S:null!=A?A:100,clampBehavior:"strict",label:"percentage"===n?"৳":"%"})})]}),null!==A&&(0,r.jsxs)(l.Text,{size:"xs",c:"dimmed",style:{marginTop:"2px"},children:["Max: ",A,"%"]}),(0,r.jsx)(f.r,{value:p,onChange:E,onBlur:w,show:!0})]})}},8431:function(e,t,n){"use strict";n.d(t,{n:function(){return s}});var r=n(68328),a=n(22614),i=n(55911),o=n(72375),l=n(4505),u=n(10713);let s=e=>{let{value:t,subTotalAmount:n,isPaidAmountDisabled:s,duePaid:c,showClearDue:d,showServiceCharge:m,isServiceChargeIncluded:p,error:v,onChange:f,onBlur:h,setFieldValue:g,valueFormatter:x,showAddToPaidAmount:y=!1,initialPaidAmount:D=0}=e,[b,A]=(0,l.useState)(!1),[S,j]=(0,l.useState)(!1),[C,R]=(0,l.useState)(0),[_,T]=(0,l.useState)(!1),[w,B]=(0,l.useState)(y?D:t),I=x||(e=>Math.floor(e).toString());return(0,l.useEffect)(()=>{y||B(t)},[t,y]),(0,r.jsxs)(a.Group,{align:"flex-end",wrap:"nowrap",gap:"xs",style:{width:"100%"},children:[(0,r.jsx)(u.Z,{labelText:"Paid",disabled:s,placeholder:"Amount",value:0===w&&b?"":Number(w).toString(),onChange:e=>{B(Number(e.target.value)||0),f(e),g("paidAmount",e.target.value)},onBlur:e=>{A(!1),h(e)},onFocus:()=>{A(!0)},type:"number",name:"paidAmount",error:v}),y&&(0,r.jsx)(i.TextInput,{label:"Add to Paid",placeholder:"Amount",size:"md",variant:"filled",radius:"md",mt:"md",styles:{label:{color:"green"}},value:0===C&&_?"":C.toString(),onChange:e=>{let t=e.target.value;if(""===t||"-"===t){R(t),B(D),g("paidAmount",D);return}let n=parseFloat(t);if(!isNaN(n)){R(t);let e=D+Math.floor(n);B(e),g("paidAmount",e)}},onBlur:e=>{if(T(!1),""===C||"-"===C)R(0),B(D),g("paidAmount",D);else if("string"==typeof C){let e=parseFloat(C);if(!isNaN(e)){let t=Math.floor(e);R(t);let n=D+t;B(n),g("paidAmount",n)}}},onFocus:()=>{T(!0)},type:"text",inputMode:"numeric"}),(0,r.jsx)(u.Z,{labelText:"Due",labelTextColor:"red",placeholder:"Amount",value:I(n-Number(w)),onChange:f,onBlur:h,type:"number",name:"amountDue",disabled:!0,error:v}),d&&void 0!==c&&(0,r.jsx)(u.Z,{labelText:"Clear Due",labelTextColor:"",placeholder:"Amount",value:I(c),onChange:f,onBlur:e=>{h(e),j(!1)},onFocus:()=>{j(!0)},type:"number",name:"duePaid",error:v}),m&&(0,r.jsx)(o.X,{checked:p,name:"isServiceChargeIncluded",onChange:e=>g("isServiceChargeIncluded",e.currentTarget.checked),label:"Service Charge",size:"xs"})]})}},7203:function(e,t,n){"use strict";var r=n(68328),a=n(14587);n(4505),t.Z=()=>(0,r.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:600},children:(0,r.jsx)(a.Loader,{color:"teal",variant:"dots"})})},15964:function(e,t,n){"use strict";var r=n(68328),a=n(88994),i=n.n(a);t.Z=e=>{let{text:t}=e;return(0,r.jsx)(r.Fragment,{children:t&&(0,r.jsx)("div",{className:i().watermark,children:t})})}},91952:function(e,t,n){"use strict";var r=n(68328),a=n(31204),i=n(13520);n(4505),t.Z=e=>{let{buttonText:t,buttonIcon:n,isButtonTextRightSide:o=!0,onClick:l,routeLink:u,size:s="md",radius:c="md",variant:d="filled",type:m="button",btnBg:p="",color:v,disabled:f}=e;return u?(0,r.jsx)(a.Button,{bg:p,type:m,size:s,radius:c,component:i.default,disabled:f,href:u,onClick:l,variant:d,color:v,children:(0,r.jsxs)("div",{className:"d-flex ".concat(o?"":"flex-row-reverse"," gap-2 align-items-center"),children:[(0,r.jsx)("span",{children:n}),(0,r.jsx)("span",{children:t})]})}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(a.Button,{bg:p,type:m,size:s,radius:c,href:u,onClick:l,variant:d,color:v,disabled:f,children:(0,r.jsxs)("div",{className:"d-flex ".concat(o?"":"flex-row-reverse"," gap-2 align-items-center"),children:[(0,r.jsx)("span",{children:n}),(0,r.jsx)("span",{children:t})]})})})}},86405:function(e,t,n){"use strict";n.d(t,{t:function(){return l}});var r=n(4505),a=n(25499);let i=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,a.C)(e=>e.auth.user),n=(0,a.C)(e=>e.auth.diagnostic);return(0,r.useMemo)(()=>{var r,a,i,o,l,u,s,c,d;if((null==t?void 0:t.role)!=="receptionist")return{canEditDiscount:null!==(r=null==n?void 0:n.isEditDiscount)&&void 0!==r&&r,canGiveDiscount:!0,canGiveDiscountInAmount:!0,maximumDiscountPercent:null};let m=t.permissions;return e?{canEditDiscount:null!==(a=null==n?void 0:n.isEditDiscount)&&void 0!==a&&a,canGiveDiscount:null===(i=null==m?void 0:m.canGiveIndoorDiscount)||void 0===i||i,canGiveDiscountInAmount:null===(o=null==m?void 0:m.canGiveIndoorDiscountInAmount)||void 0===o||o,maximumDiscountPercent:null!==(l=null==m?void 0:m.maximumIndoorDiscountPercent)&&void 0!==l?l:null}:{canEditDiscount:null!==(u=null==n?void 0:n.isEditDiscount)&&void 0!==u&&u,canGiveDiscount:null===(s=null==m?void 0:m.canGiveOutdoorDiscount)||void 0===s||s,canGiveDiscountInAmount:null===(c=null==m?void 0:m.canGiveOutdoorDiscountInAmount)||void 0===c||c,maximumDiscountPercent:null!==(d=null==m?void 0:m.maximumOutdoorDiscountPercent)&&void 0!==d?d:null}},[t,n,e])},o="preferredDiscountType",l=e=>{let{totalAmount:t,discount:n,discountType:a,setFieldValue:l,isIndoorBill:u=!1,useStoredType:s=!0}=e,c=i(u),[d,m]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(!s)return;let e=localStorage.getItem(o);if(e&&("percentage"===e||"amount"===e)){if("amount"===e&&!c.canGiveDiscountInAmount)return;a!==e&&l("hospitalDiscountType",e)}},[s]),(0,r.useEffect)(()=>{console.log("Recalculating equivalent value",t),"percentage"===a?m(t*n/100):m(n/t*100)},[n,a,t]);let p=(0,r.useCallback)((e,n)=>{if(e<0)return 0;let r=c.maximumDiscountPercent;return null===r?e:"percentage"===n?Math.min(e,r):e/t*100>r?t*r/100:e},[c.maximumDiscountPercent,t]),v=(0,r.useCallback)(e=>{if("amount"!==e||c.canGiveDiscountInAmount){localStorage.setItem(o,e),l("hospitalDiscountType",e);l("hospitalDiscount",p("amount"===e?t*n/100:n/t*100,e))}},[n,c.canGiveDiscountInAmount,l,t,p]),f=(0,r.useCallback)(e=>{l("hospitalDiscount",p(e,a))},[a,l,p]),h=(0,r.useCallback)(e=>{l("hospitalDiscount",p("amount"===a?e*t/100:e/t*100,a))},[a,l,t,p]),g=!c.canGiveDiscount,x=!c.canGiveDiscountInAmount;return{discountPermissions:c,equivalentValue:d,handleDiscountTypeChange:v,handleDiscountChange:f,handleEquivalentChange:h,isDiscountDisabled:g,isAmountTypeDisabled:x}}},24848:function(e,t,n){"use strict";var r=n(4505);t.Z=()=>{let[e,t]=(0,r.useState)(!1),[n,a]=(0,r.useState)(!1),[i,o]=(0,r.useState)(!1),[l,u]=(0,r.useState)(!1);return{isDayFocused:n,isDiscountFocused:l,isMonthFocused:i,isYearFocused:e,setDayFocused:a,setDiscountFocused:u,setMonthFocused:o,setYearFocused:t}}},30742:function(e,t,n){"use strict";n.d(t,{A3:function(){return o},_3:function(){return s},mS:function(){return u},xQ:function(){return l}});var r=n(78101),a=n(40085);let i=r.g.injectEndpoints({endpoints:e=>({getAccessories:e.query({query:()=>({url:"/admin/accessory"}),keepUnusedDataFor:86400,transformResponse(e){try{var t;if(!Array.isArray(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.items))throw Error("ERR_PARSE");return e.data.items.sort((e,t)=>e.name.localeCompare(t.name)),e.data=e.data.items,e}catch(e){return console.error(e),[]}}}),createAccessory:e.mutation({query:e=>({url:"/admin/accessory",method:"POST",body:e}),async onQueryStarted(e,t){let{dispatch:n,queryFulfilled:r}=t,o=(0,a.x0)(),l=n(i.util.updateQueryData("getAccessories",void 0,t=>{t.data.push({id:o,...e,loading:!0})}));try{let{data:e}=await r;n(i.util.updateQueryData("getAccessories",void 0,t=>{let n=t.data.findIndex(e=>e.id===o);n>=0&&(t.data[n]=e.data)}))}catch(e){l.undo()}}}),updateAccessory:e.mutation({query:e=>{let{id:t,name:n,price:r}=e;return{url:"/admin/accessory/".concat(t),method:"PATCH",body:{name:n,price:r}}},async onQueryStarted(e,t){let{id:n,name:r,price:a}=e,{dispatch:o,queryFulfilled:l}=t,u=o(i.util.updateQueryData("getAccessories",void 0,e=>{let t=e.data.find(e=>e.id===n);t&&(void 0!==r&&(t.name=r),void 0!==a&&(t.price=a),t.loading=!0)}));try{await l,o(i.util.updateQueryData("getAccessories",void 0,e=>{let t=e.data.find(e=>e.id===n);t&&delete t.loading}))}catch(e){u.undo()}}}),deleteAccessory:e.mutation({query:e=>({url:"/admin/accessory/".concat(e),method:"DELETE"}),async onQueryStarted(e,t){let{dispatch:n,queryFulfilled:r}=t,a=n(i.util.updateQueryData("getAccessories",void 0,t=>{let n=t.data.find(t=>t.id===e);n&&(n.loading=!0)}));try{await r,n(i.util.updateQueryData("getAccessories",void 0,t=>{let n=t.data.findIndex(t=>t.id===e);n>=0&&t.data.splice(n,1)}))}catch(e){a.undo()}}}),getSingleAccessory:e.query({query:e=>({url:"/admin/accessory/".concat(e)})})})}),{useGetAccessoriesQuery:o,useCreateAccessoryMutation:l,useUpdateAccessoryMutation:u,useDeleteAccessoryMutation:s,useGetSingleAccessoryQuery:c}=i},27191:function(e,t,n){"use strict";n.d(t,{a9:function(){return u},v6:function(){return o},z3:function(){return i}});var r=n(68240),a=n(94183);let i=(0,r.LC)({reducerPath:"discountReferrerSlice",baseQuery:(0,a.ni)({baseUrl:"http://sasthotech.local:5000/api/v1",credentials:"include",prepareHeaders:e=>{let t=localStorage.getItem("token");return t&&e.set("authorization","Bearer ".concat(t)),e}}),tagTypes:["DiscountReferrer"],endpoints:e=>({getDiscountReferrers:e.query({query:()=>"/discountReferrer",transformResponse:e=>e.data,providesTags:["DiscountReferrer"]}),getDiscountReferrer:e.query({query:e=>"/discountReferrer/".concat(e),transformResponse:e=>e.data,providesTags:(e,t,n)=>[{type:"DiscountReferrer",id:n}]}),createDiscountReferrer:e.mutation({query:e=>({url:"/discountReferrer",method:"POST",body:e}),transformResponse:e=>e.data,invalidatesTags:["DiscountReferrer"]}),updateDiscountReferrer:e.mutation({query:e=>{let{id:t,data:n}=e;return{url:"/discountReferrer/".concat(t),method:"PATCH",body:n}},transformResponse:e=>e.data,invalidatesTags:(e,t,n)=>{let{id:r}=n;return[{type:"DiscountReferrer",id:r},"DiscountReferrer"]}}),deleteDiscountReferrer:e.mutation({query:e=>({url:"/discountReferrer/".concat(e),method:"DELETE"}),invalidatesTags:["DiscountReferrer"]})})}),{useGetDiscountReferrersQuery:o,useGetDiscountReferrerQuery:l,useCreateDiscountReferrerMutation:u,useUpdateDiscountReferrerMutation:s,useDeleteDiscountReferrerMutation:c}=i},28404:function(e,t,n){"use strict";n.d(t,{j:function(){return r}});let r=e=>{var t,n,r,a,i,o,l,u,s,c;let{bill:d,username:m,totals:p,selectedDoctorInfo:v,selectedTestInfo:f}=e,h=null!==(a=null!==(r=null==d?void 0:d.totalAmountWithDiscount)&&void 0!==r?r:null==p?void 0:p.subTotal)&&void 0!==a?a:0,g="number"==typeof(null==p?void 0:p.discount)?p.discount:(null==d?void 0:d.totalAmout)&&(null==d?void 0:d.totalAmountWithDiscount)?d.totalAmout-d.totalAmountWithDiscount:0,x=(null!==(o=null!==(i=null==d?void 0:d.tests)&&void 0!==i?i:f)&&void 0!==o?o:[]).map(e=>(e.template="",e));return{billId:null!==(l=null==d?void 0:d.billId)&&void 0!==l?l:null,labId:(null==d?void 0:null===(t=d.labId)||void 0===t?void 0:t.toString())||"",discount:g,formValues:{...d,patient:null==d?void 0:d.patient},doctorInfo:null!==(s=null!==(u=null==d?void 0:d.doctor)&&void 0!==u?u:v)&&void 0!==s?s:null,testInfo:x,subTotal:h,username:m,discountReferer:null!==(c=null==d?void 0:null===(n=d.discountReferrer)||void 0===n?void 0:n.name)&&void 0!==c?c:null==d?void 0:d.discountReference}}},94787:function(e){e.exports={container:"Billing_container__S4RRE",colStyle:"Billing_colStyle__wUl_6",cursorPointer:"Billing_cursorPointer__zMLsp",due:"Billing_due__BLzj4",paid:"Billing_paid__ruB8V",discount:"Billing_discount__nRGLv",input:"Billing_input__n5JHl",placeholder:"Billing_placeholder__FCBNX",wrapper:"Billing_wrapper__LYRU9"}},88994:function(e){e.exports={watermark:"Watermark_watermark__L2_N7"}}}]);
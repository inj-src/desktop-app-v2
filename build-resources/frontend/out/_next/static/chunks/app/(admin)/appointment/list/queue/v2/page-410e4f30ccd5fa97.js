(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2681],{83489:function(e,t,n){Promise.resolve().then(n.bind(n,87562))},5171:function(e,t,n){"use strict";n.d(t,{$:function(){return u}});var i=n(68328),s=n(32451),o=n(31204),r=n(31662),l=n(24811),a=n(4505),d=n(77410);function u(){var e;let[t,n]=(0,a.useState)(!1),u=(0,d.L)();return(0,i.jsxs)(s.Box,{children:[(0,i.jsx)(o.Button,{variant:"outline",color:"orange",size:"xs",rightSection:(0,i.jsx)(r.Z,{size:14}),onClick:()=>n(!0),children:"Notice"}),(0,i.jsx)(l.P,{opened:t,onClose:()=>n(!1),doctorSessionId:(null===(e=u.data.session)||void 0===e?void 0:e.id)||""})]})}},93978:function(e,t,n){"use strict";n.d(t,{Z:function(){return M}});var i=n(68328),s=n(31204),o=n(22975),r=n(22614),l=n(46557),a=n(79894),d=n(73427),u=n(90660),c=n.n(u),p=n(36409),m=n(48604),h=n(41224),x=n(58812),v=n(68242),f=n(22041),g=n(11114),j=n(4505),b=n(77230),C=n(38156),S=n(31662),y=n(93636),I=n(14587),w=n(16391),T=n(77410),z=n(17443),N=n(99238),k=n(24590),P=n(26543),E=n(91622),D=n(21864),q=n(24811),A=n(74114);function O(){var e,t,n,s,o;let{data:r}=(0,T.L)(),{toggle:l}=(0,a.O)(),d=(0,E.N)({sessionId:(null===(e=r.session)||void 0===e?void 0:e.id)||"",slotId:(null===(t=r.session)||void 0===t?void 0:t.slotId)||"",diagnosticId:(null===(n=r.session)||void 0===n?void 0:n.diagnosticId)||"",doctorChamberId:(null===(s=r.session)||void 0===s?void 0:s.doctorChamberId)||""}),{settings:u,setSettings:c}=(0,D.q)(),{width:O}=(0,A.n)(),[B,G]=(0,j.useState)(!1),[M,F]=(0,j.useState)(!1),[Z,R]=(0,j.useState)(!0);if((0,j.useEffect)(()=>{(null==d?void 0:d.queue.notices.length)&&R(!0)},[null==d?void 0:d.queue.notices.length]),null===d)return(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,i.jsx)(I.Loader,{})});let L=null==d?void 0:d.queue.appointments.filter(e=>"ON_GOING"===e.status),_=null==d?void 0:d.queue.appointments.filter(e=>["CONFIRMED","WAITING","BOOKED"].includes(e.status)),Q=_.length;u.enablePatientsDisplay&&(_=_.slice(0,u.patientsDisplay));let U=u.automaticGrouping?L.length:u.patientGroup;return O<1e3?(0,i.jsx)(p.M,{style:{height:"100vh",backgroundColor:"#f8f9fa"},p:"xl",children:(0,i.jsx)(m.Z,{shadow:"lg",padding:"xl",radius:"md",withBorder:!0,style:{maxWidth:500,textAlign:"center"},children:(0,i.jsxs)(h.Stack,{align:"center",gap:"lg",children:[(0,i.jsx)(x.k,{size:80,radius:"xl",variant:"light",color:"grape",children:(0,i.jsx)(b.Z,{size:40})}),(0,i.jsxs)(h.Stack,{gap:"sm",children:[(0,i.jsx)(v.Title,{order:2,children:"Screen Size Too Small"}),(0,i.jsx)(f.Text,{c:"dimmed",size:"sm",children:"This page requires a minimum screen width of 1000px for optimal viewing experience."}),(0,i.jsxs)(f.Text,{c:"dimmed",size:"sm",fw:500,children:["Current width: ",O,"px"]})]}),(0,i.jsx)(g.C,{size:"lg",color:"grape",variant:"light",children:"Open on a larger screen"})]})})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{position:"relative",height:"100vh",overflow:"hidden"},children:[(0,i.jsxs)(w.k,{style:{position:"fixed",bottom:20,right:20,gap:12,zIndex:10,backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(10px)",borderRadius:6,padding:8,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",border:"1px solid rgba(0, 0, 0, 0.05)"},children:[(0,i.jsx)(C.Z,{style:{cursor:"pointer",color:"#666"},onClick:()=>G(!0),size:20}),(0,i.jsx)(S.Z,{style:{cursor:"pointer",color:"#666"},onClick:()=>F(!0),size:20}),(0,i.jsx)(y.Z,{style:{cursor:"pointer",color:"#666"},onClick:l,size:20})]}),(0,i.jsx)(z.Z,{fontSizeMultiplier:u.fontSizeMultiplier,showSerialNo:u.showSerialNo,notices:d.queue.notices||[],showNotices:Z,setShowNotices:()=>R(e=>!e),leftContent:(0,i.jsx)(k.Z,{fontSizeMultiplier:u.fontSizeMultiplier,patientGroup:U,showSerialNo:u.showSerialNo,upcoming:_}),rightContent:(0,i.jsx)(P.Z,{fontSizeMultiplier:u.fontSizeMultiplier,onGoingFullLength:Q,ongoing:L,upcoming:_,patientGroup:u.patientGroup,automaticGrouping:u.automaticGrouping,showSerialNo:u.showSerialNo,showSerialTime:u.showSerialTime})})]}),(0,i.jsx)(N.Z,{opened:B,onClose:()=>G(!1),initialSettings:u,onSave:e=>c(e)}),(0,i.jsx)(q.P,{doctorSessionId:(null===(o=r.session)||void 0===o?void 0:o.id)||"",opened:M,onClose:()=>F(!1),setShowNotices:()=>R(!0)})]})}var B=n(25922),G=n(14803);function M(e){let{doctorChamberId:t,slotId:n,date:u,actualStartTime:p,refetch:m}=e,{opened:h,open:x,close:v}=(0,G.Q)("liveQueueModal"+n),[f,{open:g,close:j}]=(0,l.q)(!1),{toggle:b,fullscreen:C}=(0,a.O)(),[S,{isLoading:y}]=(0,B.U6)(),I=async()=>{try{await S({date:u,slotId:n,actualStartTime:p,doctorChamberId:t}).unwrap(),j(),m(),c().fire({icon:"success",title:"Live Queue Started Successfully",text:"The queue is now active and ready to use.",showCancelButton:!0,confirmButtonText:"Open Live Queue",cancelButtonText:"Close"}).then(e=>{e.isConfirmed&&(x(),C||b())})}catch(t){var e;console.error("Failed to start queue:",t),c().fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,icon:"error",title:"Failed to start queue",text:(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"An unexpected error occurred"})}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Button,{variant:"outline",color:"grape",size:"xs",rightSection:(0,i.jsx)(d.Z,{size:14}),onClick:function(){e.isSessionActive?(x(),C||b()):g()},children:"Live Queue"}),(0,i.jsxs)(o.u,{opened:f,onClose:j,title:"Confirmation",centered:!0,children:[(0,i.jsx)("p",{children:"Are you sure you want to start the live queue?"}),(0,i.jsxs)(r.Group,{justify:"flex-end",mt:"md",children:[(0,i.jsx)(s.Button,{variant:"default",onClick:j,children:"Cancel"}),(0,i.jsx)(s.Button,{loading:y,onClick:I,children:"Confirm"})]})]}),(0,i.jsx)(o.u,{opened:h,onClose:v,withCloseButton:!1,padding:0,radius:0,fullScreen:C,size:C?void 0:"100%",children:(0,i.jsx)(O,{})})]})}},77410:function(e,t,n){"use strict";n.d(t,{L:function(){return r}});var i=n(3287),s=n(12450),o=n(4505);function r(){var e,t,n,r;let l=(0,s.useSearchParams)(),a=null!==(e=null==l?void 0:l.get("doctorChamberId"))&&void 0!==e?e:void 0,d=null!==(t=null==l?void 0:l.get("slotId"))&&void 0!==t?t:void 0,u=null!==(n=null==l?void 0:l.get("date"))&&void 0!==n?n:void 0,c=null!==(r=null==l?void 0:l.get("session"))&&void 0!==r?r:void 0,[p,m]=(0,o.useState)(null),[h,x]=(0,o.useState)(!1);async function v(){try{if(a&&d&&u){let e=await (0,i.Z)(a,d,u);m(e.data||null)}}catch(e){console.log(e),x(!0)}}return(0,o.useEffect)(()=>{v()},[]),{isError:h,refetch:v,data:{sessionName:c||"",queue:(null==p?void 0:p.queue)||[],session:(null==p?void 0:p.session)||null,doctor:(null==p?void 0:p.doctor)||null,stats:(null==p?void 0:p.stats)||[]}}}},87562:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eR}});var i=n(68328),s=n(36409),o=n(14587),r=n(34473),l=n(22614),a=n(41224),d=n(22041),u=n(32451),c=n(76029),p=n(68242),m=n(75865),h=n(31204),x=n(3741),v=n(77303),f=n(49238),g=n(38156),j=n(50430),b=n(4505),C=n(62471),S=n(3287),y=n(12450),I=n(31151),w=n(72940),T=n(6780),z=n(67732);let N=async e=>{var t,n;try{let n=(t="http://sasthotech.local:5000/api/v1",void 0===t)?void 0:t.replace("v1","v2"),i=await T.default.post("".concat(n,"/appointment/update-position"),e,{...w.FD,...w.Hn});return{success:!0,data:i.data.data}}catch(e){if(e instanceof z.d7)return{success:!1,data:null===(n=e.response)||void 0===n?void 0:n.data.message};return{success:!1,data:"An error occurred"}}},k=e=>{let{id:t,prevState:n,offset:i,sortingType:s,status:o,index:r}=e,l=n.map(e=>e.id===t?{...e,status:o}:e);if("WAITING"===o)return l;if("completed"!=s)return E(l,r,i,s);let a=l.filter(e=>["COMPLETED","ON_GOING"].includes(e.status)),d=E(l,r,i,s);return a.length%i==0&&d.forEach(e=>{"MISSED"==e.status&&(e.status="WAITING")}),d},P=(e,t,n,i)=>{let s=e.map(e=>({...e}));if("completed"!=i){let e=0;for(let i=t+1;i<t+e+n+1&&i<s.length;i++)s[i].queuePosition=i,"MISSED"===s[i].status&&e++;let i=t+e+n+1;s[t].queuePosition=Math.min(i,s.length),s[t].status="MISSED"}else{let e=n-s.filter(e=>["COMPLETED","ON_GOING"].includes(e.status)).length%n,i=0;for(;t-i-1>=0&&"WAITING"===s[t-i-1].status;)i++;s[t].status="MISSED";let o=[s[t]],r=t+1;for(;r<s.length&&!(i>=e);)"MISSED"!=s[r].status?("WAITING"==s[r].status&&i++,s[r].queuePosition-=o.length,o.forEach(e=>e.queuePosition++)):(o.push(s[r]),s[r].queuePosition-=1,s[t].queuePosition+=1),r++}return s.sort((e,t)=>e.queuePosition-t.queuePosition)};function E(e,t,n,i){let s=0;for(;t-s-1>=0&&!["COMPLETED","ON_GOING"].includes(e[t-s-1].status);)s++;if(0===s)return e;if("completed"!==i){let i=e.map(e=>({...e})),o=Math.min(t+n+0,i.length);for(let e=t;e<o;e++)i[e].queuePosition=e-s+1,i[e].status;for(let e=t-s;e<t;e++)i[e].queuePosition+=o-t,i[e].status="MISSED";return i.sort((e,t)=>e.queuePosition-t.queuePosition)}{let o=e;for(let r=t-s;r<t;r++){let t=o.findIndex(t=>t.id===e[r].id);o=P(o,t,n,i)}return o}}async function D(e,t,n){let i=e.map(e=>{let t={status:e.status,queuePosition:e.queuePosition,serialNo:e.serialNo};return"REGULAR"===e.type?{...t,appointmentId:e.id}:{...t,reportQueueId:e.id}});try{let e=await N(i);if(e.success){await t();return}I.toast.error("Failed to Update Queue",{description:e.data||"An unknown error occurred"}),n()}catch(e){I.toast.error("Failed to Update Queue",{description:e instanceof Error?e.message:"An unknown error occurred"}),n()}}let q={SOCKET_DEBOUNCE_MS:1500,MUTATION_GRACE_PERIOD_MS:2e3};function A(){var e,t,n,i;let s=(0,y.useSearchParams)(),o=null!==(e=null==s?void 0:s.get("doctorChamberId"))&&void 0!==e?e:void 0,r=null!==(t=null==s?void 0:s.get("slotId"))&&void 0!==t?t:void 0,l=null!==(n=null==s?void 0:s.get("date"))&&void 0!==n?n:void 0,a=null!==(i=null==s?void 0:s.get("session"))&&void 0!==i?i:void 0,[d,u]=(0,b.useState)(null),[c,p]=(0,b.useState)(!1),[m,h]=(0,b.useState)(!0),x=(0,b.useCallback)(async()=>{if(!o||!r||!l){u(null),p(!1),h(!1);return}h(!0),p(!1);try{var e;let t=await (0,S.Z)(o,r,l,2);u(null!==(e=t.data)&&void 0!==e?e:null)}catch(e){console.error(e),p(!0)}finally{h(!1)}},[l,o,r]);(0,b.useEffect)(()=>{x()},[x]);let v=(0,b.useMemo)(()=>{var e,t,n,i;return d?(n=null!==(e=d.queue)&&void 0!==e?e:[],i=null!==(t=d.reportQueues)&&void 0!==t?t:[],[...n.map(e=>({id:e.id,serialNo:String(e.serialNo),timeOf:e.timeOf,queuePosition:e.queuePosition,name:e.patient.name,phone:e.patient.phone,status:e.status,type:"REGULAR"})),...i.map(e=>({id:e.id,serialNo:String(e.appointment.serialNo),timeOf:e.timeOf,queuePosition:e.queuePosition,name:e.appointment.patient.name,phone:e.appointment.patient.phone,status:e.status,type:"REPORT"}))].sort((e,t)=>e.queuePosition-t.queuePosition)):[]},[d]);return{isError:c,isLoading:m,refetch:x,data:(0,b.useMemo)(()=>{var e,t,n,i,s,o;return{sessionName:a||"",queue:null!==(e=null==d?void 0:d.queue)&&void 0!==e?e:[],processedQueue:v,reportQueues:null!==(t=null==d?void 0:d.reportQueues)&&void 0!==t?t:[],reservedQueue:null!==(n=null==d?void 0:d.reservedQueues)&&void 0!==n?n:[],session:null!==(i=null==d?void 0:d.session)&&void 0!==i?i:null,doctor:null!==(s=null==d?void 0:d.doctor)&&void 0!==s?s:null,stats:null!==(o=null==d?void 0:d.stats)&&void 0!==o?o:null}},[a,d,v]),isDataLoaded:!!d}}var O=n(93978),B=n(5171),G=n(11114),M=n(46373),F=n(41112),Z=n(26087),R=n(33908),L=n.n(R),_=n(7965),Q=n(48604),U=n(16391),Y=n(61683),V=n(33989),W=n(45437),H=n(58185),K=n(12697);function X(e){let{onEdit:t,onPrint:n,onDelete:s,isReport:o}=e;return(0,i.jsxs)(m.v,{shadow:"md",width:150,children:[(0,i.jsx)(m.v.Target,{children:(0,i.jsx)(x.A,{variant:"light",color:"dark",children:(0,i.jsx)(f.Z,{size:16})})}),(0,i.jsxs)(m.v.Dropdown,{children:[(0,i.jsx)(m.v.Item,{leftSection:(0,i.jsx)(W.Z,{size:16}),onClick:t,disabled:o,children:"Edit"}),(0,i.jsx)(m.v.Item,{leftSection:(0,i.jsx)(H.Z,{size:16}),onClick:n,disabled:o,children:"Print"}),(0,i.jsx)(m.v.Item,{leftSection:(0,i.jsx)(K.Z,{size:16}),color:"red",onClick:s,children:"Delete"})]})]})}var $=n(46557),J=n(90777),ee=n(25922),et=n(22975),en=n(71149),ei=n(69804);function es(e){let{opened:t,close:n,appointmentId:s}=e,{data:o}=A(),{data:r}=(0,ee.XK)(s,{skip:!t}),l=null==r?void 0:r.data,a={id:"",...o.doctor},d=(0,en.dB)();return(0,i.jsx)(et.u,{opened:t,onClose:n,size:"80%",radius:0,transitionProps:{transition:"fade",duration:200},title:"Appointment Token PDF",children:l&&(()=>{var e;let t=null===(e=ei.m.find(e=>e.id===d))||void 0===e?void 0:e.Component;return t?(0,i.jsx)(t,{appointment:l,doctor:a}):null})()})}var eo=n(30651),er=n(96657);function el(e){var t,n;let{slotName:s,doctorChamberId:o,onRefetch:r,opened:l,close:a,appointmentId:d}=e,{data:u}=(0,ee.XK)(d,{skip:!l}),{data:c}=(0,ee.ei)(o,{skip:!l}),p=null==u?void 0:u.data;if(!p||!(null==c?void 0:c.data))return null;let{patient:m}=p,h=L()(p.timeOf).format("YYYY-MM-DD"),x=L()(p.timeOf).format("hh:mm A"),v=async e=>{let t=I.toast.loading("Updating Appointment Details...");try{if(!m.patientId)throw Error();let{success:n}=await (0,eo.b)(p.id,{pCId:e.pCId,name:e.fullName,gender:e.gender,pcAmount:e.pcAmount,phone:e.phoneNumber,ageYear:Number(e.age),type:e.appointmentType,paidAmount:e.paidAmount,discount:e.discount,discountType:e.discountType,patientId:m.patientId,tests:e.tests,isFeeIncluded:e.isFeeIncluded});if(n)I.toast.success("Appointment Details Updated Successfully!",{id:t}),r(),a();else throw Error()}catch(e){I.toast.error("Failed to update Appointment Details",{id:t})}};if(l)return(0,i.jsx)(er.Z,{title:"Edit Appointment",opened:l,onClose:a,date:h,doctorName:c.data.Doctor.name,handleSubmit:v,sessionName:s,serialNo:p.serialNo,doctorChamberId:o,slotTime:x,phoneDisabled:!0,payableAmount:{FIRST_VISIT:c.data.newPatientFee||999,OLD_VISIT:c.data.oldPatientFee||999},defaultData:{phone:m.phone,fullname:m.name,gender:m.gender||"male",age:m.ageYear.toString(),appointmentType:p.type,paidAmount:p.paidAmount,pcEnabled:!!p.pc,pCId:null===(t=p.pc)||void 0===t?void 0:t.id,pcAmount:null===(n=p.pcAmount)||void 0===n?void 0:n.toString(),tests:p.tests||[]}})}let ea=async e=>{try{let t=await T.default.delete("".concat("http://sasthotech.local:5000/api/v1","/appointment/report-queue/").concat(e),{...w.FD,...w.Hn});return{success:!0,data:t.data.data}}catch(e){if(e instanceof z.d7){var t;return{success:!1,data:null===(t=e.response)||void 0===t?void 0:t.data.message}}return{success:!1,data:"An error occurred"}}};var ed=n(14803);function eu(e){let{queueItem:t,index:n,onStatusChange:s,hide:o,refetch:r,doctorChamberId:a,sessionName:c}=e,p="ON_GOING"===t.status||"COMPLETED"===t.status,{ref:m,handleRef:h,isDragging:x}=(0,Z.n)({id:t.id,index:n,transition:{idle:!0},modifiers:[V.Bh],disabled:p}),v="MISSED"===t.status,f=L()(t.timeOf).format("hh:mmA"),g="REPORT"===t.type,j="COMPLETED"===t.status,b="ON_GOING"===t.status,C=j&&g,[S,{open:y,close:w}]=(0,$.q)(!1),{opened:T,open:z,close:N}=(0,ed.Q)("appointmentModal + ".concat(t.id)),k=async()=>{let e=await (g?ea(t.id):(0,J.G)(t.id));(null==e?void 0:e.success)?(I.toast.success("Appointment deleted successfully."),r()):I.toast.error("Failed to delete appointment.")};return(0,i.jsxs)(u.Box,{ref:m,style:{display:o&&"COMPLETED"===t.status?"none":"block"},children:[(0,i.jsx)(Q.Z,{shadow:x?"xl":"sm",padding:"sm",radius:"md",withBorder:!0,style:{position:"relative",borderColor:v?"#fa5252":x?"#696969ff":void 0,overflow:"visible",borderWidth:x?"2px":"1px",borderStyle:x?"dashed":"solid",scale:x?1.02:1,transition:"all .1s ease-in-out"},children:(0,i.jsx)(U.k,{justify:"space-between",align:"center",children:(0,i.jsxs)(u.Box,{flex:1,children:[(0,i.jsxs)(l.Group,{justify:"space-between",mb:{base:"md",sm:"sm"},children:[(0,i.jsx)(l.Group,{gap:"sm",children:(0,i.jsxs)(l.Group,{gap:"xs",children:[(0,i.jsxs)(G.C,{color:j?"green":b?"yellow":g?"orange":v?"red":"blue",children:[t.serialNo," • ",t.queuePosition]}),C&&(0,i.jsx)(G.C,{color:"teal",variant:"dot",children:"Report"}),(0,i.jsx)(d.Text,{fw:600,size:"sm",visibleFrom:"sm",children:"•"}),(0,i.jsx)(d.Text,{fw:600,size:"sm",visibleFrom:"sm",children:f})]})}),(0,i.jsx)(Y.Z,{status:t.status,disableMissed:!1,handleStatusChange:e=>s(e)})]}),(0,i.jsxs)(U.k,{gap:"xs",align:{base:"flex-start",sm:"center"},children:[(0,i.jsx)(_.Z,{size:14,color:"#495057",height:"1lh"}),(0,i.jsxs)(U.k,{wrap:"wrap",direction:{sm:"row",base:"column"},gap:4,mr:"auto",children:[(0,i.jsx)(d.Text,{size:"sm",fw:500,children:t.name}),(0,i.jsxs)(U.k,{justify:"space-between",gap:4,children:[(0,i.jsxs)(d.Text,{c:"dimmed",size:"sm",children:["(",t.phone.trim(),")"]}),(0,i.jsx)(d.Text,{fw:600,size:"sm",hiddenFrom:"sm",children:"•"}),(0,i.jsx)(d.Text,{c:"dimmed",size:"sm",hiddenFrom:"sm",children:f})]})]}),(0,i.jsx)(u.Box,{style:{alignSelf:"center"},children:(0,i.jsx)(X,{isReport:g,onDelete:k,onEdit:z,onPrint:y})})]})]})})}),(0,i.jsx)(es,{opened:S,close:w,appointmentId:t.id}),(0,i.jsx)(el,{opened:T,close:N,slotName:c,doctorChamberId:a,onRefetch:r,appointmentId:t.id})]})}var ec=n(91427),ep=n(39467),em=n(98542);function eh(e){let{children:t,completedCount:n}=e,[s,o]=(0,b.useState)(!1);return(0,i.jsxs)(u.Box,{children:[(0,i.jsx)(Q.Z,{shadow:"sm",padding:"md",radius:"md",withBorder:!0,style:{cursor:"pointer",userSelect:"none"},onClick:()=>{n>0&&o(!s)},children:(0,i.jsxs)(l.Group,{justify:"space-between",children:[(0,i.jsxs)(l.Group,{gap:"sm",children:[(0,i.jsx)(G.C,{color:"green",variant:"dot",size:"lg",children:n}),(0,i.jsx)(d.Text,{size:"sm",c:"dimmed",children:0==n?"No completed patients":s?"Click to collapse":"View completed patients"})]}),(0,i.jsx)(x.A,{variant:"subtle",color:"gray",size:"lg",disabled:0===n,children:s?(0,i.jsx)(em.Z,{size:20}):(0,i.jsx)(f.Z,{size:20})})]})}),(0,i.jsx)(ep.U,{in:n>0&&s,transitionDuration:300,children:t})]})}var ex=n(89822),ev=n(9323),ef=n(82371),eg=n(90660),ej=n.n(eg),eb=n(22392);function eC(e){var t,n,s,o,r,u;let{queueItem:c,data:p,refetch:m}=e,{setNodeRef:x}=(0,ef.Zj)({id:c.id,data:c}),[v,{open:f,close:g}]=(0,$.q)(),[j,{open:C,close:S}]=(0,$.q)(),[y,I]=(0,b.useState)(null),[w]=(0,ee.tP)(),T=L()(c.timeOf).format("hh:mmA"),{data:z}=(0,ee.ei)((null===(t=p.session)||void 0===t?void 0:t.doctorChamberId)||""),N=(0,en.dB)(),k=(0,ev.a)("(max-width: 600px)");async function P(e,t){try{var n,i,s;let o=await w({slotId:null===(n=p.session)||void 0===n?void 0:n.slotId,date:L()(null===(i=p.session)||void 0===i?void 0:i.date).toISOString(),selectedTime:c.timeOf,name:e.fullName,phone:String(e.phoneNumber),ageYear:Number(e.age),gender:e.gender,paidAmount:e.paidAmount,label:e.appointmentLabel,doctorChamberId:null===(s=p.session)||void 0===s?void 0:s.doctorChamberId,type:e.appointmentType}).unwrap();if(o&&o.data.id){let e=(await (0,eb._)(o.data.id)).data;t(),ej().fire({title:"Appointment Booked Successfully!",text:"Print the serial token.",icon:"success",confirmButtonText:"Print",showCancelButton:!0,cancelButtonText:"Cancel",willClose(){g()},preConfirm(){I(e),C()}})}}catch(e){ej().fire({title:"Error",text:"Failed to book appointment.",icon:"error"})}}return(0,i.jsxs)("div",{ref:x,children:[(0,i.jsx)(h.Button,{unstyled:!0,onClick:f,style:{width:"100%",padding:"var(--mantine-spacing-md)",borderRadius:"var(--mantine-radius-md)",border:"1px dashed",borderColor:"#228be6",backgroundColor:"#f8f9ff"},children:k?(0,i.jsxs)(a.Stack,{align:"center",gap:4,children:[(0,i.jsx)(G.C,{size:"lg",variant:"outline",children:c.serialNo}),(0,i.jsx)(d.Text,{size:"sm",fw:500,c:"blue",children:T}),(0,i.jsx)(d.Text,{size:"xs",c:"dimmed",children:"Reserved Slot"})]}):(0,i.jsxs)(l.Group,{gap:"sm",justify:"center",children:[(0,i.jsx)(G.C,{size:"lg",variant:"outline",children:c.serialNo}),(0,i.jsxs)(a.Stack,{style:{gap:"1px"},align:"flex-start",children:[(0,i.jsx)(d.Text,{size:"sm",fw:500,c:"blue",children:T}),(0,i.jsx)(d.Text,{size:"xs",c:"dimmed",children:"Reserved Slot"})]})]})}),v&&(0,i.jsx)(er.Z,{handleSubmit:P,serialNo:c.serialNo,opened:v,payableAmount:{FIRST_VISIT:(null==z?void 0:null===(n=z.data)||void 0===n?void 0:n.newPatientFee)||0,OLD_VISIT:(null==z?void 0:null===(s=z.data)||void 0===s?void 0:s.oldPatientFee)||0},onClose:()=>{m(),g()},doctorName:(null===(o=p.doctor)||void 0===o?void 0:o.name)||"Unknown Doctor",sessionName:p.sessionName||"Unknown Session",date:(null===(r=p.session)||void 0===r?void 0:r.date)||"Unknown Date",slotTime:T,doctorChamberId:null===(u=p.session)||void 0===u?void 0:u.doctorChamberId}),(0,i.jsx)(et.u,{opened:j,onClose:()=>{S(),g(),m()},size:"80%",radius:0,transitionProps:{transition:"fade",duration:200},title:"Appointment Token PDF",children:y&&(()=>{var e,t,n,s,o;let r=null===(e=ei.m.find(e=>e.id===N))||void 0===e?void 0:e.Component;return r?(0,i.jsx)(r,{doctor:{id:"",name:null!==(s=null==p?void 0:null===(t=p.doctor)||void 0===t?void 0:t.name)&&void 0!==s?s:"",designation:null!==(o=null==p?void 0:null===(n=p.doctor)||void 0===n?void 0:n.designation)&&void 0!==o?o:""},appointment:y}):null})()})]})}var eS=n(34499);function ey(e){var t,n,s,o,r,l,a;let{data:d,refetch:u,renderModal:c=!0}=e,[p,{open:m,close:x}]=(0,$.q)(),{opened:v,open:f,close:g}=(0,ed.Q)("appointmentModal_session"),{data:j}=(0,ee.ei)((null===(t=d.session)||void 0===t?void 0:t.doctorChamberId)||""),[C]=(0,ee._C)(),[S,y]=(0,b.useState)(null),I=(0,en.dB)();async function w(e,t){try{var n,i,s;let o=await C({slotId:null===(n=d.session)||void 0===n?void 0:n.slotId,date:L()(null===(i=d.session)||void 0===i?void 0:i.date).toISOString(),name:e.fullName,phone:String(e.phoneNumber),ageYear:Number(e.age),gender:e.gender,paidAmount:e.paidAmount,label:e.appointmentLabel,doctorChamberId:null===(s=d.session)||void 0===s?void 0:s.doctorChamberId,type:e.appointmentType,tests:e.tests,isFeeIncluded:e.isFeeIncluded}).unwrap();if(o&&o.data.id){let e=(await (0,eb._)(o.data.id)).data;t(),ej().fire({title:"Appointment Booked Successfully!",text:"Print the serial token.",icon:"success",confirmButtonText:"Print",showCancelButton:!0,cancelButtonText:"Cancel",preDeny(){g()},preConfirm(){y(e),m()}})}}catch(e){ej().fire({title:"Error",text:"Failed to book appointment.",icon:"error"})}}return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.Button,{size:"sm",h:50,variant:"light",onClick:f,leftSection:(0,i.jsx)(eS.Z,{size:16}),children:"Add Appointment"}),c&&v&&(0,i.jsx)(er.Z,{handleSubmit:w,opened:v,slotId:null===(n=d.session)||void 0===n?void 0:n.slotId,payableAmount:{FIRST_VISIT:(null==j?void 0:null===(s=j.data)||void 0===s?void 0:s.newPatientFee)||0,OLD_VISIT:(null==j?void 0:null===(o=j.data)||void 0===o?void 0:o.oldPatientFee)||0},onClose:()=>{u(),g()},doctorName:(null===(r=d.doctor)||void 0===r?void 0:r.name)||"Unknown Doctor",sessionName:d.sessionName||"Unknown Session",date:(null===(l=d.session)||void 0===l?void 0:l.date)||"Unknown Date",doctorChamberId:null===(a=d.session)||void 0===a?void 0:a.doctorChamberId}),c&&(0,i.jsx)(et.u,{opened:p,onClose:()=>{x(),g(),u()},size:"80%",radius:0,transitionProps:{transition:"fade",duration:200},title:"Appointment Token PDF",children:S&&(()=>{var e,t,n,s,o;let r=null===(e=ei.m.find(e=>e.id===I))||void 0===e?void 0:e.Component;return r?(0,i.jsx)(r,{doctor:{id:"",name:null!==(s=null==d?void 0:null===(t=d.doctor)||void 0===t?void 0:t.name)&&void 0!==s?s:"",designation:null!==(o=null==d?void 0:null===(n=d.doctor)||void 0===n?void 0:n.designation)&&void 0!==o?o:""},appointment:S}):null})()})]})}var eI=n(55911),ew=n(71996),eT=n(66843),ez=n(9326),eN=n(37947),ek=n(36885);let eP=async e=>{try{let t=await T.default.post("".concat("http://sasthotech.local:5000/api/v1","/appointment/report-queue"),e,{...w.FD,...w.Hn});return{success:!0,data:t.data.data}}catch(e){if(e instanceof z.d7){var t;return{success:!1,data:null===(t=e.response)||void 0===t?void 0:t.data.message}}return{success:!1,data:"An error occurred"}}};function eE(e){var t;let{refetch:n,completed:s,externalOpened:r,onExternalClose:p,hideInternal:m}=e,[v,f]=(0,b.useState)(!1),[g,j]=(0,b.useState)(""),[S,w]=(0,b.useState)(new Date),[T,z]=(0,b.useState)(!1),[N,k]=(0,b.useState)(!1),[P,E]=(0,b.useState)(null),[D,q]=(0,b.useState)(null),[A,O]=(0,b.useState)(null),B=(0,y.useSearchParams)(),F=B.get("slotId"),Z=B.get("date"),R=B.get("doctorChamberId");(0,b.useEffect)(()=>{void 0!==r&&r&&(f(!0),q(null))},[r]);let L=(0,b.useCallback)(()=>{f(!1),O(null),j(""),E(null),q(null),p&&p()},[p]),[U,Y]=(0,C.I)({key:"queue-settings-reservePositionType",defaultValue:"last"}),[V,W]=(0,C.I)({key:"queue-settings-reserveOffset",defaultValue:1}),H=null==S?void 0:S.toISOString().split("T")[0],{data:K,isLoading:X,refetch:$}=(0,ee.BG)({date:H,status:"COMPLETED",doctorChamberId:R||void 0},{skip:!v}),J=(null==K?void 0:K.data)||[],en=(0,b.useCallback)(async(e,t)=>{if(!e.trim()){E(null);return}z(!0);let n=null==S?void 0:S.toISOString().split("T")[0],i=await (0,ek.O)(e,n,t,"COMPLETED");i.success?E(i.data):E(null),z(!1)},[S]);(0,b.useEffect)(()=>{let e=setTimeout(()=>{/^\D/.test(g.trim())?en(g):g.trim().length>=7&&en(g,!0)},500);return()=>clearTimeout(e)},[g,S,en]);let ei=async()=>{if(!g.trim()){q("Serial number is required");return}if(!S){q("Date is required");return}if(null===F){q("Slot ID is missing in the URL");return}if(""===F){q("Slot ID cannot be empty");return}if(null===Z){q("Date is missing in the URL");return}if(""===Z){q("Date cannot be empty");return}if(q(null),k(!0),null===P){q("No patient data found"),k(!1);return}try{let e=S.toISOString().split("T")[0],t=await eP({serialNo:P.serial||g.trim(),date:e,slotId:F||"",queueDate:Z||"",queuePosition:"fixed"==U?s+V:void 0});t.success?(f(!1),j(""),w(new Date),E(null),O(null),q(null),n(),I.toast.message("Report queue created successfully")):q(t.data||"Failed to create report queue")}catch(e){q("An unexpected error occurred")}finally{k(!1)}};return(0,i.jsxs)(i.Fragment,{children:[!m&&(0,i.jsx)(h.Button,{size:"sm",h:50,color:"orange",variant:"light",leftSection:(0,i.jsx)(eT.Z,{size:16}),onClick:()=>{f(!0),q(null),K&&$()},children:"Report Evaluation"}),(0,i.jsxs)(et.u,{opened:v,onClose:L,title:"Report Evaluation",centered:!0,size:"md",children:[D&&(0,i.jsx)(M.b,{icon:(0,i.jsx)(ez.Z,{size:16}),color:"red",mb:"md",withCloseButton:!0,onClose:()=>q(null),children:D}),(0,i.jsx)(ew.W,{label:"Date",placeholder:"Select date",value:S,onChange:w,mb:"md"}),X?(0,i.jsx)(u.Box,{mb:"md",children:(0,i.jsxs)(l.Group,{gap:"xs",mb:4,children:[(0,i.jsx)(o.Loader,{size:"xs"}),(0,i.jsx)(d.Text,{size:"xs",c:"dimmed",children:"Loading..."})]})}):J.length>0?(0,i.jsxs)(u.Box,{mb:"md",children:[(0,i.jsxs)(d.Text,{size:"xs",c:"dimmed",mb:6,children:["Select Serial (",J.length," found)"]}),(0,i.jsx)(ex.x,{h:"auto",type:"auto",children:(0,i.jsx)(l.Group,{gap:6,children:J.map(e=>(0,i.jsx)(c.u,{label:(0,i.jsxs)(u.Box,{children:[(0,i.jsx)(d.Text,{size:"xs",fw:500,children:e.patient.name}),(0,i.jsx)(d.Text,{size:"xs",children:e.patient.phone}),(0,i.jsxs)(d.Text,{size:"xs",c:"dimmed",children:[e.patient.gender," • ",e.patient.ageYear,"y"]})]}),withArrow:!0,position:"top",children:(0,i.jsx)(G.C,{size:"lg",variant:(null==A?void 0:A.id)===e.id?"filled":"light",color:(null==A?void 0:A.id)===e.id?"blue":"gray",style:{cursor:"pointer"},onClick:()=>{O(e),j(e.serialNo),E({patient:{...e.patient,ageMonth:0,ageDay:0,district:"",address:"",thana:""},serial:e.serialNo,status:e.status,doctorChamber:{Doctor:{id:"",name:"",designation:"",image:null,phone1:null,phone2:null,percentage:0,division:""}}})},children:e.serialNo.toUpperCase()})},e.id))})})]}):(0,i.jsx)(u.Box,{mb:"md",children:(0,i.jsx)(d.Text,{size:"xs",c:"dimmed",children:"No completed appointments found"})}),(0,i.jsx)(Q.Z,{withBorder:!0,mb:"md",p:"sm",children:(0,i.jsxs)(l.Group,{gap:"sm",children:[(0,i.jsx)(u.Box,{children:T?(0,i.jsx)(o.Loader,{size:"sm"}):(0,i.jsx)(_.Z,{size:24,stroke:1.5})}),(0,i.jsx)(a.Stack,{gap:4,style:{flex:1},children:(null==P?void 0:P.patient)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Text,{size:"sm",fw:500,children:P.patient.name||"N/A"}),(0,i.jsxs)(d.Text,{size:"xs",c:"dimmed",children:[P.patient.phone||"N/A"," •"," ",(null===(t=P.serial)||void 0===t?void 0:t.toUpperCase())||g.trim().toUpperCase()]})]}):(0,i.jsx)(d.Text,{size:"sm",c:"dimmed",children:g.trim()?"No patient found":"Select an appointment or enter serial/phone number"})}),(null==P?void 0:P.patient)&&(0,i.jsx)(x.A,{variant:"transparent",c:"dimmed",size:"xs",onClick:()=>{j(""),E(null),O(null)},children:(0,i.jsx)(eN.Z,{})})]})}),(0,i.jsx)(eI.TextInput,{label:"Serial No. or Phone Number (Optional)",placeholder:"e.g, A22 or 0130.......",value:g,onChange:e=>j(e.currentTarget.value),mb:"md"}),(0,i.jsxs)(l.Group,{justify:"flex-end",mt:"md",children:[(0,i.jsx)(h.Button,{variant:"default",onClick:$,mr:"auto",children:"Refresh"}),(0,i.jsx)(h.Button,{variant:"default",onClick:()=>f(!1),disabled:N,children:"Cancel"}),(0,i.jsx)(h.Button,{onClick:ei,loading:N,children:"Submit"})]})]})]})}function eD(e){let{data:t,refetch:n,completed:s,renderModal:o=!0}=e;return(0,i.jsxs)(Q.Z,{shadow:"sm",padding:"md",radius:"md",withBorder:!0,maw:450,w:"100%",children:[(0,i.jsxs)(Q.Z.Section,{withBorder:!0,inheritPadding:!0,pt:"md",px:0,children:[(0,i.jsx)(d.Text,{size:"sm",fw:500,mb:"md",px:"sm",children:"Reserved Slots"}),(0,i.jsx)(ex.x,{h:"300px",children:(0,i.jsx)(u.Box,{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(140px, 1fr))",gap:"var(--mantine-spacing-xs)"},mb:"md",px:"sm",children:t.reservedQueue.length>0?t.reservedQueue.map(e=>(0,i.jsx)(eC,{queueItem:e,data:t,refetch:n},e.id)):(0,i.jsx)(d.Text,{size:"sm",c:"dimmed",ta:"center",w:"100%",mt:"lg",my:"xl",style:{gridColumn:"1 / -1"},children:"No reserved slots"})})})]}),(0,i.jsx)(Q.Z.Section,{inheritPadding:!0,py:"md",children:(0,i.jsxs)(l.Group,{grow:!0,children:[(0,i.jsx)(ey,{data:t,refetch:n,renderModal:o}),(0,i.jsx)(eE,{refetch:n,completed:s})]})})]})}function eq(e){let{children:t,reservedCount:n,refetch:s,completed:o}=e,[r,a]=(0,b.useState)(!1),[p,m]=(0,b.useState)(!1),{open:h}=(0,ed.Q)("appointmentModal_session");return(0,i.jsxs)(u.Box,{children:[(0,i.jsx)(Q.Z,{shadow:"sm",padding:"md",radius:"md",withBorder:!0,style:{cursor:"pointer",userSelect:"none"},onClick:()=>{a(!r)},children:(0,i.jsxs)(l.Group,{justify:"space-between",children:[(0,i.jsxs)(l.Group,{gap:"sm",children:[(0,i.jsx)(G.C,{color:"blue",variant:"dot",size:"lg",children:n}),(0,i.jsx)(d.Text,{size:"sm",c:"dimmed",children:"Reserved"})]}),(0,i.jsxs)(l.Group,{gap:"xs",children:[(0,i.jsx)(c.u,{label:"Add Appointment",children:(0,i.jsx)(x.A,{variant:"light",color:"blue",size:"lg",onClick:e=>{e.stopPropagation(),h()},children:(0,i.jsx)(eS.Z,{size:18})})}),(0,i.jsx)(c.u,{label:"Report Evaluation",children:(0,i.jsx)(x.A,{variant:"light",color:"orange",size:"lg",onClick:e=>{e.stopPropagation(),m(!0)},children:(0,i.jsx)(eT.Z,{size:18})})}),(0,i.jsx)(x.A,{variant:"subtle",color:"gray",size:"lg",children:r?(0,i.jsx)(em.Z,{size:20}):(0,i.jsx)(f.Z,{size:20})})]})]})}),(0,i.jsx)(ep.U,{in:r,transitionDuration:300,children:t}),(0,i.jsx)(eE,{hideInternal:!0,refetch:s,completed:o,externalOpened:p,onExternalClose:()=>m(!1)})]})}var eA=n(91622);let eO=(e,t)=>{if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1){let i=e[n],s=t[n];if(i.id!==s.id||i.status!==s.status||i.queuePosition!==s.queuePosition)return!1}return!0};function eB(e){var t,n,s,o;let{refetch:r,settings:d,data:c}=e,[p,m]=(0,b.useState)(()=>c.processedQueue),h=(0,b.useRef)(p),x=(0,eA.N)({sessionId:(null===(t=c.session)||void 0===t?void 0:t.id)||"",slotId:(null===(n=c.session)||void 0===n?void 0:n.slotId)||"",diagnosticId:(null===(s=c.session)||void 0===s?void 0:s.diagnosticId)||"",doctorChamberId:(null===(o=c.session)||void 0===o?void 0:o.doctorChamberId)||""}),[v,f]=(0,b.useState)(!1),[g,j]=(0,b.useState)(!1),C=(0,b.useRef)(0),S=(0,b.useRef)(null);(0,b.useEffect)(()=>{h.current=p},[p]),(0,b.useEffect)(()=>{m(e=>eO(e,c.processedQueue)?(h.current=e,e):(h.current=c.processedQueue,c.processedQueue))},[c.processedQueue]),(0,b.useEffect)(()=>{if(x)return S.current&&clearTimeout(S.current),j(!0),S.current=setTimeout(()=>{let e=x.queue.appointments.map(e=>({id:e.id,name:e.patient.name,phone:e.patient.patientId.toString(),status:e.status,timeOf:e.timeOf,serialNo:e.serialNo,queuePosition:e.queuePosition,type:"REPORT_QUEUE"===e.type?"REPORT":"REGULAR"}));m(t=>{let n=function(e,t,n,i){if(n||Date.now()-i<q.MUTATION_GRACE_PERIOD_MS)return e;let s=new Map(e.map(e=>[e.id,e])),o=[];return t.forEach(e=>{let t=s.get(e.id);t?"COMPLETED"===t.status&&"COMPLETED"!==e.status?o.push(t):"COMPLETED"===e.status?o.push(e):o.push({...e}):o.push(e)}),o.sort((e,t)=>e.queuePosition-t.queuePosition)}(t,e,v,C.current);return eO(t,n)?t:(h.current=n,n)}),j(!1)},q.SOCKET_DEBOUNCE_MS),()=>{S.current&&clearTimeout(S.current)}},[x,v]);let y=(0,b.useMemo)(()=>p.filter(e=>"COMPLETED"===e.status),[p]),I=(0,b.useCallback)(e=>h.current.findIndex(t=>t.id===e),[]),w=(0,b.useCallback)((e,t)=>{eO(t,e)||(C.current=Date.now(),m(e),h.current=e,D(e,r,()=>{if(eO(h.current,e)){m(t),h.current=t;return}r()}))},[r]),T=(0,b.useCallback)((e,t)=>{if(null===e)return;let n=h.current;if(t<0||t>=n.length)return;let i=n[t];if(i.status===e)return;let s="last"===d.sortingType?n.length:d.offset;w("MISSED"===e?P(n,t,s,d.sortingType):k({id:i.id,prevState:n,offset:s,sortingType:d.sortingType,status:e,index:t}),n)},[w,d.offset,d.sortingType]),z=(0,b.useRef)(null),N=(0,b.useCallback)(()=>{f(!0)},[]),E=(0,b.useCallback)(()=>{f(!1),C.current=Date.now()},[]),A=(0,b.useCallback)(e=>{z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{let t=h.current;w((0,ec.pB)(t,e).map((e,t)=>({...e,queuePosition:t+1})),t)},1e3)},[w]);return(0,b.useEffect)(()=>()=>{z.current&&clearTimeout(z.current)},[]),(0,i.jsxs)(l.Group,{align:"start",justify:"space-between",children:[(0,i.jsxs)(a.Stack,{maw:450,w:"100%",children:[g&&(0,i.jsx)(G.C,{size:"sm",color:"blue",variant:"dot",style:{alignSelf:"flex-start"},children:"Syncing queue updates..."}),(0,i.jsx)(u.Box,{hiddenFrom:"md",children:(0,i.jsx)(eq,{reservedCount:c.reservedQueue.length,refetch:r,completed:y.length,children:(0,i.jsx)(u.Box,{mt:"md",children:(0,i.jsx)(eD,{data:c,refetch:r,completed:y.length,renderModal:!1})})})}),0===p.length?(0,i.jsx)(M.b,{title:"No Patients",color:"blue",children:"No patients in the queue. Please add patients to get started."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eh,{completedCount:y.length,children:(0,i.jsx)(u.Box,{mt:"md",children:y.map((e,t)=>{var n;return(0,i.jsx)(eu,{doctorChamberId:null===(n=c.session)||void 0===n?void 0:n.doctorChamberId,sessionName:c.sessionName,refetch:r,queueItem:e,onStatusChange:t=>T(t,I(e.id)),index:t},e.id)})})}),(0,i.jsx)(F.wz,{onDragStart:N,onDragEnd:E,onDragOver:A,children:p.map((e,t)=>{var n;return(0,i.jsx)(eu,{doctorChamberId:null===(n=c.session)||void 0===n?void 0:n.doctorChamberId,sessionName:c.sessionName,refetch:r,index:t,queueItem:e,hide:!0,onStatusChange:e=>T(e,t)},e.id)})})]})]}),(0,i.jsx)(u.Box,{visibleFrom:"md",children:(0,i.jsx)(eD,{data:c,refetch:r,completed:y.length})})]})}var eG=n(67686),eM=n(29259);let eF={key:"queue-settings",defaultValue:{sortingType:"last",offset:0,reservePositionType:"last",reserveOffset:0}};function eZ(e){let{opened:t,onClose:n,onSubmit:s,initialSortingType:o="last",initialOffset:r=1,initialReservePositionType:d="last",initialReserveOffset:u=1}=e,[c,p]=(0,C.I)({key:"queue-settings-sortingType",defaultValue:o}),[m,x]=(0,C.I)({key:"queue-settings-offset",defaultValue:r}),[f,g]=(0,C.I)({key:"queue-settings-reservePositionType",defaultValue:d}),[j,b]=(0,C.I)({key:"queue-settings-reserveOffset",defaultValue:u});return(0,i.jsx)(et.u,{opened:t,onClose:n,title:"Queue Settings",centered:!0,children:(0,i.jsxs)(a.Stack,{gap:"md",children:[(0,i.jsx)(eG.Y.Group,{value:c,onChange:e=>p(e),label:"Select Position",description:"Choose where to place items in the queue",children:(0,i.jsxs)(l.Group,{mt:"xs",children:[(0,i.jsx)(eG.Y,{value:"last",label:"Last"}),(0,i.jsx)(eG.Y,{value:"fixed",label:"Fixed"}),(0,i.jsx)(eG.Y,{value:"completed",label:"Completed"})]})}),(0,i.jsx)(eM.Y,{label:"Position",placeholder:"Enter position number",value:m,onChange:e=>x(Number(e)),disabled:"last"===c,min:1}),(0,i.jsx)(v.Divider,{}),(0,i.jsx)(eG.Y.Group,{value:f,onChange:e=>g(e),label:"Select Reserve position",description:"Choose where to place items in the reserve queue",children:(0,i.jsxs)(l.Group,{mt:"xs",children:[(0,i.jsx)(eG.Y,{value:"last",label:"Last"}),(0,i.jsx)(eG.Y,{value:"fixed",label:"Fixed"})]})}),(0,i.jsx)(eM.Y,{label:"Reserve Position",placeholder:"Enter reserve position number",value:j,onChange:e=>b(Number(e)),disabled:"last"===f,min:1}),(0,i.jsxs)(l.Group,{justify:"flex-end",mt:"md",children:[(0,i.jsx)(h.Button,{variant:"subtle",onClick:n,children:"Cancel"}),(0,i.jsx)(h.Button,{onClick:()=>{s({sortingType:c,offset:m,reservePositionType:f,reserveOffset:j}),n()},children:"Apply"})]})]})})}function eR(){var e,t,n,S,y,I,w,T;let{data:z,refetch:N,isError:k,isDataLoaded:P}=A(),[E,D]=(0,b.useState)(!1),[q,G]=(0,C.I)(eF);return k?(0,i.jsx)("div",{children:"Error fetching queue data"}):P?(0,i.jsxs)(r.Container,{p:"md",size:"lg",children:[(0,i.jsxs)(l.Group,{justify:"space-between",mb:"lg",children:[(0,i.jsxs)(a.Stack,{gap:1,children:[(0,i.jsx)(p.Title,{order:2,mb:"lg",children:"Queue Management"}),(0,i.jsxs)(d.Text,{size:"sm",c:"dimmed",children:["Doctor: ",null===(e=z.doctor)||void 0===e?void 0:e.name]}),(0,i.jsxs)(l.Group,{children:[(0,i.jsxs)(d.Text,{size:"sm",c:"dimmed",mt:4,children:[z.sessionName," Session •"," ",(null===(t=z.session)||void 0===t?void 0:t.date)&&L()(null===(n=z.session)||void 0===n?void 0:n.date).format("DD MMM YYYY")]}),(0,i.jsxs)(m.v,{shadow:"sm",withinPortal:!0,position:"bottom-end",offset:6,children:[(0,i.jsx)(m.v.Target,{children:(0,i.jsx)(h.Button,{variant:"subtle",size:"xs",rightSection:(0,i.jsx)(f.Z,{size:12}),children:"Stats"})}),(0,i.jsx)(m.v.Dropdown,{children:z.stats&&Object.keys(z.stats).length>0?Object.entries(z.stats).map(e=>{let[t,n]=e;return(0,i.jsxs)(m.v.Item,{styles:{item:{fontSize:12}},children:[(0,i.jsx)(d.Text,{component:"span",c:"dimmed",size:"xs",style:{marginRight:8,textTransform:"capitalize"},children:t.replace(/_/g," ")}),(0,i.jsx)(d.Text,{component:"span",size:"xs",fw:600,children:String(n)})]},t)}):(0,i.jsx)(m.v.Item,{styles:{item:{fontSize:12}},children:(0,i.jsx)(d.Text,{size:"xs",c:"dimmed",children:"No stats available"})})})]})]})]}),(0,i.jsx)(u.Box,{children:(0,i.jsxs)(l.Group,{gap:"xs",children:[(null===(S=z.session)||void 0===S?void 0:S.status)==="ACTIVE"&&(0,i.jsx)(B.$,{}),(0,i.jsx)(O.Z,{isSessionActive:(null===(y=z.session)||void 0===y?void 0:y.status)==="ACTIVE",refetch:N,doctorChamberId:(null===(I=z.session)||void 0===I?void 0:I.doctorChamberId)||"",slotId:(null===(w=z.session)||void 0===w?void 0:w.slotId)||"",date:(null===(T=z.session)||void 0===T?void 0:T.date)||""}),(0,i.jsx)(c.u,{label:"Queue Settings",children:(0,i.jsx)(x.A,{variant:"outline",color:"gray",size:"md",onClick:()=>D(!0),children:(0,i.jsx)(g.Z,{size:14})})}),(0,i.jsx)(c.u,{label:"Refresh queue",children:(0,i.jsx)(x.A,{variant:"outline",color:"blue",size:"md",onClick:N,children:(0,i.jsx)(j.Z,{size:14})})})]})})]}),(0,i.jsx)(v.Divider,{mb:"lg"}),(0,i.jsx)(eZ,{opened:E,onClose:()=>D(!1),onSubmit:function(e){G(e)},initialSortingType:q.sortingType,initialOffset:q.offset}),(0,i.jsx)(eB,{data:z,refetch:N,settings:q})]}):(0,i.jsx)(s.M,{style:{minHeight:"100vh"},children:(0,i.jsx)(o.Loader,{size:"lg"})})}},90777:function(e,t,n){"use strict";n.d(t,{G:function(){return r}});var i=n(72940),s=n(6780),o=n(67732);let r=async e=>{try{let t=await s.default.delete("".concat("http://sasthotech.local:5000/api/v1","/appointment/").concat(e),i.FD);return{success:!0,data:t.data.data}}catch(e){if(e instanceof o.d7){var t;return{success:!1,data:null===(t=e.response)||void 0===t?void 0:t.data.message}}return{success:!1,data:"An error occurred"}}}},22392:function(e,t,n){"use strict";n.d(t,{_:function(){return r}});var i=n(72940),s=n(6780),o=n(67732);let r=async e=>{try{let t=await s.default.get("".concat("http://sasthotech.local:5000/api/v1","/appointment/").concat(e),i.FD);return{success:!0,data:t.data.data}}catch(e){if(e instanceof o.d7){var t;return{success:!1,data:null===(t=e.response)||void 0===t?void 0:t.data.message}}return{success:!1,data:"An error occurred"}}}},3287:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var i=n(72940),s=n(6780),o=n(67732);let r=async function(e,t,n){var r,l;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;try{let o=(r="http://sasthotech.local:5000/api/v1",void 0===r)?void 0:r.replace("/api/v1","/api/v"+a),l=await s.default.get("".concat(o,"/appointment/queue?doctorChamberId=").concat(e,"&slotId=").concat(t,"&date=").concat(n),i.FD);return{success:!0,data:l.data.data}}catch(e){if(e instanceof o.d7)return{success:!1,data:null===(l=e.response)||void 0===l?void 0:l.data.message};return{success:!1,data:"An error occurred"}}}},30651:function(e,t,n){"use strict";n.d(t,{b:function(){return r}});var i=n(72940),s=n(6780),o=n(67732);let r=async(e,t)=>{try{let n=await s.default.patch("".concat("http://sasthotech.local:5000/api/v1","/appointment/").concat(e),t,{...i.FD,...i.Hn});return{success:!0,data:n.data.data}}catch(e){if(e instanceof o.d7){var n;return{success:!1,data:null===(n=e.response)||void 0===n?void 0:n.data.message}}return{success:!1,data:"An error occurred"}}}},36885:function(e,t,n){"use strict";n.d(t,{O:function(){return r}});var i=n(72940),s=n(6780),o=n(67732);let r=async(e,t,n,r)=>{try{let o=await s.default.get("".concat("http://sasthotech.local:5000/api/v1","/appointment/patient/").concat(e),{...i.FD,params:{date:t,isPhoneSearch:n,status:r}});return{success:!0,data:o.data.data}}catch(e){if(e instanceof o.d7){var l;return{success:!1,data:null===(l=e.response)||void 0===l?void 0:l.data.message}}return{success:!1,data:"An error occurred"}}}}},function(e){e.O(0,[1601,2975,3313,9826,4404,3439,7281,7852,3069,6945,3852,1656,9722,4670,9258,9533,966,12,7538,1166,7967,6029,6306,7698,3583,7186,4193,4890,7125,6625,6004,5980,4572,8624,3697,9057,7135,1321,2893,5320,9175,7402,1744],function(){return e(e.s=83489)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9567],{38806:function(e,t,i){Promise.resolve().then(i.bind(i,55052))},55052:function(e,t,i){"use strict";i.r(t);var n=i(68328),r=i(7203),s=i(37003),a=i(72348),d=i(45264),o=i(22614),l=i(22041),c=i(68242),u=i(31204),h=i(54632),x=i(3741),m=i(22975),p=i(55911),y=i(48604),g=i(87967),j=i(14587),f=i(85033),b=i(29259),v=i(76029),T=i(47720),S=i(46557),w=i(9654),C=i(5646),A=i(45437),k=i(12697),E=i(32740),N=i(78530),O=i(76283),Z=i(6660),D=i(52013),M=i(93208),z=i(4505),L=i(90660),P=i.n(L),q=i(18193),I=i.n(q);function B(e){let{opened:t,onClose:i,subcategories:r,handleBatchOrderUpdate:s,isLoading:a}=e,[d,p]=(0,z.useState)({}),[g,j]=(0,z.useState)(!1),f=e=>Object.keys(d).find(t=>d[t]===e);(0,z.useEffect)(()=>{if(t){let e={},t=!1;if(r.forEach(i=>{let n=i.order||0;e[n]=(e[n]||0)+1,e[n]>1&&(t=!0)}),t||1===Object.keys(e).length){let e={};r.forEach((t,i)=>{e[t.id]=i+1}),p(e),j(!0)}else p(r.reduce((e,t)=>(e[t.id]=t.order||0,e),{})),j(!1)}},[t,r]);let v=(e,t)=>{p(i=>{let n={...i,[e]:t};return j(r.some(e=>n[e.id]!==(e.order||0))),n})},T=()=>{s(Object.entries(d).map(e=>{let[t,i]=e;return{id:t,order:i}})),j(!1)};return(0,n.jsx)(m.u,{opened:t,onClose:i,title:"Manage Subcategory Order",size:"lg",children:(0,n.jsxs)(y.Z,{shadow:"lg",children:[(0,n.jsxs)(o.Group,{justify:"space-between",mb:20,children:[(0,n.jsx)(c.Title,{order:3,children:"Set display order for all subcategories"}),(0,n.jsx)(u.Button,{onClick:T,disabled:!g||a,loading:a,leftSection:(0,n.jsx)(O.Z,{size:18}),color:"green",children:"Save All Changes"})]}),(0,n.jsx)(l.Text,{mb:10,size:"sm",c:"dimmed",children:"Lower numbers appear first. All changes will be saved at once when you click the Save button."}),g&&(0,n.jsx)(l.Text,{mb:20,size:"sm",fw:"bold",c:"orange",children:"* Order values have been adjusted to prevent overlaps"}),(0,n.jsxs)(h.i,{children:[(0,n.jsxs)(h.i.Thead,{children:[(0,n.jsx)(h.i.Th,{children:"Current Order"}),(0,n.jsx)(h.i.Th,{children:"Name"}),(0,n.jsx)(h.i.Th,{children:"New Order"}),(0,n.jsx)(h.i.Th,{children:"Actions"})]}),(0,n.jsx)(h.i.Tbody,{children:r.map(e=>(0,n.jsxs)(h.i.Tr,{children:[(0,n.jsx)(h.i.Td,{children:e.order||0}),(0,n.jsx)(h.i.Td,{children:e.name}),(0,n.jsx)(h.i.Td,{children:(0,n.jsx)(b.Y,{value:d[e.id],onChange:t=>v(e.id,Number(t)),min:0,max:r.length,style:{width:"100px"}})}),(0,n.jsx)(h.i.Td,{children:(0,n.jsxs)(o.Group,{children:[(0,n.jsx)(x.A,{onClick:()=>{let t=Math.max(1,(d[e.id]||1)-1);if(t!==d[e.id]){let i=f(t);i&&v(i,d[e.id])}v(e.id,Math.max(1,(d[e.id]||1)-1))},disabled:1===d[e.id],children:(0,n.jsx)(Z.Z,{size:18})}),(0,n.jsx)(x.A,{onClick:()=>{let t=Math.min((d[e.id]||0)+1,r.length);if(t!==d[e.id]){let i=f(t);i&&v(i,d[e.id])}v(e.id,Math.min((d[e.id]||0)+1,r.length))},disabled:d[e.id]===r.length,children:(0,n.jsx)(D.Z,{size:18})})]})})]},e.id))})]}),(0,n.jsx)(o.Group,{justify:"space-between",mt:20,children:(0,n.jsxs)(o.Group,{children:[(0,n.jsx)(u.Button,{variant:"subtle",onClick:i,disabled:a,children:"Cancel"}),(0,n.jsx)(u.Button,{onClick:T,disabled:!g||a,loading:a,children:"Save Changes"})]})})]})})}function R(e){let{subTestCategoryId:t,subTestCategoryName:i,refetch:a}=e,[o,{open:c,close:u}]=(0,S.q)(!1),[p,y]=(0,z.useState)(null),[g,j]=(0,z.useState)(!1),[f]=(0,d.nZ)(),b=async()=>{try{j(!0);let i=await (0,s.p)(t);if(i.success){var e;y(null===(e=i.data)||void 0===e?void 0:e.items)}else throw Error("Error")}catch(e){console.error("Error loading tests:",e)}finally{j(!1)}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.u,{label:"Test Lists of Subcategory",children:(0,n.jsx)(x.A,{onClick:()=>{c(),b()},children:(0,n.jsx)(M.Z,{})})}),(0,n.jsx)(m.u,{title:(0,n.jsxs)(l.Text,{children:["Sub Category Test Lists -"," ",(0,n.jsx)(l.Text,{component:"span",fw:700,children:i})]}),size:800,opened:o,onClose:()=>{u()},children:g?(0,n.jsx)(r.Z,{}):(0,n.jsxs)(h.i,{children:[(0,n.jsxs)(h.i.Thead,{children:[(0,n.jsx)(h.i.Th,{children:"Test Name"}),(0,n.jsx)(h.i.Th,{children:"Price"}),(0,n.jsx)(h.i.Th,{children:"Actions"})]}),(0,n.jsx)(h.i.Tbody,{children:null==p?void 0:p.map(e=>(0,n.jsxs)(h.i.Tr,{children:[(0,n.jsx)(h.i.Td,{children:e.name}),(0,n.jsx)(h.i.Td,{children:e.price}),(0,n.jsx)(h.i.Td,{onClick:async()=>{"error"in await f({id:e.id})?P().fire("Error"):(null==a||a(),b())},style:{cursor:"pointer"},children:(0,n.jsx)(k.Z,{color:"red"})})]},e.id))})]})})]})}t.default=()=>{let[e,{open:t,close:i}]=(0,S.q)(!1),[b,{open:v,close:O}]=(0,S.q)(!1),[Z,{open:D,close:M}]=(0,S.q)(!1),{data:L,isLoading:q,refetch:_}=(0,d.R6)(),[F,G]=(0,d.NW)(),[Q]=(0,d.Xx)(),[U,W]=(0,d.AK)(),[H]=(0,d.ER)(),[K,V]=(0,z.useState)(null),[X,Y]=(0,z.useState)(null),[J,$]=(0,z.useState)(null),[ee,et]=(0,z.useState)([]),[ei,en]=(0,z.useState)(999),[er,es]=(0,z.useState)(!1),ea=(0,T.c)({mode:"uncontrolled",initialValues:{name:"",machine:""}}),ed=(0,z.useMemo)(()=>{if(null==L?void 0:L.data){var e;return null==L?void 0:null===(e=L.data)||void 0===e?void 0:e.map(e=>({...e,value:e.id,label:e.name}))}},[null==L?void 0:L.data]);(0,z.useEffect)(()=>{(async()=>{try{let e=await (0,s.p)();e.data.items.map(e=>({...e,value:e.id,label:e.name})),$(e.data.items.map(e=>({...e,value:e.id,label:e.name})))}catch(e){}})()},[]);let eo=async()=>{try{let e=null==ee?void 0:ee.map(e=>({id:e,subcategoryId:X}));(await (0,a.L)({tests:e})).success&&(en(e=>e+1e3),_(),O(),V(null),et([]),P().fire("Success","Sub Category Added to tests","success"))}catch(e){P().fire("Error","Something Went Wrong","error")}},el=async e=>{try{es(!0);let t=await Q(e);"error"in t?P().fire("Error","Failed to update orders","error"):(_(),P().fire("Success","Orders updated successfully","success"),M())}catch(e){console.error("Error updating orders:",e),P().fire("Error","Something went wrong updating orders","error")}finally{es(!1)}};if(q)return(0,n.jsx)(r.Z,{});let ec=[...(null==L?void 0:L.data)||[]].sort((e,t)=>(e.order||0)-(t.order||0));return(0,n.jsxs)("div",{className:I().container,children:[(0,n.jsxs)(o.Group,{children:[(0,n.jsx)(c.Title,{children:"Sub Category Lists"}),(0,n.jsxs)(o.Group,{children:[(0,n.jsx)(u.Button,{onClick:t,leftSection:(0,n.jsx)(w.Z,{}),children:"Add New Subcategory"}),(0,n.jsx)(u.Button,{onClick:v,children:"Add Test to Subcategory"}),(0,n.jsx)(u.Button,{onClick:D,leftSection:(0,n.jsx)(C.Z,{}),children:"Manage Order"})]})]}),(0,n.jsx)("div",{className:"bg-white p-0 my-4 rounded-2",children:(0,n.jsxs)(h.i,{children:[(0,n.jsxs)(h.i.Thead,{children:[(0,n.jsx)(h.i.Th,{children:"Order"}),(0,n.jsx)(h.i.Th,{children:"Name"}),(0,n.jsx)(h.i.Th,{children:"Machine Name"}),(0,n.jsx)(h.i.Th,{children:"Test Count"}),(0,n.jsx)(h.i.Th,{children:"Actions"})]}),(0,n.jsx)(h.i.Tbody,{children:null==ec?void 0:ec.map(e=>{var i;return(0,n.jsxs)(h.i.Tr,{children:[(0,n.jsx)(h.i.Td,{children:(null==e?void 0:e.order)||0}),(0,n.jsx)(h.i.Td,{children:null==e?void 0:e.name}),(0,n.jsx)(h.i.Td,{children:null==e?void 0:e.machine}),(0,n.jsxs)(h.i.Td,{children:[null==e?void 0:null===(i=e._count)||void 0===i?void 0:i.tests," ",(0,n.jsx)(R,{refetch:_,subTestCategoryName:e.name,subTestCategoryId:e.id})]}),(0,n.jsx)(h.i.Td,{children:(0,n.jsxs)(o.Group,{children:[(0,n.jsx)(x.A,{onClick:()=>{var i;t(),ea.setFieldValue("name",null==e?void 0:e.name),ea.setFieldValue("machine",null!==(i=null==e?void 0:e.machine)&&void 0!==i?i:""),V(e.id)},children:(0,n.jsx)(A.Z,{})}),(0,n.jsx)(x.A,{onClick:()=>H(e.id),children:(0,n.jsx)(k.Z,{})})]})})]},e.id)})})]})}),(0,n.jsx)(m.u,{opened:e,onClose:i,title:"New Sub Category",children:(0,n.jsxs)("form",{onSubmit:ea.onSubmit(async e=>{let t=K?"Updated":"Added";try{let i=K?await F({id:K,...e}):await U(e);if("error"in i){var n,r,s;P().fire("Error",null!==(s=null==i?void 0:null===(r=i.error)||void 0===r?void 0:null===(n=r.data)||void 0===n?void 0:n.message)&&void 0!==s?s:"Something Went Wrong","error")}else P().fire("Success","Sub Category ".concat(t),"success")}catch(e){P().fire("Error","Something Went Wrong","error")}finally{V(null),i()}}),children:[(0,n.jsx)(p.TextInput,{withAsterisk:!0,label:"Name",placeholder:"Subcategory Name",...ea.getInputProps("name")},ea.key("name")),(0,n.jsx)(p.TextInput,{withAsterisk:!0,label:"Machine Name",placeholder:"Subcategory Machine Name",...ea.getInputProps("machine")},ea.key("machine")),(0,n.jsx)(o.Group,{justify:"flex-end",mt:"md",children:(0,n.jsx)(u.Button,{type:"submit",children:"Submit"})})]})}),(0,n.jsx)(m.u,{opened:b,onClose:()=>{O(),V(null),et([])},title:"Add Test to Sub Cat",size:"xl",children:(0,n.jsxs)(y.Z,{shadow:"lg",children:[(0,n.jsx)(c.Title,{children:"Add Test to SubCat"}),(0,n.jsx)(g.P,{label:"Select Sub Category",description:"",my:10,placeholder:"Pick an option",data:null!=ed?ed:[],limit:15,searchable:!0,withAsterisk:!0,variant:"default",clearable:!0,leftSection:(0,n.jsx)(E.Z,{}),rightSection:q?(0,n.jsx)(j.Loader,{size:18}):void 0,size:"lg",value:X,onChange:e=>Y(e),styles:{input:{backgroundColor:"white"}}}),(0,n.jsx)(f.N,{label:"Select Test",description:"You can select multiple tests",placeholder:"Pick an option",data:null!=J?J:[],limit:15,searchable:!0,withAsterisk:!0,renderOption:e=>{var t;let{option:i}=e;return(0,n.jsx)(o.Group,{gap:"sm",children:(0,n.jsxs)("div",{children:[(0,n.jsx)(l.Text,{size:"sm",children:i.label}),(0,n.jsx)(l.Text,{c:"indigo",fw:700,size:"xs",children:null==i?void 0:null===(t=i.subTestCategory)||void 0===t?void 0:t.name})]})})},variant:"default",clearable:!0,leftSection:(0,n.jsx)(N.Z,{}),rightSection:q?(0,n.jsx)(j.Loader,{size:18}):void 0,size:"lg",value:ee,onChange:et,styles:{input:{backgroundColor:"white"}}}),(0,n.jsx)(o.Group,{my:10,justify:"end",children:(0,n.jsx)(u.Button,{onClick:eo,disabled:0===ee.length||!X,children:"Submit"})})]})}),(0,n.jsx)(B,{opened:Z,onClose:M,subcategories:ec||[],handleBatchOrderUpdate:el,isLoading:er})]})}},7203:function(e,t,i){"use strict";var n=i(68328),r=i(14587);i(4505),t.Z=()=>(0,n.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:600},children:(0,n.jsx)(r.Loader,{color:"teal",variant:"dots"})})},72940:function(e,t,i){"use strict";i.d(t,{FD:function(){return r},Hn:function(){return n},y4:function(){return s}});let n={headers:{"Content-Type":"application/json"}},r={withCredentials:!0},s={headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}},37003:function(e,t,i){"use strict";i.d(t,{p:function(){return s}});var n=i(49854),r=i(67732);let s=async(e,t)=>{try{let i="test/admin",r=new URLSearchParams;e&&r.append("subTestCategoryId",e),void 0!==t&&r.append("isDoctorPayment",t.toString()),i+="?".concat(r.toString());let s=await (0,n.d)(i);return{success:!0,data:s.data}}catch(e){if(e instanceof r.d7){var i;return{success:!1,data:null===(i=e.response)||void 0===i?void 0:i.data.message}}return{success:!1,data:"An error occurred"}}}},72348:function(e,t,i){"use strict";i.d(t,{L:function(){return a}});var n=i(72940),r=i(6780),s=i(67732);let a=async e=>{try{let t=await r.default.patch("".concat("http://sasthotech.local:5000/api/v1","/test/multi"),e,{...n.FD,...n.Hn});return{success:!0,data:t.data.result}}catch(e){if(e instanceof s.d7){var t;return{success:!1,data:null===(t=e.response)||void 0===t?void 0:t.data.message}}return{success:!1,data:"An error occurred"}}}},78101:function(e,t,i){"use strict";i.d(t,{g:function(){return d}});var n=i(49854),r=i(68240),s=i(94183),a=i(28317);let d=(0,r.LC)({baseQuery:(0,s.ni)({baseUrl:"http://sasthotech.local:5000/api/v1",credentials:"include",fetchFn:(e,t)=>fetch(e,t).then(async i=>{let r="string"==typeof e?e:e.url;return r.includes("?")||(null==t?void 0:t.body)||"string"!=typeof e&&e.body||await (0,a.t8)(r,await i.clone().json().catch(()=>null),(0,n.x)()),i}).catch(async i=>{if(i instanceof TypeError){let i="string"==typeof e?e:e.url;if(!i.includes("?")&&!(null==t?void 0:t.body)&&!("string"!=typeof e&&e.body)){let e=await (0,a.U2)(i,(0,n.x)());if(e)return new Response(e,{headers:new Headers({"Content-Type":"application/json"})})}}throw i})}),endpoints:()=>({}),tagTypes:["BillTest","doctor","hospitalBill","inventory","appointment","patient","sms","sms-dashboard","sms-messages","sms-analytics","sms-status","notice","template","versionAdmin-services","versionAdmin-versions","versionAdmin-hospitals","versionAdmin-logs","versionAdmin-sessions","versionAdmin-devices","versionAdmin-notifications","versionAdmin-notification-stats","PCMeetup","MarketerTarget","Marketer"]})},45264:function(e,t,i){"use strict";i.d(t,{AK:function(){return r},ER:function(){return o},NW:function(){return d},R6:function(){return a},Xx:function(){return c},nZ:function(){return l}});let n=i(78101).g.injectEndpoints({endpoints:e=>({getSubcategories:e.query({query:()=>({url:"/subcategories"}),keepUnusedDataFor:86400,transformResponse:e=>(Array.isArray(null==e?void 0:e.data)&&e.data.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()),e)}),createSubcategory:e.mutation({query:e=>({url:"/subcategories",method:"POST",body:e}),async onQueryStarted(e,t){let{dispatch:i,queryFulfilled:r}=t,s=Date.now().toString(36),a=i(n.util.updateQueryData("getSubcategories",void 0,t=>{t.data.push({...e,id:s,loading:!0})}));try{let{data:e}=await r;i(n.util.updateQueryData("getSubcategories",void 0,t=>{let i=t.data.findIndex(e=>e.id===s);i>=0&&(t.data[i]=e.data)}))}catch(e){a.undo()}}}),updateSubcategory:e.mutation({query:e=>{let{id:t,...i}=e;return{url:"/subcategories/".concat(t),method:"PATCH",body:i}},async onQueryStarted(e,t){let{id:i,...r}=e,{dispatch:s,queryFulfilled:a}=t,d=s(n.util.updateQueryData("getSubcategories",void 0,e=>{let t=e.data.findIndex(e=>e.id===i);t>=0&&(e.data[t]={...e.data[t],...r})}));try{let{data:e}=await a;s(n.util.updateQueryData("getSubcategories",void 0,t=>{let n=t.data.findIndex(e=>e.id===i);n>=0&&(t.data[n]=e.data)}))}catch(e){d.undo()}}}),removeTestFromSubcategory:e.mutation({query:e=>{let{id:t}=e;return{url:"/subcategories/remove-test/".concat(t),method:"PATCH",body:{}}}}),updateSubcategoryOrder:e.mutation({query:e=>(console.log("here",e),{url:"/subcategories/update-order",method:"PATCH",body:e})}),deleteSubcategory:e.mutation({query:e=>({url:"/subcategories/".concat(e),method:"DELETE"}),async onQueryStarted(e,t){let{dispatch:i,queryFulfilled:r}=t,s=i(n.util.updateQueryData("getSubcategories",void 0,t=>{let i=t.data.find(t=>t.id===e);i&&(i.loading=!0)}));try{await r,i(n.util.updateQueryData("getSubcategories",void 0,t=>{let i=t.data.findIndex(t=>t.id===e);i>=0&&t.data.splice(i,1)}))}catch(e){s.undo()}}}),getSingleSubcategory:e.query({query:e=>({url:"/subcategories/".concat(e)})})})}),{useCreateSubcategoryMutation:r,useGetSingleSubcategoryQuery:s,useGetSubcategoriesQuery:a,useUpdateSubcategoryMutation:d,useDeleteSubcategoryMutation:o,useRemoveTestFromSubcategoryMutation:l,useUpdateSubcategoryOrderMutation:c}=n},49854:function(e,t,i){"use strict";let n;i.d(t,{d:function(){return l},x:function(){return o}});var r=i(72940),s=i(6780),a=i(67732),d=i(28317);function o(){return n||(n=(0,d.MT)("cached-responses-store","cached-responses")),n}async function l(e,t){try{let i=await s.default.get(e,{baseURL:"http://sasthotech.local:5000/api/v1",params:t,...r.FD});return await (0,d.t8)(e,i.data,o()),i.data}catch(t){if(t instanceof a.d7&&[a.d7.ERR_NETWORK,a.d7.ETIMEDOUT].includes(t.code)){let t=await (0,d.U2)(e,o());if(t)return t}throw t instanceof a.d7&&t.response&&401===t.response.status||console.error(t),t}}},18193:function(e){e.exports={container:"styles_container__sTk7J"}}},function(e){e.O(0,[1601,2975,3069,6945,3852,1656,9722,4670,9258,9533,966,12,7538,1166,7967,6029,6306,9645,4347,17,9175,7402,1744],function(){return e(e.s=38806)}),_N_E=e.O()}]);
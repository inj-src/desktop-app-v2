(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2369],{17532:function(e,t,n){Promise.resolve().then(n.bind(n,69962))},69962:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eq}});var i=n(68328),r=n(4505),a=n(41224),l=n(77303),s=n(22614),o=n(68242),d=n(11114),c=n(31204),u=n(13342),h=n(59832),m=n(9654),p=n(54632),x=n(72375),v=n(76029),g=n(3741),j=n(22041),y=n(7140),T=n(84228),f=n(75707),b=n(12697),S=n(52387),C=n(75865),k=n(25299),w=n(31151),I=n(18190),E=n(54481),P=n(45437),z=n(58950),D=n(38156),A=n(22975),O=n(89043),q=n(55911),B=n(29663),N=n(57956),G=n(29259),L=n(81209),R=n(76283),_=n(67961),F=n(91166);function U(e){let{label:t,placeholder:n,value:a,onChange:l,data:o,required:d}=e,c=(0,_.K)({onDropdownClose:()=>c.resetSelectedOption()}),[u,h]=(0,r.useState)(a);(0,r.useEffect)(()=>{h(a)},[a]);let p=!o.some(e=>e.toLowerCase()===u.toLowerCase().trim()),x=(p?o.filter(e=>e.toLowerCase().includes(u.toLowerCase().trim())):o).map(e=>(0,i.jsx)(F.h.Option,{value:e,children:e},e));return(0,i.jsxs)(F.h,{store:c,withinPortal:!1,onOptionSubmit:e=>{h(e),l(e),c.closeDropdown()},children:[(0,i.jsx)(F.h.Target,{children:(0,i.jsx)(q.TextInput,{label:t,placeholder:n,value:u,onChange:e=>{h(e.currentTarget.value),c.openDropdown(),c.updateSelectedOptionIndex()},onClick:()=>c.openDropdown(),onFocus:()=>c.openDropdown(),onBlur:()=>{c.closeDropdown(),h(a)},rightSection:(0,i.jsx)(F.h.Chevron,{}),rightSectionPointerEvents:"none",required:d})}),(0,i.jsx)(F.h.Dropdown,{children:(0,i.jsxs)(F.h.Options,{children:[x,p&&u.trim().length>0&&(0,i.jsx)(F.h.Option,{value:u.trim(),children:(0,i.jsxs)(s.Group,{gap:"sm",children:[(0,i.jsx)(m.Z,{size:16}),(0,i.jsxs)(j.Text,{size:"sm",children:['Create "',u.trim(),'"']})]})})]})})]})}let Z=["pcs","box","bottle","tablet","ml","mg","g","kg","l","pack"];function M(e){var t,n,o,d,u;let{opened:h,onClose:m,onSubmit:p,initialData:x,loading:v,title:g,actionLabel:y}=e,[T,f]=(0,r.useState)((null==x?void 0:x.name)||""),[b,S]=(0,r.useState)((null==x?void 0:x.code)||""),[C,k]=(0,r.useState)((null==x?void 0:x.description)||""),[w,I]=(0,r.useState)((null==x?void 0:x.category)||""),[E,P]=(0,r.useState)((null==x?void 0:x.unit)||"pcs"),[z,D]=(0,r.useState)((null==x?void 0:x.manufacturer)||""),[_,F]=(0,r.useState)((null==x?void 0:x.costPrice)||0),[M,X]=(0,r.useState)((null==x?void 0:x.sellingPrice)||0),[Y,Q]=(0,r.useState)((null==x?void 0:x.minimumStock)||100),[W,H]=(0,r.useState)(null===(t=null==x?void 0:x.isSellable)||void 0===t||t),[V,K]=(0,r.useState)(null!==(n=null==x?void 0:x.isConsumable)&&void 0!==n&&n),[J,$]=(0,r.useState)(null===(o=null==x?void 0:x.isActive)||void 0===o||o),[ee,et]=(0,r.useState)(null!==(d=null==x?void 0:x.expiryTracked)&&void 0!==d&&d),[en,ei]=(0,r.useState)(null!==(u=null==x?void 0:x.batchTracked)&&void 0!==u&&u),[er,ea]=(0,r.useState)((null==x?void 0:x.expiryAlertDays)||30);return(0,r.useEffect)(()=>{if(h){var e,t,n,i,r;f((null==x?void 0:x.name)||""),S((null==x?void 0:x.code)||""),k((null==x?void 0:x.description)||""),I((null==x?void 0:x.category)||""),P((null==x?void 0:x.unit)||"pcs"),D((null==x?void 0:x.manufacturer)||""),F((null==x?void 0:x.costPrice)||0),X((null==x?void 0:x.sellingPrice)||0),Q((null==x?void 0:x.minimumStock)||100),H(null===(e=null==x?void 0:x.isSellable)||void 0===e||e),K(null!==(t=null==x?void 0:x.isConsumable)&&void 0!==t&&t),$(null===(n=null==x?void 0:x.isActive)||void 0===n||n),et(null!==(i=null==x?void 0:x.expiryTracked)&&void 0!==i&&i),ei(null!==(r=null==x?void 0:x.batchTracked)&&void 0!==r&&r),ea((null==x?void 0:x.expiryAlertDays)||30)}},[h,x]),(0,i.jsx)(A.u,{opened:h,onClose:m,title:g||"Update Item",size:"lg",centered:!0,styles:{body:{maxHeight:"70vh",overflowY:"auto"}},children:(0,i.jsxs)(a.Stack,{gap:"lg",children:[(0,i.jsxs)(O.X,{withBorder:!0,p:"md",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Basic Information"}),(0,i.jsxs)(a.Stack,{gap:"md",children:[(0,i.jsx)(q.TextInput,{label:"Item Name",placeholder:"Enter item name",value:T,onChange:e=>f(e.currentTarget.value),required:!0,withAsterisk:!0}),(0,i.jsxs)(B.Grid,{children:[(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(q.TextInput,{label:"Item Code",placeholder:"SKU or code",value:b,onChange:e=>S(e.currentTarget.value)})}),(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(q.TextInput,{label:"Category",placeholder:"e.g., Medicine, Equipment",value:w,onChange:e=>I(e.currentTarget.value)})})]}),(0,i.jsxs)(B.Grid,{children:[(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(U,{label:"Unit",placeholder:"Select or create unit",value:E,onChange:P,data:Z})}),(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(q.TextInput,{label:"Manufacturer",placeholder:"Manufacturer name",value:z,onChange:e=>D(e.currentTarget.value)})})]}),(0,i.jsx)(N.g,{label:"Description",placeholder:"Item description",value:C,onChange:e=>k(e.currentTarget.value),minRows:2,maxRows:4})]})]}),(null==x?void 0:x.availableStock)!==void 0&&(0,i.jsxs)(O.X,{withBorder:!0,p:"md",bg:"gray.0",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Current Stock"}),(0,i.jsx)(G.Y,{label:"Available Stock",value:x.availableStock,disabled:!0,description:"Stock changes are tracked through transaction logs"})]}),(0,i.jsxs)(O.X,{withBorder:!0,p:"md",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Pricing & Stock Settings"}),(0,i.jsxs)(B.Grid,{children:[(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(G.Y,{label:"Cost Price",placeholder:"0.00",value:Number(_),onChange:F,min:0,decimalScale:2,prefix:"৳"})}),(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(G.Y,{label:"Selling Price",placeholder:"0.00",value:Number(M),onChange:X,min:0,decimalScale:2,prefix:"৳"})}),(0,i.jsx)(B.Grid.Col,{span:12,children:(0,i.jsx)(G.Y,{label:"Minimum Stock Alert Level",placeholder:"100",value:Number(Y),onChange:Q,min:0,description:"Alert when stock falls below this level"})})]})]}),(0,i.jsxs)(O.X,{withBorder:!0,p:"md",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Item Properties"}),(0,i.jsxs)(a.Stack,{gap:"sm",children:[(0,i.jsx)(L.r,{label:"Sellable Item",description:"Can this item be sold to customers?",checked:W,onChange:e=>H(e.currentTarget.checked)}),(0,i.jsx)(L.r,{label:"Consumable Item",description:"Is this item consumed during use?",checked:V,onChange:e=>K(e.currentTarget.checked)}),(0,i.jsx)(L.r,{label:"Active",description:"Is this item currently active?",checked:J,onChange:e=>$(e.currentTarget.checked)})]})]}),(0,i.jsxs)(O.X,{withBorder:!0,p:"md",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Tracking Options"}),(0,i.jsxs)(a.Stack,{gap:"sm",children:[(0,i.jsx)(L.r,{label:"Track Expiry Dates",description:"Enable expiry date tracking for this item",checked:ee,onChange:e=>et(e.currentTarget.checked)}),(0,i.jsx)(L.r,{label:"Track Batches",description:"Enable batch number tracking for this item",checked:en,onChange:e=>ei(e.currentTarget.checked)})]})]}),ee&&(0,i.jsxs)(O.X,{withBorder:!0,p:"md",bg:"blue.0",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Expiry Alert Settings"}),(0,i.jsx)(G.Y,{label:"Alert Days Before Expiry",placeholder:"30",value:Number(er),onChange:ea,min:1,description:"Days before expiry to show alerts"})]}),(0,i.jsx)(l.Divider,{}),(0,i.jsxs)(s.Group,{justify:"right",children:[(0,i.jsx)(c.Button,{variant:"default",onClick:m,disabled:v,children:"Cancel"}),(0,i.jsx)(c.Button,{leftSection:(0,i.jsx)(R.Z,{size:16}),onClick:()=>{T.trim()&&p({name:T.trim(),code:b.trim()||void 0,description:C.trim()||void 0,category:w.trim()||void 0,unit:E||"pcs",manufacturer:z.trim()||void 0,costPrice:Number(_)||void 0,sellingPrice:Number(M)||void 0,minimumStock:Number(Y)||100,isSellable:W,isConsumable:V,isActive:J,expiryTracked:ee,batchTracked:en,expiryAlertDays:ee?Number(er):30})},loading:v,disabled:!T.trim()||v,children:y||"Update Item"})]})]})})}function X(e){let{itemId:t,opened:n,onClose:r}=e,[a,{isLoading:l}]=(0,S.fv)(),{data:s,isLoading:o}=(0,S.bM)(t,{skip:!n}),d=async e=>{try{await a({id:t,...e}).unwrap(),w.toast.success("Item updated successfully!"),r()}catch(e){var n;console.error("Failed to update item:",e),w.toast.error("Failed to update item",{description:(null===(n=e.data)||void 0===n?void 0:n.message)||"Please try again"})}};return(0,i.jsx)(M,{opened:n,onClose:r,onSubmit:d,initialData:null==s?void 0:s.data,loading:l||o,actionLabel:"Update Item",title:"Update Inventory Item"})}var Y=n(87967);function Q(e){let{opened:t,onClose:n,itemId:l,storeId:o,onSuccess:d}=e,[u,h]=(0,r.useState)(0),[m,p]=(0,r.useState)(null),[x,v]=(0,r.useState)(""),[g,{isLoading:y}]=(0,S.fF)(),{data:T}=(0,S.bM)(l,{skip:!t}),{data:f}=(0,S.zQ)(void 0,{skip:!t}),b=null==T?void 0:T.data,C=(null==f?void 0:f.data)||[];(0,r.useEffect)(()=>{t&&(h(0),p(null),v(""))},[t]);let k=async()=>{let e=Number(u);if(!(e<=0)&&!(e>((null==b?void 0:b.availableStock)||0)))try{await g({itemId:l,storeId:o,quantity:e,doneByUserId:m||void 0,reason:x||void 0}).unwrap(),w.toast.success("Stock deducted successfully!"),null==d||d(),n()}catch(e){var t;console.error("Failed to deduct stock:",e),w.toast.error("Failed to deduct stock",{description:(null===(t=e.data)||void 0===t?void 0:t.message)||"Please try again"})}};return(0,i.jsx)(A.u,{opened:t,onClose:n,title:"Deduct Stock - ".concat((null==b?void 0:b.name)||"Item"),size:"md",centered:!0,children:(0,i.jsxs)(a.Stack,{gap:"md",children:[(null==b?void 0:b.availableStock)!==void 0&&(0,i.jsxs)(j.Text,{size:"sm",c:"dimmed",children:["Current Stock: ",null==b?void 0:b.availableStock]}),(0,i.jsx)(G.Y,{label:"Quantity to Deduct",placeholder:"Enter quantity",value:u,onChange:h,min:1,max:null==b?void 0:b.availableStock,required:!0}),(0,i.jsx)(Y.P,{label:"Done By User",placeholder:"Select user (optional)",value:m,onChange:p,data:C.map(e=>({value:e.id,label:"".concat(e.name||e.email," (").concat(e.role,")")})),searchable:!0,clearable:!0}),(0,i.jsx)(N.g,{label:"Reason",placeholder:"Enter reason for deduction (optional)",value:x,onChange:e=>v(e.currentTarget.value),minRows:2,maxRows:4}),(0,i.jsxs)(s.Group,{justify:"right",mt:"md",children:[(0,i.jsx)(c.Button,{variant:"default",onClick:n,disabled:y,children:"Cancel"}),(0,i.jsx)(c.Button,{leftSection:(0,i.jsx)(z.Z,{size:16}),onClick:k,loading:y,disabled:0>=Number(u)||Number(u)>((null==b?void 0:b.availableStock)||0)||y,children:y?"Deducting...":"Deduct Stock"})]})]})})}var W=n(71996);function H(e){var t,n;let{opened:l,onClose:o,itemId:d,storeId:u,onSuccess:h}=e,[p,v]=(0,r.useState)(0),[g,y]=(0,r.useState)(0),[T,f]=(0,r.useState)(null),[b,C]=(0,r.useState)(null),[k,I]=(0,r.useState)(""),[E,P]=(0,r.useState)(""),[z,D]=(0,r.useState)(!1),[B,N]=(0,r.useState)(!1),[L,{isLoading:R}]=(0,S.fp)(),{data:_}=(0,S.bM)(d,{skip:!l});(0,r.useEffect)(()=>{l&&(v(0),y(0),f(null),C(null),I(""),P(""),D(!1),N(!1))},[l]);let F=async()=>{let e=Number(p),t=Number(g);if(!(e<=0)&&!(t<0))try{await L({itemId:d,storeId:u,quantity:e,unitCost:t,expiryDate:T||void 0,manufactureDate:b||void 0,minimumStock:k?Number(k):void 0,batchNumber:E||void 0,addToIndoorExpenses:z,addToOutdoorExpenses:B}).unwrap(),w.toast.success("Stock added successfully!"),null==h||h(),o()}catch(e){var n;console.error("Failed to add stock:",e),w.toast.error("Failed to add stock",{description:(null===(n=e.data)||void 0===n?void 0:n.message)||"Please try again"})}};return(0,i.jsx)(A.u,{opened:l,onClose:o,title:"Add Stock - ".concat((null==_?void 0:null===(t=_.data)||void 0===t?void 0:t.name)||"Item"),size:"lg",centered:!0,children:(0,i.jsxs)(a.Stack,{gap:"md",children:[(0,i.jsxs)(j.Text,{children:["In stock: ",null==_?void 0:null===(n=_.data)||void 0===n?void 0:n.availableStock]}),(0,i.jsx)(G.Y,{label:"Quantity to Add",placeholder:"Enter quantity",value:p,onChange:v,min:1,required:!0}),(0,i.jsx)(G.Y,{label:"Unit Cost",placeholder:"Enter cost price",value:g,onChange:y,min:0,required:!0}),(0,i.jsx)(q.TextInput,{label:"Batch Number",placeholder:"Enter batch number (optional)",value:E,onChange:e=>P(e.currentTarget.value)}),(0,i.jsx)(W.W,{label:"Manufacture Date",placeholder:"Select manufacture date (optional)",value:b,onChange:C,clearable:!0}),(0,i.jsx)(W.W,{label:"Expiry Date",placeholder:"Select expiry date (optional)",value:T,onChange:f,clearable:!0,minDate:b||void 0}),(0,i.jsx)(G.Y,{label:"Minimum Stock Level",placeholder:"Enter minimum stock level (optional)",value:k,onChange:I,min:0,description:"Alert threshold for low stock"}),(0,i.jsx)(O.X,{withBorder:!0,p:"md",bg:"gray.0",children:(0,i.jsxs)(a.Stack,{gap:"sm",children:[(0,i.jsx)(j.Text,{size:"sm",fw:500,children:"Expense Tracking"}),(0,i.jsx)(x.X,{label:"Add to Indoor Expenses",description:"Include this stock value in indoor department expenses",checked:z,onChange:e=>{e.currentTarget.checked?(D(!0),N(!1)):D(!1)}}),(0,i.jsx)(x.X,{label:"Add to Outdoor Expenses",description:"Include this stock value in outdoor department expenses",checked:B,onChange:e=>{e.currentTarget.checked?(N(!0),D(!1)):N(!1)}})]})}),(0,i.jsxs)(s.Group,{justify:"right",mt:"md",children:[(0,i.jsx)(c.Button,{variant:"default",onClick:o,disabled:R,children:"Cancel"}),(0,i.jsx)(c.Button,{leftSection:(0,i.jsx)(m.Z,{size:16}),onClick:F,loading:R,disabled:0>=Number(p)||0>Number(g)||R,children:R?"Adding...":"Add Stock"})]})]})})}var V=n(14587),K=n(46373),J=n(53502),$=n(36760);function ee(e){var t,n;let{opened:l,onClose:o,itemId:d,itemIds:u,onSuccess:h}=e,[m,{isLoading:p}]=(0,S.OB)(),x=(0,J.v9)(e=>e.tests),{data:v}=(0,$.VR)({}),g=u&&u.length>0,j=g?u:d?[d]:[],[y,T]=(0,r.useState)(null),[f,b]=(0,r.useState)(),[C,k]=(0,r.useState)(),[I,E]=(0,r.useState)(),[P,z]=(0,r.useState)();(0,r.useEffect)(()=>{l&&(T(null),b(""),z(""),E(void 0),k(""))},[l]);let D=async()=>{try{if(!y)throw Error("Trigger type is required");if(0===j.length)throw Error("No items selected");let e=j.map(e=>m({itemId:e,triggerType:y,testId:f,operationId:C,completionThreshold:Number(I),description:P}).unwrap());await Promise.all(e);let t=g?"Created policies for ".concat(j.length," item(s)"):"Deduction policy created successfully!";w.toast.success(t),null==h||h(),o()}catch(t){var e;w.toast.error("Failed to create policy",{description:(null===(e=t.data)||void 0===e?void 0:e.message)||"Please try again"})}};return(0,i.jsx)(A.u,{opened:l,onClose:o,title:g?"Create Deduction Policy for ".concat(j.length," Item(s)"):"Create Deduction Policy",size:"md",centered:!0,children:(0,i.jsxs)(a.Stack,{gap:"md",children:[(0,i.jsx)(Y.P,{label:"Trigger Type",placeholder:"Select trigger type",data:[{value:"TEST_COMPLETION",label:"Test Completion"},{value:"OPERATION",label:"Operation"},{value:"OUTDOOR_BILL",label:"Outdoor Bill"},{value:"CUSTOM",label:"Custom"}],value:y,onChange:e=>T(e),required:!0}),("TEST_COMPLETION"===y||"OUTDOOR_BILL"===y)&&(0,i.jsx)(Y.P,{label:"Test",searchable:!0,placeholder:"Select test",data:null==x?void 0:null===(t=x.adminTests)||void 0===t?void 0:t.map(e=>({value:e.id,label:e.name})),value:f,onChange:e=>b(e||""),required:!0}),"OPERATION"===y&&(0,i.jsx)(Y.P,{label:"Operation",searchable:!0,placeholder:"Select operation",data:null==v?void 0:null===(n=v.data.operations)||void 0===n?void 0:n.map(e=>({value:e.id,label:e.name})),value:C,onChange:e=>k(e||""),required:!0}),(0,i.jsx)(G.Y,{label:"Completion Threshold",placeholder:"Enter threshold",value:I,onChange:E,min:0,step:.1,decimalScale:2,required:!0}),(0,i.jsxs)(s.Group,{justify:"right",mt:"md",children:[(0,i.jsx)(c.Button,{variant:"default",onClick:o,disabled:p,children:"Cancel"}),(0,i.jsx)(c.Button,{onClick:D,loading:p,disabled:!y||!I||0>Number(I)||p,children:"Create Policy"})]})]})})}var et=n(48604);function en(e){var t;let{policy:n,opened:l,onClose:o}=e,[d,{isLoading:u}]=(0,S.aS)(),[h,m]=(0,r.useState)(),[p,x]=(0,r.useState)("");(0,r.useEffect)(()=>{l&&n&&(m(n.completionThreshold),x(n.description||""))},[l,n]);let v=async()=>{try{if(!h)throw Error("Completion threshold is required");await d({itemId:n.itemId,policyId:n.id,completionThreshold:Number(h),description:p||void 0}).unwrap(),w.toast.success("Deduction policy updated successfully!"),o()}catch(t){var e;w.toast.error("Failed to update policy",{description:(null===(e=t.data)||void 0===e?void 0:e.message)||"Please try again"})}};return(0,i.jsx)(A.u,{opened:l,onClose:o,title:"Update Deduction Policy",size:"md",centered:!0,children:(0,i.jsxs)(a.Stack,{gap:"md",children:[(0,i.jsx)(Y.P,{label:"Trigger Type",placeholder:n.triggerType,disabled:!0,required:!0}),("TEST_COMPLETION"===n.triggerType||"OUTDOOR_BILL"===n.triggerType)&&(0,i.jsx)(Y.P,{label:"Test",searchable:!0,placeholder:null===(t=n.test)||void 0===t?void 0:t.name,disabled:!0,required:!0}),(0,i.jsx)(G.Y,{label:"Completion Threshold",placeholder:"Enter threshold",value:h,onChange:m,min:0,step:.1,decimalScale:2,required:!0}),(0,i.jsxs)(s.Group,{justify:"right",mt:"md",children:[(0,i.jsx)(c.Button,{variant:"default",onClick:o,disabled:u,children:"Cancel"}),(0,i.jsx)(c.Button,{onClick:v,loading:u,disabled:!h||0>Number(h)||u,children:"Update Policy"})]})]})})}function ei(e){var t;let{policy:n}=e,[l,o]=(0,r.useState)(!1),[c,{isLoading:u}]=(0,S.a)();return(0,i.jsxs)(et.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,w:"100%",children:[(0,i.jsx)(d.C,{color:"blue",variant:"light",mb:"sm",children:null===(t=n.triggerType)||void 0===t?void 0:t.split("_").join(" ")}),(0,i.jsxs)(s.Group,{justify:"space-between",align:"top",children:[(0,i.jsxs)(a.Stack,{gap:4,children:[n.test&&(0,i.jsxs)(j.Text,{size:"sm",children:[(0,i.jsx)(j.Text,{span:!0,size:"sm",c:"dimmed",fw:600,mr:6,children:"Test:"}),n.test.name]}),n.operation&&(0,i.jsxs)(j.Text,{size:"sm",children:[(0,i.jsx)(j.Text,{span:!0,size:"sm",c:"dimmed",fw:600,mr:6,children:"Operation:"}),n.operation.name]}),(0,i.jsxs)(j.Text,{size:"sm",children:[(0,i.jsx)(j.Text,{span:!0,size:"sm",c:"dimmed",fw:600,mr:6,children:"Threshold:"}),n.completionThreshold]})]}),(0,i.jsxs)(s.Group,{justify:"right",gap:"xs",children:[(0,i.jsx)(g.A,{variant:"light",color:"blue",onClick:()=>o(!0),"aria-label":"Edit",children:(0,i.jsx)(P.Z,{size:16})}),(0,i.jsx)(g.A,{variant:"light",color:"red",onClick:()=>{k.qk.openConfirmModal({title:"Delete Deduction Policy",centered:!0,children:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:"Are you sure you want to delete this deduction policy?"}),(0,i.jsx)("p",{children:"This action cannot be undone."})]}),labels:{confirm:"Delete",cancel:"Cancel"},confirmProps:{color:"red"},onConfirm:async()=>{try{await c({itemId:n.itemId,policyId:n.id}).unwrap(),w.toast.success("Deduction policy deleted successfully")}catch(e){w.toast.error("Failed to delete deduction policy")}}})},disabled:u,"aria-label":"Delete",children:(0,i.jsx)(b.Z,{size:16})})]})]}),(0,i.jsx)(en,{policy:n,opened:l,onClose:()=>o(!1)})]})}var er=n(4938);function ea(e){var t,n,l;let{itemId:o,opened:d,onClose:u}=e,{data:h,isLoading:m,error:p}=(0,S.aB)(o,{skip:!d}),[x,v]=(0,r.useState)(!1);return(0,i.jsxs)(a.Stack,{children:[(0,i.jsx)(A.u,{opened:d,onClose:u,title:"Deduction Policies for ".concat((null==h?void 0:null===(n=h.data)||void 0===n?void 0:null===(t=n.item)||void 0===t?void 0:t.name)||"Item"),centered:!0,size:"lg",children:(0,i.jsxs)(a.Stack,{mih:300,children:[m&&(0,i.jsx)(V.Loader,{m:"auto"}),p&&(0,i.jsx)(K.b,{color:"red",title:"Error",children:"Failed to load deduction policies."}),(null==h?void 0:null===(l=h.data)||void 0===l?void 0:l.policies.length)?(0,i.jsx)(a.Stack,{gap:"sm",children:h.data.policies.map(e=>(0,i.jsx)(ei,{policy:e},e.id))}):!m&&(0,i.jsxs)(a.Stack,{gap:"md",align:"center",justify:"center",m:"auto",children:[(0,i.jsx)(er.Z,{size:72,color:"gray"}),(0,i.jsxs)(j.Text,{c:"dimmed",ta:"center",m:"auto",children:["No deduction policies found for this item. ",(0,i.jsx)("br",{}),"Add one using the create button."]})]}),(0,i.jsxs)(s.Group,{justify:"right",mt:"auto",children:[(0,i.jsx)(c.Button,{variant:"default",onClick:u,children:"Cancel"}),(0,i.jsx)(c.Button,{onClick:()=>v(!0),children:"Create"})]})]})}),(0,i.jsx)(ee,{opened:x,onClose:()=>v(!1),itemId:o})]})}var el=n(13916),es=n(97698);function eo(e){var t,n;let{opened:r,onClose:l,itemId:o,itemName:c}=e,{data:u,isLoading:h,error:m}=(0,S.Cf)({itemId:o},{skip:!r}),x=(null==u?void 0:null===(t=u.data)||void 0===t?void 0:t.batches)||[],v=null==u?void 0:null===(n=u.data)||void 0===n?void 0:n.summary,g=e=>e.stockStatus.isOutOfStock?"red":e.stockStatus.isLowStock?"yellow":"green",y=e=>e.expiryStatus.isExpired?"red":e.expiryStatus.isExpiringSoon?"orange":"gray",T=e=>{if(!e)return"N/A";try{return(0,es.Z)(new Date(e),"MMM dd, yyyy")}catch(e){return"Invalid date"}};return(0,i.jsx)(A.u,{opened:r,onClose:l,title:"Batches - ".concat(c||"Item"),size:"xl",centered:!0,children:(0,i.jsxs)(a.Stack,{gap:"md",children:[v&&(0,i.jsxs)(s.Group,{gap:"lg",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(j.Text,{size:"xs",c:"dimmed",children:"Total Batches"}),(0,i.jsx)(j.Text,{fw:600,children:v.totalBatches})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(j.Text,{size:"xs",c:"dimmed",children:"With Stock"}),(0,i.jsx)(j.Text,{fw:600,c:"green",children:v.batchesWithStock})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(j.Text,{size:"xs",c:"dimmed",children:"Out of Stock"}),(0,i.jsx)(j.Text,{fw:600,c:"red",children:v.batchesOutOfStock})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(j.Text,{size:"xs",c:"dimmed",children:"Total Value"}),(0,i.jsxs)(j.Text,{fw:600,children:["৳",v.totalStockValue.toFixed(2)]})]})]}),h?(0,i.jsx)(j.Text,{c:"dimmed",ta:"center",py:"xl",children:"Loading batches..."}):m?(0,i.jsx)(K.b,{icon:(0,i.jsx)(el.Z,{size:16}),title:"Error",color:"red",children:"Failed to load batches. Please try again."}):0===x.length?(0,i.jsx)(K.b,{icon:(0,i.jsx)(el.Z,{size:16}),title:"No Batches",color:"blue",children:"No batches found for this item."}):(0,i.jsxs)(p.i,{highlightOnHover:!0,striped:!0,withTableBorder:!0,children:[(0,i.jsx)(p.i.Thead,{children:(0,i.jsxs)(p.i.Tr,{children:[(0,i.jsx)(p.i.Th,{children:"Batch Number"}),(0,i.jsx)(p.i.Th,{children:"Store"}),(0,i.jsx)(p.i.Th,{children:"Available Stock"}),(0,i.jsx)(p.i.Th,{children:"Manufacture Date"}),(0,i.jsx)(p.i.Th,{children:"Expiry Date"}),(0,i.jsx)(p.i.Th,{children:"Stock Value"}),(0,i.jsx)(p.i.Th,{children:"Status"})]})}),(0,i.jsx)(p.i.Tbody,{children:x.map(e=>(0,i.jsxs)(p.i.Tr,{children:[(0,i.jsx)(p.i.Td,{children:(0,i.jsx)(j.Text,{size:"sm",fw:500,children:e.batchNumber||"N/A"})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)(a.Stack,{gap:2,children:[(0,i.jsx)(j.Text,{size:"sm",children:e.store.name}),e.store.location&&(0,i.jsx)(j.Text,{size:"xs",c:"dimmed",children:e.store.location})]})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)(a.Stack,{gap:2,children:[(0,i.jsxs)(j.Text,{size:"sm",fw:500,children:[e.stock.available," ",e.item.unit]}),(0,i.jsxs)(j.Text,{size:"xs",c:"dimmed",children:["Reserved: ",e.stock.reserved]})]})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsx)(j.Text,{size:"sm",children:T(e.manufactureDate)})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)(a.Stack,{gap:2,children:[(0,i.jsx)(j.Text,{size:"sm",children:T(e.expiryDate)}),null!==e.expiryStatus.daysUntilExpiry&&(0,i.jsxs)(j.Text,{size:"xs",c:"dimmed",children:[e.expiryStatus.daysUntilExpiry," days left"]})]})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)(j.Text,{size:"sm",children:["৳",e.stockValue.toFixed(2)]})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)(s.Group,{gap:"xs",children:[(0,i.jsx)(d.C,{size:"sm",color:g(e),children:e.stockStatus.isOutOfStock?"Out of Stock":e.stockStatus.isLowStock?"Low Stock":"In Stock"}),e.expiryStatus.hasExpiry&&(0,i.jsx)(d.C,{size:"sm",color:y(e),children:e.expiryStatus.isExpired?"Expired":e.expiryStatus.isExpiringSoon?"Expiring Soon":"Valid"})]})})]},e.id))})]})]})})}function ed(e){let{storeId:t,itemId:n,itemName:a,deductionPolicyModelIdState:l}=e,[o,{isLoading:d}]=(0,S.Xz)(),[c,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),[x,v]=(0,r.useState)(!1),[j,y]=(0,r.useState)(!1),[T,f]=l;return(0,i.jsxs)(s.Group,{gap:"xs",children:[(0,i.jsx)(g.A,{variant:"light",color:"blue",size:"sm",title:"Add stock",onClick:()=>u(!0),children:(0,i.jsx)(m.Z,{size:16})}),(0,i.jsxs)(C.v,{shadow:"md",width:200,children:[(0,i.jsx)(C.v.Target,{children:(0,i.jsx)(g.A,{variant:"light",size:"sm",children:(0,i.jsx)(I.Z,{size:16})})}),(0,i.jsxs)(C.v.Dropdown,{children:[(0,i.jsx)(C.v.Item,{leftSection:(0,i.jsx)(E.Z,{size:14}),onClick:()=>y(!0),children:"View Batches"}),(0,i.jsx)(C.v.Item,{leftSection:(0,i.jsx)(P.Z,{size:14}),onClick:()=>p(!0),children:"Edit"}),(0,i.jsx)(C.v.Item,{leftSection:(0,i.jsx)(z.Z,{size:14}),onClick:()=>v(!0),children:"Deduct"}),(0,i.jsx)(C.v.Item,{leftSection:(0,i.jsx)(D.Z,{size:14}),onClick:()=>f(n),children:"Deduction Policy"}),(0,i.jsx)(C.v.Divider,{}),(0,i.jsx)(C.v.Item,{leftSection:(0,i.jsx)(b.Z,{size:14}),color:"red",onClick:()=>{k.qk.openConfirmModal({title:"Delete Inventory Item",centered:!0,children:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:"Are you sure you want to delete this inventory item?"}),(0,i.jsx)("p",{children:"This action cannot be undone."})]}),labels:{confirm:"Delete",cancel:"Cancel"},confirmProps:{color:"red"},onConfirm:async()=>{try{await o(n).unwrap(),w.toast.success("Inventory item deleted successfully")}catch(e){w.toast.error("Failed to delete inventory item")}}})},disabled:d,children:d?"Deleting...":"Delete"})]})]}),(0,i.jsx)(H,{storeId:t,itemId:n,opened:c,onClose:()=>u(!1)}),(0,i.jsx)(X,{itemId:n,opened:h,onClose:()=>p(!1)}),(0,i.jsx)(Q,{opened:x,onClose:()=>v(!1),itemId:n,storeId:t}),(0,i.jsx)(ea,{itemId:n,opened:T==n,onClose:()=>f(void 0)}),(0,i.jsx)(eo,{itemId:n,itemName:a,opened:j,onClose:()=>y(!1)})]})}var ec=n(89123);function eu(e){var t;let{storeId:n}=e,{getTypedParam:l,updateUrlParam:o}=(0,ec.G)(),[d,c]=(0,r.useState)(()=>l("inventory_page",1)),u=(0,r.useState)(),[h,m]=(0,r.useState)([]),[C,k]=(0,r.useState)(!1),[I]=(0,S.Xz)(),{data:E,isLoading:P,error:z}=(0,S.WK)({page:d,limit:25,storeId:n}),D=(null==E?void 0:E.data)||[],A=(null==E?void 0:null===(t=E.pagination)||void 0===t?void 0:t.totalPages)||1,O=e=>{e?m(D.map(e=>e.id)):m([])},q=(e,t)=>{t?m(t=>[...t,e]):m(t=>t.filter(t=>t!==e))},B=D.length>0&&h.length===D.length,N=h.length>0&&h.length<D.length,G=async()=>{if(0!==h.length&&window.confirm("Are you sure you want to delete ".concat(h.length," item(s)? This action cannot be undone.")))try{let e=h.map(e=>I(e).unwrap());await Promise.all(e),w.toast.success("Successfully deleted ".concat(h.length," item(s)")),m([])}catch(t){var e;w.toast.error("Failed to delete some items",{description:(null===(e=t.data)||void 0===e?void 0:e.message)||"Please try again"})}},L=()=>{0!==h.length&&k(!0)},R=e=>{let{children:t}=e;return(0,i.jsx)(p.i.Tr,{children:(0,i.jsx)(p.i.Td,{colSpan:6,children:(0,i.jsx)(j.Text,{c:"dimmed",ta:"center",size:"sm",py:"md",children:t})})})},_=e=>{var t,r;let{item:l}=e,{hovered:s,ref:o}=(0,T.X)(),d=l.availableStock,c=h.includes(l.id),m=s||c;return(0,i.jsxs)(p.i.Tr,{ref:o,children:[(0,i.jsx)(p.i.Td,{children:(0,i.jsx)(x.X,{checked:c,onChange:e=>q(l.id,e.currentTarget.checked),"aria-label":"Select ".concat(l.name),hidden:!m})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)(a.Stack,{gap:2,children:[(0,i.jsx)(j.Text,{fw:600,size:"sm",children:l.name}),l.description&&(0,i.jsx)(j.Text,{size:"xs",c:"dimmed",children:l.description})]})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsx)(j.Text,{size:"sm",children:d})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)(j.Text,{size:"sm",children:["৳",(null===(t=l.costPrice)||void 0===t?void 0:t.toFixed(2))||"0.00"]})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)(j.Text,{size:"sm",children:["৳",(null===(r=l.sellingPrice)||void 0===r?void 0:r.toFixed(2))||"0.00"]})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsx)(ed,{storeId:n,itemId:l.id,itemName:l.name,deductionPolicyModelIdState:u})})]},l.id)};return(0,i.jsxs)(a.Stack,{gap:"md",children:[(0,i.jsxs)(p.i,{highlightOnHover:!0,striped:!0,withTableBorder:!0,children:[(0,i.jsx)(()=>{let{hovered:e,ref:t}=(0,T.X)(),n=e||h.length>0;return(0,i.jsx)(p.i.Thead,{ref:t,children:(0,i.jsxs)(p.i.Tr,{children:[(0,i.jsx)(p.i.Th,{style:{width:0},children:(0,i.jsx)(x.X,{checked:B,indeterminate:N,onChange:e=>O(e.currentTarget.checked),"aria-label":"Select all items",hidden:!n||0===D.length})}),(0,i.jsx)(p.i.Th,{children:"Name"}),(0,i.jsx)(p.i.Th,{children:"Available"}),(0,i.jsx)(p.i.Th,{children:"Cost Price"}),(0,i.jsx)(p.i.Th,{children:"Selling Price"}),(0,i.jsx)(p.i.Th,{style:{width:100},children:h.length>0?(0,i.jsxs)(s.Group,{gap:"xs",children:[(0,i.jsx)(v.u,{label:"Create Deduction Policy",children:(0,i.jsx)(g.A,{variant:"light",size:"sm",color:"blue",onClick:L,children:(0,i.jsx)(f.Z,{size:16})})}),(0,i.jsx)(v.u,{label:"Delete Selected",children:(0,i.jsx)(g.A,{variant:"light",size:"sm",color:"red",onClick:G,children:(0,i.jsx)(b.Z,{size:16})})})]}):"Actions"})]})})},{}),(0,i.jsx)(()=>(0,i.jsx)(p.i.Tbody,{children:P?(0,i.jsx)(R,{children:"Loading items..."}):z?(0,i.jsx)(R,{children:"Error loading items. Please try again."}):0===D.length?(0,i.jsx)(R,{children:"No items yet. Add some to get started."}):D.map(e=>(0,i.jsx)(_,{item:e},e.id))}),{})]}),A>1&&(0,i.jsx)(s.Group,{justify:"center",children:(0,i.jsx)(y.t,{total:A,value:d,onChange:e=>{c(e),o("inventory_page",e),m([])},size:"sm"})}),(0,i.jsx)(ee,{opened:C,onClose:()=>k(!1),itemIds:h,onSuccess:()=>m([])})]})}var eh=n(32451),em=n(46557);let ep=["Lab","Indoor","Outdoor"];function ex(e){let{onStoreChange:t,initialStoreId:n}=e,[l,{open:d,close:u}]=(0,em.q)(!1),[p,x]=(0,r.useState)(null),[y,T]=(0,r.useState)(""),[f,C]=(0,r.useState)(""),[I,E]=(0,r.useState)(!1),{data:P,isLoading:z}=(0,S.WY)(void 0),[D]=(0,S.j6)(),[O]=(0,S.bg)(),[B,{isLoading:N}]=(0,S.OE)(),G=(0,r.useMemo)(()=>(null==P?void 0:P.data)||[],[P]),L=(0,r.useMemo)(()=>ep.filter(e=>!G.some(t=>{var n,i;return(null===(i=t.tag)||void 0===i?void 0:null===(n=i.tag)||void 0===n?void 0:n.name)===e})),[G]);(0,r.useEffect)(()=>{if(G.length>0&&!p){if(n){let e=G.find(e=>e.id===n);if(e){x(e);return}}x(G[0])}},[G,n]),(0,r.useEffect)(()=>{p&&(null==t||t(p))},[p,t]);let R=async()=>{if(y.trim()&&f){E(!0);try{let e=await D({name:y.trim()}).unwrap();e.data&&await O({storeId:e.data.id,name:f}).unwrap(),w.toast.success("Store created successfully!"),T(""),C(""),u()}catch(t){var e;console.error("Failed to create store:",t),w.toast.error("Failed to create store",{description:(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Please try again."})}finally{E(!1)}}},_=e=>{k.qk.openConfirmModal({title:"Delete Store",centered:!0,children:(0,i.jsxs)(j.Text,{size:"sm",children:["Are you sure you want to delete ",(0,i.jsx)("strong",{children:e.name}),"? This action cannot be undone and will remove all associated data."]}),labels:{confirm:"Delete Store",cancel:"Cancel"},confirmProps:{color:"red"},onConfirm:async()=>{try{if(await B(e.id).unwrap(),w.toast.success("Store deleted successfully!"),G.length>1){let t=G.filter(t=>t.id!==e.id);x(t[0])}else x(null)}catch(e){var t;console.error("Failed to delete store:",e),w.toast.error("Failed to delete store",{description:(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.message)||"Please try again."})}}})},F=G.map(e=>{var t,n,i,r;return{value:e.id,label:e.name+((null===(n=e.tag)||void 0===n?void 0:null===(t=n.tag)||void 0===t?void 0:t.name)?" ("+(null===(r=e.tag)||void 0===r?void 0:null===(i=r.tag)||void 0===i?void 0:i.name)+")":"")}});return z?(0,i.jsxs)(s.Group,{justify:"center",children:[(0,i.jsx)(V.Loader,{size:"sm"}),(0,i.jsx)(j.Text,{size:"sm",children:"Loading stores..."})]}):(0,i.jsxs)(i.Fragment,{children:[p?(0,i.jsxs)(s.Group,{justify:"space-between",align:"center",children:[(0,i.jsxs)(eh.Box,{children:[(0,i.jsx)(o.Title,{order:2,children:"Inventory Management"}),(0,i.jsx)(j.Text,{size:"sm",c:"dimmed",mt:4,children:"Manage inventory by monitoring and handling operations."})]}),(0,i.jsxs)(s.Group,{align:"center",gap:"sm",children:[(0,i.jsx)(Y.P,{data:F,value:p.id,onChange:e=>{if(!e)return;let t=G.find(t=>t.id===e);t&&x(t)},placeholder:"Select store",comboboxProps:{width:250},w:260,label:"Select Store"}),(0,i.jsx)(v.u,{label:"Create new store",children:(0,i.jsx)(g.A,{variant:"filled",size:"lg",onClick:d,"aria-label":"Create new store",mt:"auto",children:(0,i.jsx)(m.Z,{size:16})})}),(0,i.jsx)(v.u,{label:"Delete current store",children:(0,i.jsx)(g.A,{variant:"filled",color:"red",size:"lg",onClick:()=>p&&_(p),"aria-label":"Delete store",loading:N,disabled:!p,mt:"auto",children:(0,i.jsx)(b.Z,{size:16})})})]})]}):(0,i.jsxs)(a.Stack,{gap:"md",align:"center",my:128,children:[(0,i.jsx)(h.Z,{size:24}),(0,i.jsx)(o.Title,{order:3,size:"h4",children:"No Stores Available"}),(0,i.jsx)(j.Text,{size:"sm",c:"dimmed",children:"Create your first store to get started"}),(0,i.jsx)(c.Button,{leftSection:(0,i.jsx)(m.Z,{size:16}),onClick:d,loading:I,children:"Create First Store"})]}),(0,i.jsx)(A.u,{opened:l,onClose:u,title:"Create New Store",size:"md",centered:!0,children:(0,i.jsxs)(a.Stack,{gap:"md",style:{overflow:"auto"},children:[(0,i.jsx)(q.TextInput,{label:"Store Name",placeholder:"Enter store name",value:y,onChange:e=>T(e.currentTarget.value),"data-autofocus":!0,required:!0}),(0,i.jsx)(U,{placeholder:"Enter store tag",label:"Store Tag",value:f,onChange:C,data:L,required:!0}),(0,i.jsxs)(s.Group,{justify:"flex-end",mt:"md",children:[(0,i.jsx)(c.Button,{variant:"light",onClick:u,children:"Cancel"}),(0,i.jsx)(c.Button,{onClick:R,disabled:!y.trim()||!f.trim()||I,loading:I,children:I?"Creating...":"Create Store"})]})]})})]})}let ev=["pcs","box","bottle","tablet","ml","mg","g","kg","l","pack"];function eg(e){var t,n,o,d,u;let{opened:h,onClose:p,onSubmit:v,initialData:g,loading:y,title:T,actionLabel:f}=e,[b,S]=(0,r.useState)((null==g?void 0:g.name)||""),[C,k]=(0,r.useState)((null==g?void 0:g.code)||""),[w,I]=(0,r.useState)((null==g?void 0:g.description)||""),[E,P]=(0,r.useState)((null==g?void 0:g.category)||""),[z,D]=(0,r.useState)((null==g?void 0:g.unit)||"pcs"),[R,_]=(0,r.useState)((null==g?void 0:g.manufacturer)||""),[F,Z]=(0,r.useState)((null==g?void 0:g.costPrice)||0),[M,X]=(0,r.useState)((null==g?void 0:g.sellingPrice)||0),[Y,Q]=(0,r.useState)((null==g?void 0:g.availableStock)||0),[H,V]=(0,r.useState)(100),[K,J]=(0,r.useState)(null===(t=null==g?void 0:g.isSellable)||void 0===t||t),[$,ee]=(0,r.useState)(null!==(n=null==g?void 0:g.isConsumable)&&void 0!==n&&n),[et,en]=(0,r.useState)(null===(o=null==g?void 0:g.isActive)||void 0===o||o),[ei,er]=(0,r.useState)(null!==(d=null==g?void 0:g.expiryTracked)&&void 0!==d&&d),[ea,el]=(0,r.useState)(null!==(u=null==g?void 0:g.batchTracked)&&void 0!==u&&u),[es,eo]=(0,r.useState)((null==g?void 0:g.batchNumber)||""),[ed,ec]=(0,r.useState)(null),[eu,eh]=(0,r.useState)(30),[em,ep]=(0,r.useState)((null==g?void 0:g.addToIndoorExpenses)||!1),[ex,eg]=(0,r.useState)((null==g?void 0:g.addToOutdoorExpenses)||!1);return(0,r.useEffect)(()=>{if(h){var e,t,n,i,r;S((null==g?void 0:g.name)||""),k((null==g?void 0:g.code)||""),I((null==g?void 0:g.description)||""),P((null==g?void 0:g.category)||""),D((null==g?void 0:g.unit)||"pcs"),_((null==g?void 0:g.manufacturer)||""),Z((null==g?void 0:g.costPrice)||0),X((null==g?void 0:g.sellingPrice)||0),Q((null==g?void 0:g.availableStock)||0),V(100),J(null===(e=null==g?void 0:g.isSellable)||void 0===e||e),ee(null!==(t=null==g?void 0:g.isConsumable)&&void 0!==t&&t),en(null===(n=null==g?void 0:g.isActive)||void 0===n||n),er(null!==(i=null==g?void 0:g.expiryTracked)&&void 0!==i&&i),el(null!==(r=null==g?void 0:g.batchTracked)&&void 0!==r&&r),eo((null==g?void 0:g.batchNumber)||""),ec(null),eh(30),ep((null==g?void 0:g.addToIndoorExpenses)||!1),eg((null==g?void 0:g.addToOutdoorExpenses)||!1)}},[h,g]),(0,i.jsx)(A.u,{opened:h,onClose:p,title:T||"Add New Item",size:"lg",centered:!0,styles:{body:{maxHeight:"70vh",overflowY:"auto"}},children:(0,i.jsxs)(a.Stack,{gap:"lg",children:[(0,i.jsxs)(O.X,{withBorder:!0,p:"md",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Basic Information"}),(0,i.jsxs)(a.Stack,{gap:"md",children:[(0,i.jsx)(q.TextInput,{label:"Item Name",placeholder:"Enter item name",value:b,onChange:e=>S(e.currentTarget.value),required:!0,withAsterisk:!0}),(0,i.jsxs)(B.Grid,{children:[(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(q.TextInput,{label:"Item Code",placeholder:"SKU or code",value:C,onChange:e=>k(e.currentTarget.value)})}),(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(q.TextInput,{label:"Category",placeholder:"e.g., Medicine, Equipment",value:E,onChange:e=>P(e.currentTarget.value)})})]}),(0,i.jsxs)(B.Grid,{children:[(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(U,{label:"Unit",placeholder:"Select or create unit",value:z,onChange:D,data:ev})}),(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(q.TextInput,{label:"Manufacturer",placeholder:"Manufacturer name",value:R,onChange:e=>_(e.currentTarget.value)})})]}),(0,i.jsx)(N.g,{label:"Description",placeholder:"Item description",value:w,onChange:e=>I(e.currentTarget.value),minRows:2,maxRows:4})]})]}),(0,i.jsxs)(O.X,{withBorder:!0,p:"md",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Pricing & Stock"}),(0,i.jsxs)(B.Grid,{children:[(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(G.Y,{label:"Cost Price",placeholder:"0.00",value:Number(F),onChange:Z,min:0,decimalScale:2,prefix:"৳"})}),(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(G.Y,{label:"Selling Price",placeholder:"0.00",value:Number(M),onChange:X,min:0,decimalScale:2,prefix:"৳"})}),(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(G.Y,{label:"Initial Stock",placeholder:"0",value:Number(Y),onChange:Q,min:0})}),(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(G.Y,{label:"Minimum Stock Alert Level",placeholder:"100",value:Number(H),onChange:V,min:0,description:"Alert when stock falls below this"})})]})]}),(0,i.jsxs)(O.X,{withBorder:!0,p:"md",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Item Properties"}),(0,i.jsxs)(a.Stack,{gap:"sm",children:[(0,i.jsx)(L.r,{label:"Sellable Item",description:"Can this item be sold to customers?",checked:K,onChange:e=>J(e.currentTarget.checked)}),(0,i.jsx)(L.r,{label:"Consumable Item",description:"Is this item consumed during use?",checked:$,onChange:e=>ee(e.currentTarget.checked)}),(0,i.jsx)(L.r,{label:"Active",description:"Is this item currently active?",checked:et,onChange:e=>en(e.currentTarget.checked)})]})]}),(0,i.jsxs)(O.X,{withBorder:!0,p:"md",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Tracking Options"}),(0,i.jsxs)(a.Stack,{gap:"sm",children:[(0,i.jsx)(L.r,{label:"Track Expiry Dates",description:"Enable expiry date tracking for this item",checked:ei,onChange:e=>er(e.currentTarget.checked)}),(0,i.jsx)(L.r,{label:"Track Batches",description:"Enable batch number tracking for this item",checked:ea,onChange:e=>el(e.currentTarget.checked)})]})]}),(ea||ei)&&(0,i.jsxs)(O.X,{withBorder:!0,p:"md",bg:"blue.0",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Batch & Expiry Information"}),(0,i.jsxs)(a.Stack,{gap:"md",children:[ea&&(0,i.jsx)(q.TextInput,{label:"Batch Number",placeholder:"Enter batch number",value:es,onChange:e=>eo(e.currentTarget.value)}),ei&&(0,i.jsxs)(B.Grid,{children:[(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(W.W,{label:"Expiry Date",placeholder:"Select expiry date",value:ed,onChange:ec,clearable:!0,minDate:new Date})}),(0,i.jsx)(B.Grid.Col,{span:6,children:(0,i.jsx)(G.Y,{label:"Alert Days Before Expiry",placeholder:"30",value:Number(eu),onChange:eh,min:1,description:"Days before expiry to alert"})})]})]})]}),(0,i.jsxs)(O.X,{withBorder:!0,p:"md",bg:"gray.0",children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,mb:"md",children:"Expense Tracking"}),(0,i.jsxs)(a.Stack,{gap:"sm",children:[(0,i.jsx)(x.X,{label:"Add to Indoor Expenses",description:"Include initial stock value in indoor department expenses",checked:em,onChange:e=>{e.currentTarget.checked?(ep(!0),eg(!1)):ep(!1)}}),(0,i.jsx)(x.X,{label:"Add to Outdoor Expenses",description:"Include initial stock value in outdoor department expenses",checked:ex,onChange:e=>{e.currentTarget.checked?(eg(!0),ep(!1)):eg(!1)}})]})]}),(0,i.jsx)(l.Divider,{}),(0,i.jsxs)(s.Group,{justify:"right",children:[(0,i.jsx)(c.Button,{variant:"default",onClick:p,disabled:y,children:"Cancel"}),(0,i.jsx)(c.Button,{leftSection:(0,i.jsx)(m.Z,{size:16}),onClick:()=>{b.trim()&&v({name:b.trim(),code:C.trim()||void 0,description:w.trim()||void 0,category:E.trim()||void 0,unit:z||"pcs",manufacturer:R.trim()||void 0,costPrice:Number(F)||void 0,sellingPrice:Number(M)||void 0,availableStock:Number(Y)||0,isSellable:K,isConsumable:$,isActive:et,expiryTracked:ei,batchTracked:ea,batchNumber:ea&&es.trim()?es.trim():void 0,expiryDate:ei&&ed?ed.toISOString():void 0,expiryAlertDays:ei?Number(eu):void 0,addToIndoorExpenses:em,addToOutdoorExpenses:ex})},loading:y,disabled:!b.trim()||y,children:f||"Add Item"})]})]})})}function ej(e){let{storeId:t,opened:n,onClose:r}=e,[a,{isLoading:l}]=(0,S.mS)(),s=async e=>{try{let n={...e,storeId:t};await a(n).unwrap(),w.toast.success("Item created successfully!"),r()}catch(e){console.error("Failed to create item:",e),w.toast.error("Failed to create item",{description:e.data.message||"Please try again"})}};return(0,i.jsx)(eg,{opened:n,onClose:r,onSubmit:s,loading:l})}var ey=n(38254),eT=n(39467),ef=n(36409),eb=n(9326),eS=n(98542),eC=n(49238),ek=n(86083),ew=n(37947),eI=n(9286),eE=n(58185),eP=n(6660),ez=n(52013),eD=n(77052);function eA(e){var t,n,l,u;let{storeId:h}=e,{getParam:m,getTypedParam:x,updateUrlParams:T}=(0,ec.G)(),[f,b]=(0,r.useState)(()=>x("logs_page",1)),[C]=(0,r.useState)(20),[k,w]=(0,r.useState)(()=>m("logs_search")||""),[I,E]=(0,r.useState)(()=>{let e=m("logs_dateFrom"),t=m("logs_dateTo");return{storeId:h||m("logs_storeId")||void 0,itemId:m("logs_itemId")||void 0,type:m("logs_type")||void 0,referenceType:m("logs_referenceType")||void 0,dateFrom:e?new Date(e):null,dateTo:t?new Date(t):null,sortBy:m("logs_sortBy")||"createdAt",sortOrder:m("logs_sortOrder")||"desc"}}),[P,z]=(0,r.useState)(()=>x("logs_filtersExpanded",!0)),D=(0,r.useRef)(h),A=e=>{b(e),T({logs_page:e})},O=e=>{w(e),T({logs_search:e||null})},N=(0,r.useCallback)(e=>{E(t=>{var n,i;let r="function"==typeof e?e(t):e;return T({logs_storeId:r.storeId||null,logs_itemId:r.itemId||null,logs_type:r.type||null,logs_referenceType:r.referenceType||null,logs_dateFrom:(null===(n=r.dateFrom)||void 0===n?void 0:n.toISOString())||null,logs_dateTo:(null===(i=r.dateTo)||void 0===i?void 0:i.toISOString())||null,logs_sortBy:r.sortBy||null,logs_sortOrder:r.sortOrder||null}),r})},[T]),{data:G}=(0,S.WY)({}),{data:L}=(0,S.WK)({}),{data:R,isLoading:_,error:F}=(0,S.DD)({page:f,limit:C,...I,dateFrom:null===(t=I.dateFrom)||void 0===t?void 0:t.toISOString(),dateTo:null===(n=I.dateTo)||void 0===n?void 0:n.toISOString()}),U=(null==G?void 0:G.data)||[],Z=(null==L?void 0:L.data)||[],M=(null==R?void 0:null===(l=R.data)||void 0===l?void 0:l.transactions)||[],X=null==R?void 0:null===(u=R.data)||void 0===u?void 0:u.pagination,Q=[{value:"",label:"All Stores"},...U.map(e=>({value:e.id,label:e.name}))],W=[{value:"",label:"All Items"},...Z.map(e=>({value:e.id,label:"".concat(e.name," ").concat(e.code?"(".concat(e.code,")"):"")}))],H=()=>{O(""),N({sortBy:"createdAt",sortOrder:"desc"}),A(1),T({logs_search:null,logs_storeId:null,logs_itemId:null,logs_type:null,logs_referenceType:null,logs_dateFrom:null,logs_dateTo:null,logs_page:1})};(0,r.useEffect)(()=>{h&&D.current!==h&&(D.current=h,N(e=>({...e,storeId:h})))},[h,N]);let J=k.length>0||I.storeId||I.itemId||I.type||I.referenceType||I.dateFrom||I.dateTo,$=e=>{switch(e){case"IN":return"green";case"OUT":return"red";case"TRANSFER":return"blue";case"ADJUSTMENT":return"yellow";default:return"gray"}},ee=e=>{if(!e)return"gray";switch(e){case"TEST_COMPLETION":return"blue";case"OPERATION":return"purple";case"BILL_TEST":return"cyan";case"OUTDOOR_BILL":return"teal";default:return"gray"}};return F?(0,i.jsx)(K.b,{icon:(0,i.jsx)(eb.Z,{size:16}),title:"Error",color:"red",children:"Failed to load transaction logs"}):(0,i.jsxs)(a.Stack,{gap:"md",children:[(0,i.jsxs)(et.Z,{shadow:"sm",p:"md",radius:"md",withBorder:!0,children:[(0,i.jsxs)(s.Group,{justify:"space-between",mb:"md",children:[(0,i.jsx)(o.Title,{order:4,children:"Transaction Logs"}),(0,i.jsx)(g.A,{variant:"subtle",onClick:()=>{let e=!P;z(e),T({logs_filtersExpanded:e})},children:P?(0,i.jsx)(eS.Z,{size:18}):(0,i.jsx)(eC.Z,{size:18})})]}),(0,i.jsx)(eT.U,{in:P,children:(0,i.jsxs)(a.Stack,{gap:"md",children:[(0,i.jsx)(q.TextInput,{placeholder:"Search by item name, store, reason...",value:k,onChange:e=>{O(e.currentTarget.value),A(1)},leftSection:(0,i.jsx)(ek.Z,{size:16}),rightSection:k&&(0,i.jsx)(g.A,{size:"sm",variant:"subtle",onClick:()=>O(""),children:(0,i.jsx)(ew.Z,{size:14})})}),(0,i.jsxs)(B.Grid,{gutter:"md",children:[(0,i.jsx)(B.Grid.Col,{span:{base:12,sm:6,md:3},children:(0,i.jsx)(Y.P,{label:"Store",placeholder:"All Stores",data:Q,value:I.storeId||"",onChange:e=>{N({...I,storeId:e||void 0}),A(1)},clearable:!0,leftSection:(0,i.jsx)(eI.Z,{size:14})})}),(0,i.jsx)(B.Grid.Col,{span:{base:12,sm:6,md:3},children:(0,i.jsx)(Y.P,{label:"Item",placeholder:"All Items",data:W,value:I.itemId||"",onChange:e=>{N({...I,itemId:e||void 0}),A(1)},clearable:!0,searchable:!0,leftSection:(0,i.jsx)(eI.Z,{size:14})})}),(0,i.jsx)(B.Grid.Col,{span:{base:12,sm:6,md:3},children:(0,i.jsx)(Y.P,{label:"Transaction Type",placeholder:"All Types",data:[{value:"",label:"All Types"},{value:"IN",label:"Stock In"},{value:"OUT",label:"Stock Out"},{value:"TRANSFER",label:"Transfer"},{value:"ADJUSTMENT",label:"Adjustment"}],value:I.type||"",onChange:e=>{N({...I,type:e||void 0}),A(1)},clearable:!0,leftSection:(0,i.jsx)(eI.Z,{size:14})})}),(0,i.jsx)(B.Grid.Col,{span:{base:12,sm:6,md:3},children:(0,i.jsx)(Y.P,{label:"Reference Type",placeholder:"All References",data:[{value:"",label:"All References"},{value:"TEST_COMPLETION",label:"Test Completion"},{value:"OPERATION",label:"Operation"},{value:"BILL_TEST",label:"Bill Test"},{value:"OUTDOOR_BILL",label:"Outdoor Bill"},{value:"CUSTOM",label:"Custom"}],value:I.referenceType||"",onChange:e=>{N({...I,referenceType:e||void 0}),A(1)},clearable:!0,leftSection:(0,i.jsx)(eI.Z,{size:14})})})]}),(0,i.jsxs)(B.Grid,{gutter:"md",children:[(0,i.jsx)(B.Grid.Col,{span:{base:12,sm:6},children:(0,i.jsx)(eD.DatePickerInput,{label:"Date From",placeholder:"From date",value:I.dateFrom,onChange:e=>{N({...I,dateFrom:e}),A(1)},clearable:!0})}),(0,i.jsx)(B.Grid.Col,{span:{base:12,sm:6},children:(0,i.jsx)(eD.DatePickerInput,{label:"Date To",placeholder:"To date",value:I.dateTo,onChange:e=>{N({...I,dateTo:e}),A(1)},clearable:!0})})]}),(0,i.jsxs)(s.Group,{gap:"md",children:[(0,i.jsx)(Y.P,{label:"Sort By",placeholder:"Sort field",data:[{value:"createdAt",label:"Date"},{value:"quantity",label:"Quantity"},{value:"totalCost",label:"Total Cost"}],value:I.sortBy||"createdAt",onChange:e=>N({...I,sortBy:e}),style:{flex:1}}),(0,i.jsx)(Y.P,{label:"Sort Order",placeholder:"Sort order",data:[{value:"desc",label:"Descending"},{value:"asc",label:"Ascending"}],value:I.sortOrder||"desc",onChange:e=>N({...I,sortOrder:e}),style:{flex:1}})]}),(0,i.jsxs)(s.Group,{ml:"auto",children:[J&&(0,i.jsx)(c.Button,{variant:"light",color:"gray",leftSection:(0,i.jsx)(ew.Z,{size:16}),onClick:H,children:"Clear All Filters"}),(0,i.jsx)(c.Button,{color:"blue",leftSection:(0,i.jsx)(eE.Z,{size:16}),onClick:H,children:"Print"})]})]})})]}),_?(0,i.jsx)(ef.M,{h:200,children:(0,i.jsx)(V.Loader,{size:"lg"})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eh.Box,{style:{overflowX:"auto",width:"100%"},children:(0,i.jsxs)(p.i,{highlightOnHover:!0,striped:!0,withTableBorder:!0,miw:1200,children:[(0,i.jsx)(p.i.Thead,{children:(0,i.jsxs)(p.i.Tr,{children:[(0,i.jsx)(p.i.Th,{children:"Date & Time"}),(0,i.jsx)(p.i.Th,{children:"Type"}),(0,i.jsx)(p.i.Th,{children:"Item"}),(0,i.jsx)(p.i.Th,{children:"Store"}),(0,i.jsx)(p.i.Th,{children:"Quantity"}),(0,i.jsx)(p.i.Th,{children:"Unit Cost"}),(0,i.jsx)(p.i.Th,{children:"Total Cost"}),(0,i.jsx)(p.i.Th,{children:"Batch Info"}),(0,i.jsx)(p.i.Th,{children:"Reference"}),(0,i.jsx)(p.i.Th,{children:"Reason"}),(0,i.jsx)(p.i.Th,{children:"Done By"})]})}),(0,i.jsx)(p.i.Tbody,{children:0===M.length?(0,i.jsx)(p.i.Tr,{children:(0,i.jsx)(p.i.Td,{colSpan:11,children:(0,i.jsx)(j.Text,{c:"dimmed",ta:"center",size:"sm",py:"md",children:"No transaction logs found"})})}):M.filter(e=>{if(!k)return!0;let t=k.toLowerCase();return e.item.name.toLowerCase().includes(t)||e.store.name.toLowerCase().includes(t)||e.reason.toLowerCase().includes(t)||e.item.code&&e.item.code.toLowerCase().includes(t)}).map(e=>(0,i.jsxs)(p.i.Tr,{children:[(0,i.jsx)(p.i.Td,{children:(0,i.jsx)(j.Text,{size:"sm",children:new Date(e.createdAt).toLocaleString()})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)(d.C,{color:$(e.type),variant:"light",children:["IN"===e.type&&(0,i.jsx)(eP.Z,{size:12}),"OUT"===e.type&&(0,i.jsx)(ez.Z,{size:12}),(0,i.jsx)("span",{style:{marginLeft:4},children:e.type})]})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)("div",{children:[(0,i.jsx)(j.Text,{size:"sm",fw:600,children:e.item.name}),e.item.code&&(0,i.jsx)(j.Text,{size:"xs",c:"dimmed",children:e.item.code}),e.item.category&&(0,i.jsx)(d.C,{size:"xs",variant:"outline",mt:2,children:e.item.category})]})}),(0,i.jsxs)(p.i.Td,{children:[(0,i.jsx)(j.Text,{size:"sm",children:e.store.name}),e.store.location&&(0,i.jsx)(j.Text,{size:"xs",c:"dimmed",children:e.store.location})]}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)(d.C,{variant:"filled",color:"IN"===e.type?"green":"red",children:["IN"===e.type?"+":"-",e.quantity," ",e.item.unit]})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsx)(j.Text,{size:"sm",children:e.unitCost?"৳".concat(e.unitCost.toLocaleString()):"N/A"})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsx)(j.Text,{size:"sm",fw:500,children:e.totalCost?"৳".concat(e.totalCost.toLocaleString()):"N/A"})}),(0,i.jsx)(p.i.Td,{children:e.batchInfo?(0,i.jsxs)("div",{children:[e.batchInfo.batchNumber&&(0,i.jsx)(d.C,{size:"xs",variant:"outline",mb:2,children:e.batchInfo.batchNumber}),e.batchInfo.expiryDate&&(0,i.jsxs)(j.Text,{size:"xs",c:"dimmed",children:["Exp: ",new Date(e.batchInfo.expiryDate).toLocaleDateString()]}),(0,i.jsxs)(j.Text,{size:"xs",c:"dimmed",children:["Stock: ",e.batchInfo.currentStock]})]}):(0,i.jsx)(j.Text,{size:"xs",c:"dimmed",children:"N/A"})}),(0,i.jsx)(p.i.Td,{children:e.reference.type?(0,i.jsx)(v.u,{label:"ID: ".concat(e.reference.id),children:(0,i.jsx)(d.C,{size:"sm",variant:"light",color:ee(e.reference.type),children:e.reference.type.replace(/_/g," ")})}):(0,i.jsx)(j.Text,{size:"xs",c:"dimmed",children:"N/A"})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsx)(v.u,{label:e.reason,children:(0,i.jsx)(j.Text,{size:"sm",lineClamp:2,style:{maxWidth:200},children:e.reason})})}),(0,i.jsx)(p.i.Td,{children:(0,i.jsxs)("div",{children:[(0,i.jsx)(j.Text,{size:"sm",fw:500,children:e.createdBy.name||e.createdBy.email}),(0,i.jsx)(d.C,{size:"xs",variant:"outline",children:e.createdBy.role})]})})]},e.id))})]})}),X&&X.totalPages>1&&(0,i.jsxs)(s.Group,{justify:"space-between",mt:"md",children:[(0,i.jsxs)(j.Text,{size:"sm",c:"dimmed",children:["Showing ",M.length," of ",X.totalCount," transactions"]}),(0,i.jsx)(y.t,{total:X.totalPages,value:f,onChange:A,size:"sm"})]})]})]})}function eO(e){var t,n,p;let{showStatCards:x=!1,showItemForm:v=!0,allowBorrowing:g=!0}=e;(0,ey.x)();let{getParam:j,updateUrlParam:y}=(0,ec.G)(),[T,f]=(0,r.useState)(null),[b,S]=(0,r.useState)(!1),C=j("tab")||"inventory",k=j("logs_storeId");return T?(0,i.jsxs)(a.Stack,{p:"lg",gap:"lg",children:[(0,i.jsx)(ex,{onStoreChange:f,initialStoreId:k}),(0,i.jsx)(l.Divider,{mb:"sm"}),v&&(0,i.jsxs)(s.Group,{children:[(0,i.jsxs)(s.Group,{align:"center",gap:"md",children:[(0,i.jsx)(h.Z,{size:24}),(0,i.jsx)(o.Title,{order:3,size:"h4",children:null==T?void 0:null===(t=T.tag)||void 0===t?void 0:t.tag.name}),(0,i.jsx)(d.C,{size:"sm",color:"blue",variant:"light",children:null==T?void 0:null===(p=T.tag)||void 0===p?void 0:null===(n=p.tag)||void 0===n?void 0:n.name})]}),(0,i.jsx)(c.Button,{leftSection:(0,i.jsx)(m.Z,{size:16}),onClick:()=>S(!0),variant:"light",style:{width:"max-content",marginLeft:"auto"},children:"Add New Item"})]}),(0,i.jsxs)(u.m,{value:C,onChange:e=>y("tab",e),children:[(0,i.jsxs)(u.m.List,{children:[(0,i.jsx)(u.m.Tab,{value:"inventory",children:"Inventory"}),(0,i.jsx)(u.m.Tab,{value:"logs",children:"Logs"})]}),(0,i.jsx)(u.m.Panel,{value:"inventory",pt:"md",children:(0,i.jsx)(eu,{storeId:T.id})}),(0,i.jsx)(u.m.Panel,{value:"logs",pt:"md",children:(0,i.jsx)(eA,{storeId:T.id})})]}),(0,i.jsx)(ej,{storeId:T.id,opened:b,onClose:()=>S(!1)})]}):(0,i.jsx)(a.Stack,{p:"md",gap:"lg",children:(0,i.jsx)(ex,{onStoreChange:f,initialStoreId:k})})}function eq(){return(0,i.jsx)(eO,{title:"Indoor Inventory",showStatCards:!1,showItemForm:!0,allowBorrowing:!0})}},72940:function(e,t,n){"use strict";n.d(t,{FD:function(){return r},Hn:function(){return i},y4:function(){return a}});let i={headers:{"Content-Type":"application/json"}},r={withCredentials:!0},a={headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}},38254:function(e,t,n){"use strict";n.d(t,{x:function(){return s}});var i=n(83501),r=n(25499),a=n(25626),l=n(4505);let s=()=>{let e=(0,r.C)(e=>e.tests),t=(0,r.T)();(0,l.useEffect)(()=>{let n=async()=>{let{success:e,data:n}=await (0,i.Y)();if(e){let e=n.map(e=>{var t;return null==e?void 0:null===(t=e.tests)||void 0===t?void 0:t.map(e=>e)}).flat();t((0,a._W)(e))}else console.error(n)};(null==e?void 0:e.adminTests)||n()},[])}},89123:function(e,t,n){"use strict";n.d(t,{G:function(){return a}});var i=n(12450),r=n(4505);function a(){let e=(0,i.useRouter)(),t=(0,i.useSearchParams)(),n=(0,r.useCallback)(e=>null==e||""===e?null:e instanceof Date?e.toISOString():String(e),[]),a=(0,r.useCallback)(e=>t.get(e),[t]),l=(0,r.useCallback)((e,n)=>{let i=t.get(e);if(null===i)return n;if(n instanceof Date){let e=new Date(i);return isNaN(e.getTime())?n:e}if("boolean"==typeof n)return"true"===i;if("number"==typeof n){let e=Number(i);return isNaN(e)?n:e}return i},[t]),s=(0,r.useCallback)(()=>{let e={};return t.forEach((t,n)=>{e[n]=t}),e},[t]),o=(0,r.useCallback)((i,r)=>{let a=new URLSearchParams(Array.from(t.entries())),l=n(r);null!==l?a.set(i,l):a.delete(i);let s=a.toString();e.replace("".concat(window.location.pathname).concat(s?"?".concat(s):""),{scroll:!1})},[e,t,n]),d=(0,r.useCallback)(i=>{let r=new URLSearchParams(Array.from(t.entries()));Object.entries(i).forEach(e=>{let[t,i]=e,a=n(i);null!==a?r.set(t,a):r.delete(t)});let a=r.toString();e.replace("".concat(window.location.pathname).concat(a?"?".concat(a):""),{scroll:!1})},[e,t,n]);return{getParam:a,getTypedParam:l,getAllParams:s,updateUrlParam:o,updateUrlParams:d,removeUrlParam:(0,r.useCallback)(n=>{let i=new URLSearchParams(Array.from(t.entries()));i.delete(n);let r=i.toString();e.replace("".concat(window.location.pathname).concat(r?"?".concat(r):""),{scroll:!1})},[e,t]),removeUrlParams:(0,r.useCallback)(n=>{let i=new URLSearchParams(Array.from(t.entries()));n.forEach(e=>i.delete(e));let r=i.toString();e.replace("".concat(window.location.pathname).concat(r?"?".concat(r):""),{scroll:!1})},[e,t]),clearAllParams:(0,r.useCallback)(()=>{e.replace(window.location.pathname,{scroll:!1})},[e])}}},83501:function(e,t,n){"use strict";n.d(t,{Y:function(){return a}});var i=n(49854),r=n(67732);let a=async()=>{try{let e=await (0,i.d)("testCategory/admin");return{success:!0,data:e.data}}catch(t){if(t instanceof r.d7){var e;return{success:!1,data:null===(e=t.response)||void 0===e?void 0:e.data.message}}return{success:!1,data:"An error occurred"}}}},52387:function(e,t,n){"use strict";n.d(t,{Cf:function(){return B},DD:function(){return q},OB:function(){return E},OE:function(){return s},WK:function(){return h},WY:function(){return i},Xz:function(){return v},Yd:function(){return A},_r:function(){return F},a:function(){return z},aB:function(){return I},aS:function(){return P},ap:function(){return R},bM:function(){return m},bg:function(){return c},fF:function(){return g},fp:function(){return j},fv:function(){return x},gZ:function(){return L},j6:function(){return a},lg:function(){return O},mS:function(){return p},sv:function(){return G},vR:function(){return D},zQ:function(){return N}});let{useGetAllStoresQuery:i,useGetStoreQuery:r,useCreateStoreMutation:a,useUpdateStoreMutation:l,useDeleteStoreMutation:s,useGetAllStoreTagsQuery:o,useGetStoreTagQuery:d,useCreateStoreTagMutation:c,useDeleteStoreTagMutation:u,useGetAllInventoryItemsQuery:h,useGetInventoryItemQuery:m,useCreateInventoryItemMutation:p,useUpdateInventoryItemMutation:x,useDeleteInventoryItemMutation:v,useDeductStockMutation:g,useAddStockMutation:j,useGetAllInventoryPackagesQuery:y,useGetInventoryPackageQuery:T,useCreateInventoryPackageMutation:f,useUpdateInventoryPackageMutation:b,useDeleteInventoryPackageMutation:S,useAddItemToPackageMutation:C,useUpdatePackageItemMutation:k,useRemoveItemFromPackageMutation:w,useGetDeductionPoliciesQuery:I,useCreateDeductionPolicyMutation:E,useUpdateDeductionPolicyMutation:P,useDeleteDeductionPolicyMutation:z,useGetDashboardSummaryQuery:D,useGetStockTrendsQuery:A,useGetCriticalAlertsQuery:O,useGetTransactionLogsQuery:q,useGetBatchesQuery:B,useGetUsersQuery:N,useGetGroupedTransactionsQuery:G,useGetDefaultStoresQuery:L,useAddDefaultStoreMutation:R,useSetDefaultStoresMutation:_,useDeleteDefaultStoreMutation:F}=n(78101).g.injectEndpoints({endpoints:e=>({getAllStores:e.query({query:()=>({url:"/store",method:"GET"}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),getStore:e.query({query:e=>({url:"/store/".concat(e),method:"GET"}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),createStore:e.mutation({query:e=>({url:"/store",method:"POST",body:e}),invalidatesTags:["inventory"]}),updateStore:e.mutation({query:e=>{let{id:t,...n}=e;return{url:"/store/".concat(t),method:"PUT",body:n}},invalidatesTags:["inventory"]}),deleteStore:e.mutation({query:e=>({url:"/store/".concat(e),method:"DELETE"}),invalidatesTags:["inventory"]}),getAllStoreTags:e.query({query:()=>({url:"/storeTag",method:"GET"}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),getStoreTag:e.query({query:e=>({url:"/storeTag/".concat(e),method:"GET"}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),createStoreTag:e.mutation({query:e=>({url:"/storeTag",method:"POST",body:e}),invalidatesTags:["inventory"]}),deleteStoreTag:e.mutation({query:e=>({url:"/storeTag/".concat(e),method:"DELETE"}),invalidatesTags:["inventory"]}),getAllInventoryItems:e.query({query:e=>({url:"/inventoryItem",method:"GET",params:e}),providesTags:["inventory"],transformResponse:e=>({data:e.data,pagination:e.pagination})}),getInventoryItem:e.query({query:e=>({url:"/inventoryItem/".concat(e),method:"GET"}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),createInventoryItem:e.mutation({query:e=>({url:"/inventoryItem",method:"POST",body:e}),invalidatesTags:["inventory"]}),updateInventoryItem:e.mutation({query:e=>{let{id:t,...n}=e;return{url:"/inventoryItem/".concat(t),method:"PUT",body:n}},invalidatesTags:["inventory"]}),deleteInventoryItem:e.mutation({query:e=>({url:"/inventoryItem/".concat(e),method:"DELETE"}),invalidatesTags:["inventory"]}),deductStock:e.mutation({query:e=>({url:"/inventoryItem/deduct-stock",method:"POST",body:e}),invalidatesTags:["inventory"]}),addStock:e.mutation({query:e=>({url:"/inventoryItem/add-stock",method:"POST",body:e}),invalidatesTags:["inventory"]}),getAllInventoryPackages:e.query({query:e=>({url:"/inventoryPackage",method:"GET",params:e}),providesTags:["inventory"],transformResponse:e=>({data:e.data,pagination:e.pagination})}),getInventoryPackage:e.query({query:e=>({url:"/inventoryPackage/".concat(e),method:"GET"}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),createInventoryPackage:e.mutation({query:e=>({url:"/inventoryPackage",method:"POST",body:e}),invalidatesTags:["inventory"]}),updateInventoryPackage:e.mutation({query:e=>{let{id:t,...n}=e;return{url:"/inventoryPackage/".concat(t),method:"PUT",body:n}},invalidatesTags:["inventory"]}),deleteInventoryPackage:e.mutation({query:e=>({url:"/inventoryPackage/".concat(e),method:"DELETE"}),invalidatesTags:["inventory"]}),addItemToPackage:e.mutation({query:e=>{let{packageId:t,...n}=e;return{url:"/inventoryPackage/".concat(t,"/items"),method:"POST",body:n}},invalidatesTags:["inventory"]}),updatePackageItem:e.mutation({query:e=>{let{packageId:t,itemId:n,...i}=e;return{url:"/inventoryPackage/".concat(t,"/items/").concat(n),method:"PUT",body:i}},invalidatesTags:["inventory"]}),removeItemFromPackage:e.mutation({query:e=>{let{packageId:t,itemId:n}=e;return{url:"/inventoryPackage/".concat(t,"/items/").concat(n),method:"DELETE"}},invalidatesTags:["inventory"]}),getDeductionPolicies:e.query({query:e=>({url:"/inventoryItem/".concat(e,"/deduction-policy"),method:"GET"}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),createDeductionPolicy:e.mutation({query:e=>{let{itemId:t,...n}=e;return{url:"/inventoryItem/".concat(t,"/deduction-policy"),method:"POST",body:n}},invalidatesTags:["inventory"]}),updateDeductionPolicy:e.mutation({query:e=>{let{itemId:t,policyId:n,...i}=e;return{url:"/inventoryItem/".concat(t,"/deduction-policy/").concat(n),method:"PATCH",body:i}},invalidatesTags:["inventory"]}),deleteDeductionPolicy:e.mutation({query:e=>{let{itemId:t,policyId:n}=e;return{url:"/inventoryItem/".concat(t,"/deduction-policy/").concat(n),method:"DELETE"}},invalidatesTags:["inventory"]}),getDashboardSummary:e.query({query:e=>({url:"/inventory/dashboard/summary",method:"GET",params:e}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),getStockTrends:e.query({query:e=>({url:"/inventory/dashboard/trends",method:"GET",params:e}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),getCriticalAlerts:e.query({query:e=>({url:"/inventory/dashboard/critical-alerts",method:"GET",params:e}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),getTransactionLogs:e.query({query:e=>({url:"/inventory/transactions",method:"GET",params:e}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),getBatches:e.query({query:e=>({url:"/inventory/batches",method:"GET",params:e}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),getUsers:e.query({query:()=>({url:"/admin/user",method:"GET"}),transformResponse:e=>({data:e.data})}),getGroupedTransactions:e.query({query:e=>({url:"/inventory/transactions/grouped",method:"GET",params:e}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),getDefaultStores:e.query({query:e=>({url:"/inventory/default-stores",method:"GET",params:e?{billType:e}:void 0}),providesTags:["inventory"],transformResponse:e=>({data:e.data})}),addDefaultStore:e.mutation({query:e=>({url:"/inventory/default-stores",method:"POST",body:e}),invalidatesTags:["inventory"]}),setDefaultStores:e.mutation({query:e=>({url:"/inventory/default-stores",method:"PUT",body:e}),invalidatesTags:["inventory"]}),deleteDefaultStore:e.mutation({query:e=>({url:"/inventory/default-stores",method:"DELETE",body:e}),invalidatesTags:["inventory"]})})})},78101:function(e,t,n){"use strict";n.d(t,{g:function(){return s}});var i=n(49854),r=n(68240),a=n(94183),l=n(28317);let s=(0,r.LC)({baseQuery:(0,a.ni)({baseUrl:"http://sasthotech.local:5000/api/v1",credentials:"include",fetchFn:(e,t)=>fetch(e,t).then(async n=>{let r="string"==typeof e?e:e.url;return r.includes("?")||(null==t?void 0:t.body)||"string"!=typeof e&&e.body||await (0,l.t8)(r,await n.clone().json().catch(()=>null),(0,i.x)()),n}).catch(async n=>{if(n instanceof TypeError){let n="string"==typeof e?e:e.url;if(!n.includes("?")&&!(null==t?void 0:t.body)&&!("string"!=typeof e&&e.body)){let e=await (0,l.U2)(n,(0,i.x)());if(e)return new Response(e,{headers:new Headers({"Content-Type":"application/json"})})}}throw n})}),endpoints:()=>({}),tagTypes:["BillTest","doctor","hospitalBill","inventory","appointment","patient","sms","sms-dashboard","sms-messages","sms-analytics","sms-status","notice","template","versionAdmin-services","versionAdmin-versions","versionAdmin-hospitals","versionAdmin-logs","versionAdmin-sessions","versionAdmin-devices","versionAdmin-notifications","versionAdmin-notification-stats","PCMeetup","MarketerTarget","Marketer"]})},25499:function(e,t,n){"use strict";n.d(t,{C:function(){return a},T:function(){return r}});var i=n(53502);let r=()=>(0,i.I0)(),a=i.v9},36760:function(e,t,n){"use strict";n.d(t,{SI:function(){return l},VR:function(){return o},tq:function(){return a},z2:function(){return r}});let i=n(78101).g.injectEndpoints({endpoints:e=>({getOperations:e.query({query:e=>{let{page:t,limit:n}=e,i=new URLSearchParams;return t&&i.append("page",t.toString()),n&&i.append("limit",n.toString()),{url:"/operation?".concat(i.toString())}},keepUnusedDataFor:86400,transformResponse:e=>(Array.isArray(null==e?void 0:e.data)&&e.data.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()),e)}),createOperation:e.mutation({query:e=>({url:"/operation",method:"POST",body:e}),async onQueryStarted(e,t){let{dispatch:n,queryFulfilled:r}=t,a=Date.now().toString(36),l=n(i.util.updateQueryData("getOperations",{page:void 0,limit:void 0},t=>{t.data.operations.push({...e,id:a,loading:!0})}));try{let{data:e}=await r;n(i.util.updateQueryData("getOperations",{page:void 0,limit:void 0},t=>{let n=t.data.operations.findIndex(e=>e.id===a);n>=0&&(t.data.operations[n]=e.data)}))}catch(e){l.undo()}}}),updateOperation:e.mutation({query:e=>{let{id:t,...n}=e;return{url:"/operation/".concat(t),method:"PATCH",body:n}},async onQueryStarted(e,t){let{id:n,...r}=e,{dispatch:a,queryFulfilled:l}=t,s=a(i.util.updateQueryData("getOperations",{page:void 0,limit:void 0},e=>{let t=e.data.operations.findIndex(e=>e.id===n);t>=0&&(e.data.operations[t]={...e.data.operations[t],...r})}));try{let{data:e}=await l;a(i.util.updateQueryData("getOperations",{page:void 0,limit:void 0},t=>{let i=t.data.operations.findIndex(e=>e.id===n);i>=0&&(t.data.operations[i]=e.data)}))}catch(e){s.undo()}}}),deleteOperation:e.mutation({query:e=>({url:"/operation/".concat(e),method:"DELETE"}),async onQueryStarted(e,t){let{dispatch:n,queryFulfilled:r}=t,a=n(i.util.updateQueryData("getOperations",{page:void 0,limit:void 0},t=>{t.data.operations.find(t=>t.id===e)&&(t.data.loading=!0)}));try{await r,n(i.util.updateQueryData("getOperations",{page:void 0,limit:void 0},t=>{let n=t.data.operations.findIndex(t=>t.id===e);n>=0&&t.data.operations.splice(n,1)}))}catch(e){a.undo()}}}),getSingleOperation:e.query({query:e=>({url:"/bed/bedCategory/".concat(e)})})})}),{useCreateOperationMutation:r,useUpdateOperationMutation:a,useDeleteOperationMutation:l,useGetSingleOperationQuery:s,useGetOperationsQuery:o}=i},25626:function(e,t,n){"use strict";let i;n.d(t,{H3:function(){return c},Z2:function(){return h},Zw:function(){return j},_W:function(){return d},gu:function(){return p},lF:function(){return x},mC:function(){return g},s9:function(){return m},se:function(){return v}});var r=n(79258),a=n(69192),l=n(28317);function s(){return i||(i=(0,l.MT)("test-frequency-store","test-frequency")),i}let o=new Intl.Collator,d=(0,r.createAsyncThunk)("tests/setAdminTests",async e=>{let t=await (0,l.qh)().catch(()=>[]);return t.length?(await (0,l.vw)(t,s()),(0,l.ZH)()):t=await (0,l.qh)(s()).catch(()=>[]),[e,t]}),c=(0,r.createAsyncThunk)("tests/increaseTestFrequencies",async e=>(await Promise.all(e.map(e=>(0,l.Vx)(e.id,e=>(e||0)+1),s())).catch(),await (0,l.qh)(s()).catch(()=>[]))),u=(0,r.createSlice)({name:"tests",initialState:{adminCategories:[],adminTests:null,superAdminCategories:[]},reducers:{setAdminCategories:(e,t)=>{e.adminCategories=t.payload},removeAdminCategories:(e,t)=>{var n;e.adminCategories=null===(n=e.adminCategories)||void 0===n?void 0:n.filter(e=>e.id!==t.payload.id)},updateTestsInAdminCategories:(e,t)=>{var n;let i=t.payload;console.log(i),e.adminCategories=null===(n=e.adminCategories)||void 0===n?void 0:n.map(e=>({...e,tests:e.tests.map(e=>i.find(t=>t.id===e.id)||e)}))},removeTestFromAdminCategories:(e,t)=>{var n;e.adminCategories=null===(n=e.adminCategories)||void 0===n?void 0:n.map(e=>({...e,tests:e.tests.filter(e=>e.id!==t.payload.id)}))},removeTestFromSuperAdminCategories:(e,t)=>{var n;e.superAdminCategories=null===(n=e.superAdminCategories)||void 0===n?void 0:n.map(e=>({...e,tests:e.tests.filter(e=>e.id!==t.payload.id)}))},setSuperAdminCategories:(e,t)=>{e.superAdminCategories=t.payload},removeSuperAdminCategories:(e,t)=>{var n;e.superAdminCategories=null===(n=e.superAdminCategories)||void 0===n?void 0:n.filter(e=>e.id!==t.payload.id)}},extraReducers:e=>{e.addCase(d.fulfilled,(e,t)=>{let n=t.payload[0],i=new Map(t.payload[1]);if(Array.isArray(n))e.adminTests=[...n];else{if(e.adminTests){let t=e.adminTests.findIndex(e=>e.id===n.id);t>=0?e.adminTests[t]=n:e.adminTests.push(n)}else e.adminTests=[n];if(e.adminCategories){for(let t=0;t<e.adminCategories.length;t++)for(let i=0;i<e.adminCategories[t].tests.length;i++)if(n.id===e.adminCategories[t].tests[i].id){e.adminCategories[t].tests[i]=n;break}}}e.adminTests.sort((e,t)=>{var n,r;return(null!==(n=i.get(t.id))&&void 0!==n?n:0)-(null!==(r=i.get(e.id))&&void 0!==r?r:0)||o.compare(e.name,t.name)})}),e.addCase(c.fulfilled,(e,t)=>{var n;let i=new Map(t.payload);null===(n=e.adminTests)||void 0===n||n.sort((e,t)=>{var n,r;return(null!==(n=i.get(t.id))&&void 0!==n?n:0)-(null!==(r=i.get(e.id))&&void 0!==r?r:0)||o.compare(e.name,t.name)})})}});(0,a.createSelector)([e=>e.tests.adminCategories],e=>new Map(null==e?void 0:e.map(e=>[+e.id,e])));let{setAdminCategories:h,removeAdminCategories:m,setSuperAdminCategories:p,removeSuperAdminCategories:x,removeTestFromAdminCategories:v,removeTestFromSuperAdminCategories:g,updateTestsInAdminCategories:j}=u.actions;t.ZP=u.reducer},49854:function(e,t,n){"use strict";let i;n.d(t,{d:function(){return d},x:function(){return o}});var r=n(72940),a=n(6780),l=n(67732),s=n(28317);function o(){return i||(i=(0,s.MT)("cached-responses-store","cached-responses")),i}async function d(e,t){try{let n=await a.default.get(e,{baseURL:"http://sasthotech.local:5000/api/v1",params:t,...r.FD});return await (0,s.t8)(e,n.data,o()),n.data}catch(t){if(t instanceof l.d7&&[l.d7.ERR_NETWORK,l.d7.ETIMEDOUT].includes(t.code)){let t=await (0,s.U2)(e,o());if(t)return t}throw t instanceof l.d7&&t.response&&401===t.response.status||console.error(t),t}}}},function(e){e.O(0,[1601,3069,6945,3852,1656,9722,4670,9258,9533,966,12,7538,1166,7967,6029,6306,7698,7186,4927,1493,9669,7140,7125,5865,2994,9175,7402,1744],function(){return e(e.s=17532)}),_N_E=e.O()}]);
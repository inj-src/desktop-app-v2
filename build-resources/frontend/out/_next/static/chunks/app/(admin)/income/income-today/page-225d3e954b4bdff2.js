(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7366],{95094:function(e,t,n){Promise.resolve().then(n.bind(n,89686))},89686:function(e,t,n){"use strict";n.r(t);var a=n(68328),i=n(32451),r=n(68242),o=n(89043),d=n(22614),l=n(55911),s=n(31204),c=n(22041),u=n(46373),m=n(13822),y=n(54632),h=n(11114),x=n(75865),p=n(3741),g=n(22975),f=n(41224),v=n(87967),j=n(29259),I=n(47720),D=n(86083),C=n(50430),b=n(59982),E=n(9326),w=n(18190),S=n(45437),T=n(12697),Q=n(35288),A=n(4505),k=n(80805),z=n(96871),L=n(25499),P=n(78259),q=n(76607),B=n(97698);t.default=()=>{let[e,t]=(0,A.useState)(!1),[n,F]=(0,A.useState)(!1),[O,Z]=(0,A.useState)(null),M=(0,L.C)(e=>e.auth.user),R=(0,L.C)(e=>e.diagnosticSettings.viewId),[N,U]=(0,A.useState)(""),_=(0,L.C)(e=>e.dates.dates),{data:G,isLoading:H,error:W,refetch:V}=(0,k.aW)({from:((null==_?void 0:_[0])?(0,P.Z)(new Date(_[0])):(0,P.Z)(new Date)).toISOString(),to:((null==_?void 0:_[1])?(0,q.Z)(new Date(_[1])):(0,q.Z)(new Date)).toISOString(),userId:(null==M?void 0:M.role)==="admin"&&R?R:void 0},{refetchOnMountOrArgChange:!0}),{data:K,isLoading:X}=(0,z.Uz)(),[Y,{isLoading:J}]=(0,k.Qd)(),[$,{isLoading:ee}]=(0,k.EP)(),et=(0,I.c)({initialValues:{receivedFrom:"",amount:0,description:"",dailyIncomeCategoryId:""},validate:{receivedFrom:e=>0===e.trim().length?"Received from is required":null,amount:e=>e<=0?"Amount must be greater than 0":null,dailyIncomeCategoryId:e=>0===e.trim().length?"Income category is required":null}}),en=e=>{Z(e.id),et.setValues({receivedFrom:e.receivedFrom,amount:e.amount,description:e.description||"",dailyIncomeCategoryId:e.dailyIncomeCategoryId||""}),t(!0)},ea=e=>{Z(e),F(!0)},ei=async e=>{try{O&&await Y({id:O,...e}).unwrap(),t(!1)}catch(e){console.error("Failed to update income:",e)}},er=async()=>{try{O&&await $(O).unwrap(),F(!1)}catch(e){console.error("Failed to delete income:",e)}},eo=(null==G?void 0:G.data.filter(e=>{var t,n;if(!N.trim())return!0;let a=N.toLowerCase();return e.receivedFrom.toLowerCase().includes(a)||(null===(t=e.description)||void 0===t?void 0:t.toLowerCase().includes(a))||(null===(n=e.invoiceNumber)||void 0===n?void 0:n.toLowerCase().includes(a))}))||[],ed=eo.reduce((e,t)=>e+t.amount,0),el=e=>{if(!e||!(null==K?void 0:K.data))return"N/A";let t=K.data.find(t=>t.id===e);return t?t.name:"N/A"},es=e=>(0,B.Z)(new Date(e),"dd/MM/yyyy hh:mm a"),ec=[{value:"cash",label:"Cash"},{value:"bank",label:"Bank Transfer"},{value:"mobile",label:"Mobile Banking"},{value:"check",label:"Check"},{value:"other",label:"Other"}],eu=e=>{let t=ec.find(t=>t.value===e);return t?t.label:e};return(0,a.jsxs)(i.Box,{p:"md",children:[(0,a.jsxs)(r.Title,{order:1,mb:"xl",children:["Today","'","s Income"]}),(0,a.jsxs)(o.X,{p:"md",mb:"lg",children:[(0,a.jsxs)(d.Group,{mb:"md",children:[(0,a.jsxs)(d.Group,{children:[(0,a.jsx)(l.TextInput,{placeholder:"Search income",leftSection:(0,a.jsx)(D.Z,{size:16}),value:N,onChange:e=>U(e.currentTarget.value),style:{width:250}}),(0,a.jsx)(s.Button,{leftSection:(0,a.jsx)(C.Z,{size:16}),variant:"outline",onClick:()=>V(),children:"Refresh"})]}),(0,a.jsx)(d.Group,{children:(0,a.jsx)(s.Button,{leftSection:(0,a.jsx)(b.Z,{size:16}),variant:"outline",color:"green",children:"Export"})})]}),(0,a.jsx)(i.Box,{mb:"lg",children:(0,a.jsxs)(d.Group,{children:[(0,a.jsx)(c.Text,{size:"lg",fw:700,children:"Total Income Today:"}),(0,a.jsxs)(c.Text,{size:"lg",fw:700,color:"green",children:["৳ ",ed.toLocaleString()]})]})}),W&&(0,a.jsx)(u.b,{icon:(0,a.jsx)(E.Z,{size:16}),title:"Error",color:"red",mb:"md",children:"Failed to load income data. Please try refreshing."}),(0,a.jsxs)(i.Box,{pos:"relative",children:[(0,a.jsx)(m.f,{visible:H}),(0,a.jsxs)(y.i,{striped:!0,highlightOnHover:!0,children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Time"}),(0,a.jsx)("th",{children:"Received From"}),(0,a.jsx)("th",{children:"Category"}),(0,a.jsx)("th",{children:"Description"}),(0,a.jsx)("th",{children:"Invoice #"}),(0,a.jsx)("th",{children:"Payment Method"}),(0,a.jsx)("th",{children:"Amount"}),(0,a.jsx)("th",{children:"Actions"})]})}),(0,a.jsx)("tbody",{children:0===eo.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:8,children:(0,a.jsx)(c.Text,{ta:"center",color:"dimmed",py:"md",children:H?"Loading income data...":"No income records found for today"})})}):eo.map(e=>{var t,n;return(0,a.jsxs)("tr",{style:{opacity:e.loading?.5:1},children:[(0,a.jsx)("td",{children:es(e.createdAt)}),(0,a.jsx)("td",{children:e.receivedFrom}),(0,a.jsx)("td",{children:el(null!==(t=e.dailyIncomeCategoryId)&&void 0!==t?t:"")}),(0,a.jsx)("td",{children:e.description||"-"}),(0,a.jsx)("td",{children:e.invoiceNumber||"-"}),(0,a.jsx)("td",{children:eu(null!==(n=e.paymentMethod)&&void 0!==n?n:"")}),(0,a.jsxs)("td",{children:[(0,a.jsxs)(c.Text,{fw:600,color:"green",children:["৳ ",e.amount.toLocaleString()]}),e.isIndoorIncome&&(0,a.jsx)(h.C,{size:"xs",color:"blue",children:"Indoor"})]}),(0,a.jsx)("td",{children:(0,a.jsxs)(x.v,{position:"bottom-end",children:[(0,a.jsx)(x.v.Target,{children:(0,a.jsx)(p.A,{children:(0,a.jsx)(w.Z,{size:16})})}),(0,a.jsxs)(x.v.Dropdown,{children:[(0,a.jsx)(x.v.Item,{leftSection:(0,a.jsx)(S.Z,{size:16}),onClick:()=>en(e),disabled:e.loading,children:"Edit"}),(0,a.jsx)(x.v.Item,{leftSection:(0,a.jsx)(T.Z,{size:16}),color:"red",onClick:()=>ea(e.id),disabled:e.loading,children:"Delete"})]})]})})]},e.id)})})]})]})]}),(0,a.jsx)(g.u,{opened:e,onClose:()=>t(!1),title:"Edit Income Record",size:"lg",children:(0,a.jsx)("form",{onSubmit:et.onSubmit(ei),children:(0,a.jsxs)(f.Stack,{gap:"md",pos:"relative",children:[(0,a.jsx)(m.f,{visible:J}),(0,a.jsxs)(i.Box,{children:[(0,a.jsx)(c.Text,{mb:"xs",children:"Income Category"}),(0,a.jsx)(v.P,{placeholder:"Select category",data:(null==K?void 0:K.data.map(e=>({value:e.id,label:e.name})))||[],searchable:!0,clearable:!0,disabled:X,...et.getInputProps("dailyIncomeCategoryId")})]}),(0,a.jsx)(l.TextInput,{label:"Description",placeholder:"Enter description",...et.getInputProps("description")}),(0,a.jsx)(l.TextInput,{label:"Received From",placeholder:"Enter person/organization name",required:!0,...et.getInputProps("receivedFrom")}),(0,a.jsx)(j.Y,{label:"Amount",placeholder:"0",required:!0,min:0,leftSection:(0,a.jsx)(Q.Z,{size:16}),...et.getInputProps("amount")}),(0,a.jsxs)(d.Group,{mt:"xl",children:[(0,a.jsx)(s.Button,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(s.Button,{type:"submit",loading:J,children:"Update"})]})]})})}),(0,a.jsx)(g.u,{opened:n,onClose:()=>F(!1),title:"Confirm Deletion",size:"sm",children:(0,a.jsxs)(i.Box,{pos:"relative",children:[(0,a.jsx)(m.f,{visible:ee}),(0,a.jsx)(c.Text,{mb:"lg",children:"Are you sure you want to delete this income record? This action cannot be undone."}),(0,a.jsxs)(d.Group,{children:[(0,a.jsx)(s.Button,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),(0,a.jsx)(s.Button,{color:"red",onClick:er,loading:ee,children:"Delete"})]})]})})]})}},72940:function(e,t,n){"use strict";n.d(t,{FD:function(){return i},Hn:function(){return a},y4:function(){return r}});let a={headers:{"Content-Type":"application/json"}},i={withCredentials:!0},r={headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}},78101:function(e,t,n){"use strict";n.d(t,{g:function(){return d}});var a=n(49854),i=n(68240),r=n(94183),o=n(28317);let d=(0,i.LC)({baseQuery:(0,r.ni)({baseUrl:"http://sasthotech.local:5000/api/v1",credentials:"include",fetchFn:(e,t)=>fetch(e,t).then(async n=>{let i="string"==typeof e?e:e.url;return i.includes("?")||(null==t?void 0:t.body)||"string"!=typeof e&&e.body||await (0,o.t8)(i,await n.clone().json().catch(()=>null),(0,a.x)()),n}).catch(async n=>{if(n instanceof TypeError){let n="string"==typeof e?e:e.url;if(!n.includes("?")&&!(null==t?void 0:t.body)&&!("string"!=typeof e&&e.body)){let e=await (0,o.U2)(n,(0,a.x)());if(e)return new Response(e,{headers:new Headers({"Content-Type":"application/json"})})}}throw n})}),endpoints:()=>({}),tagTypes:["BillTest","doctor","hospitalBill","inventory","appointment","patient","sms","sms-dashboard","sms-messages","sms-analytics","sms-status","notice","template","versionAdmin-services","versionAdmin-versions","versionAdmin-hospitals","versionAdmin-logs","versionAdmin-sessions","versionAdmin-devices","versionAdmin-notifications","versionAdmin-notification-stats","PCMeetup","MarketerTarget","Marketer"]})},80805:function(e,t,n){"use strict";n.d(t,{Dn:function(){return d},EP:function(){return s},Qd:function(){return l},aW:function(){return o}});var a=n(78101),i=n(40085);let r=a.g.injectEndpoints({endpoints:e=>({getDailyExtraIncomes:e.query({query:e=>{let{from:t,to:n,userId:a}=e,i=new URLSearchParams;return t&&i.append("from",t),n&&i.append("to",n),a&&i.append("userId",a),console.log("params",i.toString()),{url:"/dailyExtraIncome?".concat(i.toString())}}}),createDailyExtraIncome:e.mutation({query:e=>({url:"/dailyExtraIncome",method:"POST",body:e}),async onQueryStarted(e,t){let{dispatch:n,queryFulfilled:a}=t,o=(0,i.x0)(),d=new Date().toISOString(),l=n(r.util.updateQueryData("getDailyExtraIncomes",{},t=>{t.data.push({id:o,...e,createdAt:d,updatedAt:d,loading:!0})})),s=n(r.util.updateQueryData("getDailyExtraIncomes",{},t=>{t.data.push({id:o,...e,createdAt:d,updatedAt:d,loading:!0})}));try{let{data:e}=await a;n(r.util.updateQueryData("getDailyExtraIncomes",{},t=>{let n=t.data.findIndex(e=>e.id===o);n>=0&&(t.data[n]=e.data)})),n(r.util.updateQueryData("getDailyExtraIncomes",{},t=>{let n=t.data.findIndex(e=>e.id===o);n>=0&&(t.data[n]=e.data)}))}catch(e){l.undo(),s.undo()}}}),updateDailyExtraIncome:e.mutation({query:e=>{let{id:t,...n}=e;return{url:"/dailyExtraIncome/".concat(t),method:"PATCH",body:n}},async onQueryStarted(e,t){let{id:n,...a}=e,{dispatch:i,queryFulfilled:o}=t,d=i(r.util.updateQueryData("getDailyExtraIncomes",{},e=>{let t=e.data.find(e=>e.id===n);t&&(Object.assign(t,a),t.loading=!0)})),l=i(r.util.updateQueryData("getDailyExtraIncomes",{},e=>{let t=e.data.find(e=>e.id===n);t&&(Object.assign(t,a),t.loading=!0)}));try{await o,i(r.util.updateQueryData("getDailyExtraIncomes",{},e=>{let t=e.data.find(e=>e.id===n);t&&delete t.loading})),i(r.util.updateQueryData("getDailyExtraIncomes",{},e=>{let t=e.data.find(e=>e.id===n);t&&delete t.loading}))}catch(e){d.undo(),l.undo()}}}),deleteDailyExtraIncome:e.mutation({query:e=>({url:"/dailyExtraIncome/".concat(e),method:"DELETE"}),async onQueryStarted(e,t){let{dispatch:n,queryFulfilled:a}=t,i=n(r.util.updateQueryData("getDailyExtraIncomes",{},t=>{let n=t.data.find(t=>t.id===e);n&&(n.loading=!0)})),o=n(r.util.updateQueryData("getDailyExtraIncomes",{},t=>{let n=t.data.find(t=>t.id===e);n&&(n.loading=!0)}));try{await a,n(r.util.updateQueryData("getDailyExtraIncomes",{},t=>{let n=t.data.findIndex(t=>t.id===e);n>=0&&t.data.splice(n,1)})),n(r.util.updateQueryData("getDailyExtraIncomes",{},t=>{let n=t.data.findIndex(t=>t.id===e);n>=0&&t.data.splice(n,1)}))}catch(e){i.undo(),o.undo()}}})})}),{useGetDailyExtraIncomesQuery:o,useCreateDailyExtraIncomeMutation:d,useUpdateDailyExtraIncomeMutation:l,useDeleteDailyExtraIncomeMutation:s}=r},96871:function(e,t,n){"use strict";n.d(t,{Sq:function(){return l},Uz:function(){return o},aI:function(){return s},x3:function(){return d}});var a=n(78101),i=n(40085);let r=a.g.injectEndpoints({endpoints:e=>({getDailyIncomeCategories:e.query({query:()=>({url:"/dailyExtraIncomeCategory"})}),createDailyIncomeCategory:e.mutation({query:e=>({url:"/dailyExtraIncomeCategory",method:"POST",body:e}),async onQueryStarted(e,t){let{dispatch:n,queryFulfilled:a}=t,o=(0,i.x0)(),d=n(r.util.updateQueryData("getDailyIncomeCategories",void 0,t=>{t.data.push({id:o,...e,loading:!0})}));try{let{data:e}=await a;n(r.util.updateQueryData("getDailyIncomeCategories",void 0,t=>{let n=t.data.findIndex(e=>e.id===o);n>=0&&(t.data[n]=e.data)}))}catch(e){d.undo()}}}),updateDailyIncomeCategory:e.mutation({query:e=>{let{id:t,name:n}=e;return{url:"/dailyExtraIncomeCategory/".concat(t),method:"PATCH",body:{name:n}}},async onQueryStarted(e,t){let{id:n,name:a}=e,{dispatch:i,queryFulfilled:o}=t,d=i(r.util.updateQueryData("getDailyIncomeCategories",void 0,e=>{let t=e.data.find(e=>e.id===n);t&&(void 0!==a&&(t.name=a),t.loading=!0)}));try{await o,i(r.util.updateQueryData("getDailyIncomeCategories",void 0,e=>{let t=e.data.find(e=>e.id===n);t&&delete t.loading}))}catch(e){d.undo()}}}),deleteDailyIncomeCategory:e.mutation({query:e=>({url:"/dailyExtraIncomeCategory/".concat(e),method:"DELETE"}),async onQueryStarted(e,t){let{dispatch:n,queryFulfilled:a}=t,i=n(r.util.updateQueryData("getDailyIncomeCategories",void 0,t=>{let n=t.data.find(t=>t.id===e);n&&(n.loading=!0)}));try{await a,n(r.util.updateQueryData("getDailyIncomeCategories",void 0,t=>{let n=t.data.findIndex(t=>t.id===e);n>=0&&t.data.splice(n,1)}))}catch(e){i.undo()}}})})}),{useGetDailyIncomeCategoriesQuery:o,useCreateDailyIncomeCategoryMutation:d,useUpdateDailyIncomeCategoryMutation:l,useDeleteDailyIncomeCategoryMutation:s}=r},25499:function(e,t,n){"use strict";n.d(t,{C:function(){return r},T:function(){return i}});var a=n(53502);let i=()=>(0,a.I0)(),r=a.v9},49854:function(e,t,n){"use strict";let a;n.d(t,{d:function(){return s},x:function(){return l}});var i=n(72940),r=n(6780),o=n(67732),d=n(28317);function l(){return a||(a=(0,d.MT)("cached-responses-store","cached-responses")),a}async function s(e,t){try{let n=await r.default.get(e,{baseURL:"http://sasthotech.local:5000/api/v1",params:t,...i.FD});return await (0,d.t8)(e,n.data,l()),n.data}catch(t){if(t instanceof o.d7&&[o.d7.ERR_NETWORK,o.d7.ETIMEDOUT].includes(t.code)){let t=await (0,d.U2)(e,l());if(t)return t}throw t instanceof o.d7&&t.response&&401===t.response.status||console.error(t),t}}}},function(e){e.O(0,[1601,3069,6945,3852,1656,9722,4670,9258,9533,966,12,7538,1166,7967,6306,7698,9645,5865,7735,728,9175,7402,1744],function(){return e(e.s=95094)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[417],{40104:function(e,t,n){Promise.resolve().then(n.bind(n,29514))},2929:function(e,t,n){"use strict";n.d(t,{M:function(){return o}});var r=n(68328),a=n(47137),i=n(28121),s=n.n(i);function o(e){let{html:t,containerRef:n,data:i,pageHeight:o,pageWidth:l}=e,c=null!=t?t:"<section style='width: 210mm; height: 297mm;'></section>";try{c=s().compile(c)(null!=i?i:{})}catch(e){c='\n         <div style="padding: 16px; color: #dc2626;">\n            <strong>Error:</strong> '.concat(e.message,'<br/>\n            <div style="margin-top: 8px; color: #374151; font-size: 0.875rem;">Hint: check your Handlebars expressions, registered helpers, and the shape of the provided data.</div>\n         </div>\n      ')}return(0,r.jsx)(a.i,{html:c,containerRef:n,pageHeight:o,pageWidth:l})}(0,n(36083)._L)()},72226:function(e,t,n){"use strict";n.d(t,{s:function(){return function e(t,n,i,s,o){if(!t||"object"!=typeof t)return t;let l=null!=i?i:t,c=null!=o?o:"",u=s?n:function(e){let t={};for(let[n,a]of Object.entries(e))!function e(t,n,a){let i=function(e){let t=e.trim(),n=t.match(/^\{{2,4}([^{}]+)\}{2,4}$/);n&&(t=n[1].trim()),(t.startsWith("#")||t.startsWith("/")||t.startsWith("^")||t.startsWith(">"))&&(t=t.substring(1).trim());let r=t.split(/\s+/);return r.length>1&&["each","if","unless","with","table"].includes(r[0].toLowerCase())?r[1]:r[0]}(t),s=function(e){let t=e.trim(),n=t.match(/^\{{2,4}([^{}]+)\}{2,4}$/);return n&&(t=n[1].trim()),(t.startsWith("#")||t.startsWith("^"))&&t.substring(1).trim().split(/\s+/)[0]||null}(t),o=!!s&&r.has(s.toLowerCase());if("string"==typeof n){a[i]=n;return}if(!n||"object"!=typeof n)return;if(o){for(let[t,r]of(a[i]=n.value||"",Object.entries(n)))"value"!==t&&e(t,r,a);return}let l={value:n.value||""};for(let[t,r]of Object.entries(n))"value"!==t&&e(t,r,l);a[i]=l}(n,a,t);return t}(n);return new Proxy(t,{get(t,n,r){if("symbol"==typeof n)return Reflect.get(t,n,r);let i=String(n),s=c?"".concat(c,".").concat(i):i,o=u[s];if(void 0!==o){if("string"==typeof o)return a(l,o);{let t=a(l,o.value);if(t&&"object"==typeof t){let n={};for(let[e,t]of Object.entries(o))"value"!==e&&(n[e]=t);return Array.isArray(t)?t.map(t=>e(t,n,l,!0,"")):e(t,n,l,!0,"")}return t}}let d=u[i];if(void 0!==d){if("string"==typeof d)return a(l,d);{let t=a(l,d.value);if(t&&"object"==typeof t){let n={};for(let[e,t]of Object.entries(d))"value"!==e&&(n[e]=t);return Array.isArray(t)?t.map(t=>e(t,n,l,!0,"")):e(t,n,l,!0,"")}return t}}let p=Object.keys(u).some(e=>e.startsWith(s+".")),m=Reflect.get(t,n,r);return p?e(m&&"object"==typeof m?m:{},u,l,!0,s):m&&"object"==typeof m?e(m,u,l,!0,s):m},has(e,t){let n="symbol"==typeof t?"":String(t),r=c?"".concat(c,".").concat(n):n;return!!(void 0!==u[r]||Object.keys(u).some(e=>e===r||e.startsWith(r+".")))||Reflect.has(e,t)},ownKeys(e){let t=Reflect.ownKeys(e);for(let e of Object.keys(u)){let n=null;c?e.startsWith(c+".")&&(n=e.slice(c.length+1).split(".")[0]):n=e.split(".")[0],n&&!t.includes(n)&&t.push(n)}return t},getOwnPropertyDescriptor(e,t){let n="symbol"==typeof t?"":String(t),r=c?"".concat(c,".").concat(n):n;if(void 0!==u[r]){let e=u[r];return{value:"string"==typeof e?a(l,e):a(l,e.value),writable:!0,enumerable:!0,configurable:!0}}return Object.keys(u).some(e=>e.startsWith(r+"."))?{value:{},writable:!0,enumerable:!0,configurable:!0}:Reflect.getOwnPropertyDescriptor(e,t)}})}}});let r=new Set(["if","unless"]);function a(e,t){if(e&&"object"==typeof e&&t)return t.split(".").map(e=>{let t=e.match(/^\[(\d+)\]$/);return t?parseInt(t[1],10):e}).reduce((e,t)=>{if(null!=e&&"object"==typeof e)return e[t]},e)}},36083:function(e,t,n){"use strict";n.d(t,{TP:function(){return l},_L:function(){return i},wj:function(){return o}});var r=n(28121),a=n.n(r);function i(){a().registerHelper("table",s)}function s(e,t){let n;if(!Array.isArray(e))return console.warn("table helper expects an array as the first argument, got:",e),"Handlebars table helper error: first argument is not an array";t.data&&(n=a().createFrame(t.data)),n&&(n.length=e.length);let r={data:n},i=t.fn(void 0,r),s=new DOMParser().parseFromString(i,"text/html"),o=s.querySelector("table");if(!o)return console.warn("table helper: no <table> element found in block content"),i;let l=o.querySelectorAll("tr"),c=[];for(let e of l)for(let t of e.querySelectorAll("td")){var u,d;let n=null!==(d=null===(u=t.textContent)||void 0===u?void 0:u.trim())&&void 0!==d?d:"";if(/^\\?\{\{.+\}\}$/.test(n)){c.push(e);break}}if(0===c.length)return console.warn("table helper: no template row found (no row with <td> elements)"),i;if(0===e.length)return c.forEach(e=>e.remove()),new(a()).SafeString(s.body.innerHTML);let p=c.reduceRight((e,t)=>t.outerHTML+e,""),m=a().compile("{{#each this}}".concat(p,"{{/each}}"))(e,r);return c[0].insertAdjacentHTML("afterend",m),c.forEach(e=>e.remove()),new(a()).SafeString(s.body.innerHTML)}function o(){a().registerHelper("helperMissing",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=t[t.length-1];return new(a()).SafeString('<span style="color: red; font-weight: bold;">[Missing '.concat(r.name,"]</span>"))}),a().registerHelper("blockHelperMissing",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=t[t.length-1],i=t.length>1?t[0]:this,s="function"==typeof r.fn?r.fn(i):"";return new(a()).SafeString('<div style="border: 2px solid orange; padding: 10px; margin: 5px 0;">'+'<strong style="color: orange;">[Property \''.concat(r.name,"' used as block helper]</strong>")+"<div>".concat(s,"</div>")+"</div>")})}function l(){a().unregisterHelper("blockHelperMissing"),a().unregisterHelper("helperMissing")}},47137:function(e,t,n){"use strict";n.d(t,{i:function(){return o}});var r=n(68328),a=n(4505),i=n(53830),s=n(54133);function o(e){let{html:t,containerRef:n,contentEditable:o,setHtml:c,pageHeight:u,pageWidth:d}=e,p=(0,a.useRef)(t),m=(0,a.useRef)(t);(0,a.useEffect)(()=>()=>{let e=(0,s.jY)(p.current);e!==m.current&&(null==c||c(e),m.current=e)},[c]);let h="<style>\n      section {\n         width: ".concat(d||210,"mm !important; \n         min-height: ").concat(u||297,"mm !important;\n         overflow: hidden;\n      } \n   </style>");return(0,r.jsxs)(i.ZP.div,{children:[(0,r.jsx)(l,{}),(0,r.jsx)("div",{ref:n,dangerouslySetInnerHTML:{__html:h+t},contentEditable:o,onInput:e=>{p.current=e.currentTarget.innerHTML}})]})}function l(){return(0,r.jsx)("style",{children:"\n         section {\n            border: 1px solid #ccc;\n            box-shadow: 0 1px 3px rgba(112, 112, 112, 0.3);\n         }\n         section + section {\n            marginTop: 1rem;\n         }\n      "})}},29514:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eK}});var r=n(68328);n(71607);var a=n(13822),i=n(12450),s=n(70103),o=n(36409),l=n(41224),c=n(58812),u=n(53729),d=n(22041),p=n(31204),m=n(64978),h=n(63998),f=n(13520);function g(){return(0,r.jsx)(o.M,{h:"calc(100dvh - 64px)",children:(0,r.jsxs)(l.Stack,{align:"center",gap:"lg",children:[(0,r.jsx)(c.k,{size:100,radius:"xl",variant:"gradient",gradient:{from:"blue.3",to:"blue.6",deg:-180},children:(0,r.jsx)(m.Z,{style:{width:(0,u.h)(50),height:(0,u.h)(50)},stroke:1.5})}),(0,r.jsxs)(l.Stack,{align:"center",gap:"xs",children:[(0,r.jsx)(d.Text,{size:"xl",fw:700,c:"dimmed",children:"Template Not Found"}),(0,r.jsx)(d.Text,{c:"dimmed",size:"md",ta:"center",maw:400,children:"The template you're looking for doesn't exist or may have been deleted. Please check the URL or go back to browse available templates."})]}),(0,r.jsx)(p.Button,{component:f.default,href:"/templates",variant:"light",leftSection:(0,r.jsx)(h.Z,{size:16}),radius:"md",children:"Back to Templates"})]})})}var x=n(4505);let y=0;function v(){return"expr_".concat(++y)}function b(e){let t=[],n=0;for(;n<e.length;){if("\\"===e[n]&&"{{"===e.substring(n+1,n+3)){let r=j(e,n+1);if(r){r.expression.raw="\\"+r.expression.raw,t.push(r.expression),n=r.endPos;continue}}if("{{"===e.substring(n,n+2)){let r=j(e,n);if(r){if("comment"===r.expression.type&&("else"===r.expression.content||r.expression.content.startsWith("else "))){n=r.endPos;continue}t.push(r.expression),n=r.endPos;continue}}n++}return t}function j(e,t){let n=0,r=t;for(;"{"===e[r];)n++,r++;if(n<2)return null;"}".repeat(n);let a=e[r];if("#"===a)return w(e,t,n);if("/"===a)return null;if(">"===a){let a=T(e,r,n);if(-1===a)return null;let i=e.substring(r,a).trim(),s=e.substring(t,a+n);return{expression:{id:v(),raw:s,content:i.substring(1).trim(),type:"partial"},endPos:a+n}}if("!"===a){let a=T(e,r,n);if(-1===a)return null;let i=e.substring(r,a).trim(),s=e.substring(t,a+n);return{expression:{id:v(),raw:s,content:i.substring(1).trim(),type:"comment"},endPos:a+n}}{if("^"===a)return w(e,t,n);let i=T(e,r,n);if(-1===i)return null;let s=e.substring(r,i).trim();if("else"===s||s.startsWith("else "))return{expression:{id:v(),raw:e.substring(t,i+n),content:s,type:"comment"},endPos:i+n};let o=e.substring(t,i+n);return{expression:{id:v(),raw:o,content:s,type:"expression"},endPos:i+n}}}function w(e,t,n){let r="{".repeat(n);"}".repeat(n);let a=T(e,t+n,n);if(-1===a)return null;let i=e.substring(t+n,a).trim(),s=(i.startsWith("^"),i.substring(1)).match(/^(\S+)/);if(!s)return null;let o=s[1],l="".concat(r,"/").concat(o),c=1,u=a+n,d=-1;for(;u<e.length&&c>0;){let t="".concat(r,"#").concat(o);if(e.substring(u,u+t.length)===t){c++,u+=t.length;continue}if(e.substring(u,u+l.length)===l){if(0==--c){d=u;break}u+=l.length;continue}u++}if(-1===d)return null;let p=T(e,d+n,n);if(-1===p)return null;let m=b(e.substring(a+n,d)),h=e.substring(t,a+n);return{expression:{id:v(),raw:h,content:i,type:"block",helperName:o,children:m},endPos:p+n}}function T(e,t,n){let r="}".repeat(n),a=t;for(;a<e.length;){let t=e.indexOf(r,a);if(-1===t)break;if(n<4&&"}"===e[t+n]){a=t+1;continue}return t}return -1}var S=n(62717),C=n(31151),k=n(54133),M=n(52492),z=n(70356);n(89882);var D=n(25499),E=n(94441);M.Z.registerLanguage("json",z.Z);let H=(0,x.createContext)(null),L=()=>{let e=(0,x.useContext)(H);if(!e)throw Error("useTemplate must be used within a TemplateProvider");return e},P=e=>{let{children:t,template:n}=e,[a,i]=(0,x.useState)(null),[s,o]=(0,x.useState)(null),[l,c]=(0,x.useState)(null),[u,d]=(0,x.useState)(""),{transformFunction:p,category:m,html:h}=n,{executeFunction:f}=(0,S.U)();(0,x.useEffect)(()=>{e();async function e(){if(p)try{let e=await f(p,m.dummyData);i(e)}catch(t){let e=t instanceof Error?t.message:"Failed to update custom fields";C.toast.error(e),console.error("Failed to update custom fields:",t)}}},[m.dummyData,f,p]),(0,x.useEffect)(()=>{if(h){var e;let t=(y=0,b(h)),r=function e(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a={};for(let i of t){let t=i.raw,s=n[t];if("block"===i.type&&i.children&&i.children.length>0){let n={value:""};if("object"==typeof s&&null!==s)for(let a of(n.value=s.value||"",i.children)){let i=a.raw,o=s[i];if("block"===a.type&&a.children&&a.children.length>0){let s={};"object"==typeof o&&null!==o&&Object.assign(s,{[i]:o});let l=e([a],s,[...r,t]);l[i]?n[i]=l[i]:n[i]={value:""}}else n[i]="string"==typeof o?o:""}else for(let e of i.children){let t=e.raw;"block"===e.type&&e.children&&e.children.length>0?n[t]={value:""}:n[t]=""}a[t]=n}else a[t]="string"==typeof s?s:""}return a}(t,null!==(e=n.expressionMap)&&void 0!==e?e:{});o(t),c(r)}},[h,n.expressionMap]);let g=(0,D.C)(e=>e.auth.diagnostic);return(0,x.useEffect)(()=>{let e=(0,k.b3)(n.category.dummyData,a);if(e){let t=JSON.stringify({...e,diagnosticInfo:(0,E.B)(g)},null,2),n=document.createElement("pre");n.innerHTML=M.Z.highlight(t,{language:"json"}).value,(0,k.o4)(n),d(()=>n.innerHTML)}},[a,g,u,n.category.dummyData]),(0,r.jsx)(H.Provider,{value:{template:n,customFields:a,setCustomFields:i,expressions:s,expressionMap:l,setExpressionMap:c,highlightedJSON:u},children:t})};var F=n(7667),O=n(89822),A=n(32451),N=n(13342),I=n(63889),R=n(22614),Z=n(50669),B=n(84954),W=n.n(B),U=n(13562),J=n.n(U),q=n(258),G=n(96467);function _(e){let{value:t,onChange:n,className:a,style:i,language:s="javascript",placeholder:o="// Enter your code here...",readOnly:l=!1}=e,[c,u]=(0,x.useState)(t);return(0,x.useEffect)(()=>{u(t)},[t]),(0,r.jsxs)("div",{style:{border:"1px solid #e0e0e0",borderRadius:"6px",overflow:"auto",backgroundColor:"#fafafa",...i},className:"jsx-f70f6267d79ea3bf "+(a||""),children:[(0,r.jsx)(J(),{value:c,onValueChange:e=>{u(e),null==n||n(e)},highlight:e=>{if(!e)return"";try{return M.Z.highlight(e,{language:"html"===s?"xml":s}).value}catch(t){return e}},padding:12,placeholder:o,disabled:l,tabSize:2,insertSpaces:!0,style:{fontFamily:"'JetBrains Mono', 'Fira Code', 'Consolas', monospace",fontSize:13,lineHeight:1.5,minHeight:"100px"},textareaClassName:"code-editor-textarea",preClassName:"code-editor-pre"}),(0,r.jsx)(W(),{id:"f70f6267d79ea3bf",children:".code-editor-textarea{outline:none!important;caret-color:#333}.code-editor-textarea:focus{outline:none!important}.code-editor-pre{min-height:100px}"})]})}function V(){let{template:e,setCustomFields:t}=L(),{id:n,transformFunction:a,category:i}=e,[o,c]=(0,x.useState)(a||"function run(data) {\n  return {\n    newField: 'hello world'\n  };\n}"),{executeFunction:u,isExecuting:m,lastError:h}=(0,S.U)(),[f]=(0,s.wD)();(0,x.useEffect)(()=>{a&&c(a)},[a]);let g=async()=>{try{let e=await u(o,i.dummyData);if(t(e),C.toast.success("Applied to customFields"),!n)return;await f({id:n,transformFunction:o}).unwrap()}catch(e){C.toast.error("Failed to save transform function."),console.error(e)}};return(0,x.useEffect)(()=>{h&&C.toast.error(h)},[h]),(0,r.jsxs)(l.Stack,{gap:"sm",px:"md",children:[(0,r.jsxs)(l.Stack,{gap:"xs",children:[(0,r.jsx)(d.Text,{size:"sm",fw:500,c:"gray.7",children:"Custom Fields Function"}),(0,r.jsxs)(d.Text,{size:"xs",c:"dimmed",children:["Define a function that receives JSON data and returns an object. The returned object will be added to ",(0,r.jsx)(I.E,{children:"customFields"}),"."]})]}),(0,r.jsx)(_,{value:o,onChange:c,style:{minHeight:200}}),(0,r.jsx)(R.Group,{grow:!0,children:(0,r.jsx)(p.Button,{onClick:g,disabled:m,size:"sm",leftSection:(0,r.jsx)(Z.Z,{style:{width:16,height:16}}),children:m?"Running...":"Run Function"})})]})}M.Z.registerLanguage("javascript",q.Z),M.Z.registerLanguage("xml",G.Z),M.Z.registerLanguage("json",z.Z);var Y=n(78994),X=n(77379),$=n(6132),K=n(70748),Q=n(73626);function ee(){let{template:e}=L(),[t]=(0,s.pi)(),n=(0,x.useMemo)(()=>JSON.stringify(e.category.dummyData,null,2),[e.category.dummyData]),a=(0,Q.y)(async n=>{try{let r=JSON.parse(n);e.category.name&&await t({ctgId:e.category.name,dummyData:r}).unwrap(),C.toast.info("Dummy data updated successfully.")}catch(e){e instanceof SyntaxError||(C.toast.error("Failed to save data changes."),console.error(e))}},1e3);return(0,r.jsx)(_,{value:n,onChange:a,language:"json",style:{border:"none",borderRadius:0,height:"100%"}})}function et(){let{highlightedJSON:e}=L(),t=(0,x.useRef)(null),[n,a]=(0,x.useState)("finger"),i=(0,x.useCallback)(e=>{let t=e.target.getAttribute("data-path");t&&navigator.clipboard.writeText(t).then(()=>{C.toast.success("Copied: ".concat(t))})},[]),s={value:"finger",label:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)($.Z,{size:16}),(0,r.jsx)(Y.T,{children:"Interactive View"})]})},o={value:"code",label:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(K.Z,{size:16}),(0,r.jsx)(Y.T,{children:"Code View"})]})};return(0,r.jsxs)(A.Box,{px:"md",miw:"300px",children:[(0,r.jsxs)(l.Stack,{gap:"xs",mb:"md",children:[(0,r.jsx)(d.Text,{size:"sm",fw:500,c:"gray.7",children:"Template Data"}),(0,r.jsx)(d.Text,{size:"xs",c:"dimmed",children:"Inspect the JSON structure of your template. Use the interactive view to copy data paths by clicking on values."})]}),(0,r.jsxs)(A.Box,{style:{position:"relative",borderRadius:"8px",overflow:"hidden"},children:[(0,r.jsx)(X.s,{style:{position:"absolute",top:4,right:4},value:n,onChange:e=>a(e),size:"xs",data:[s,o]}),(0,r.jsxs)(A.Box,{style:{flex:1,overflow:"auto"},children:["finger"===n&&(0,r.jsx)("pre",{ref:t,onClick:i,style:{padding:"12px",margin:0,background:"#99999910",fontFamily:"'JetBrains Mono', 'Fira Code', 'Consolas', monospace",fontSize:13,lineHeight:1.5,minHeight:"100px"},dangerouslySetInnerHTML:{__html:e}}),"code"===n&&(0,r.jsx)(ee,{})]})]})]})}var en=n(75288),er=n(14587),ea=n(55911);function ei(){let{template:e,setExpressionMap:t,expressions:n}=L(),{expressionMap:a,html:i,id:o}=e,[c,{isLoading:u}]=(0,s.wD)(),[p,m]=(0,x.useState)(!1),h=(0,x.useCallback)(async e=>{try{await c({id:o,expressionMap:e}).unwrap(),m(!1)}catch(e){m(!1),C.toast.error("Failed to save expression mappings. Changes have been reverted."),console.error("Failed to update expression mappings:",e)}},[o,c]),f=(0,Q.y)(e=>{h(e)},{delay:500,flushOnUnmount:!0}),g=(0,x.useCallback)((e,n)=>{var r;let i=(r=null!=a?a:{},"function"==typeof structuredClone?structuredClone(r):JSON.parse(JSON.stringify(r)));(function(e,t,n){if(1===t.length){e[t[0]]=n;return}let[r,...a]=t;e[r]||(e[r]={value:""}),"string"==typeof e[r]&&(e[r]={value:e[r]});let i=e[r];1===a.length&&"value"===a[0]?i.value=n:1===a.length?i[a[0]]=n:function e(t,n,r){if(1===n.length){t[n[0]]=r;return}let[a,...i]=n;t[a]||(t[a]={value:""}),"string"==typeof t[a]&&(t[a]={value:t[a]});let s=t[a];1===i.length&&"value"===i[0]?s.value=r:1===i.length?s[i[0]]=r:e(s,i,r)}(i,a,n)})(i,e,n),t(i),m(!0),f(i)},[a,t,f]),y=(0,x.useCallback)(e=>{let t=(null!=a?a:{})[e[0]];for(let n=1;n<e.length;n++){if("object"!=typeof t||null===t)return"";t=t[e[n]]}return"string"==typeof t?t:"object"==typeof t&&(null==t?void 0:t.value)?t.value:""},[a]);return i?(null==n?void 0:n.length)===0?(0,r.jsx)(A.Box,{px:"md",children:(0,r.jsxs)(l.Stack,{gap:"xs",mb:"md",children:[(0,r.jsx)(d.Text,{size:"sm",fw:500,c:"gray.7",children:"Expression Mappings"}),(0,r.jsx)(d.Text,{size:"xs",c:"dimmed",children:"No expressions found in the template."})]})}):(0,r.jsxs)(A.Box,{px:"md",pb:"xl",children:[(0,r.jsxs)(l.Stack,{gap:"xs",mb:"md",children:[(0,r.jsxs)(A.Box,{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)(d.Text,{size:"sm",fw:500,c:"gray.7",children:"Expression Mappings"}),(u||p)&&(0,r.jsxs)(A.Box,{style:{display:"flex",alignItems:"center",gap:"6px"},children:[(0,r.jsx)(er.Loader,{size:12}),(0,r.jsx)(d.Text,{size:"xs",c:"dimmed",children:u?"Saving...":"Pending..."})]})]}),(0,r.jsx)(d.Text,{size:"xs",c:"dimmed",children:"Map template expressions to data paths. Enter the path from your JSON data."})]}),(0,r.jsx)(l.Stack,{gap:"md",children:null==n?void 0:n.map(e=>(0,r.jsx)(es,{expression:e,path:[e.raw],depth:0,getValue:y,onChange:g},e.id))})]}):(0,r.jsx)(A.Box,{px:"md",children:(0,r.jsxs)(l.Stack,{gap:"xs",mb:"md",children:[(0,r.jsx)(d.Text,{size:"sm",fw:500,c:"gray.7",children:"Expression Mappings"}),(0,r.jsx)(d.Text,{size:"xs",c:"dimmed",children:"No template loaded. Upload a template to see handlebars expressions."})]})})}function es(e){let{expression:t,path:n,depth:a,getValue:i,onChange:s}=e,o="block"===t.type,c=o&&t.children&&t.children.length>0,u=o?[...n,"value"]:n,d=i(u),[p,m]=(0,x.useState)(d);(0,x.useEffect)(()=>{m(d)},[d]);let h=(0,Q.y)(e=>{s(u,e)},{delay:500});return(0,r.jsx)(A.Box,{ml:16*a,children:(0,r.jsxs)(l.Stack,{gap:"xs",children:[(0,r.jsxs)(A.Box,{children:[(0,r.jsx)("pre",{dangerouslySetInnerHTML:{__html:M.Z.highlight(t.raw,{language:"handlebars"}).value},style:{marginBottom:"2px"}}),(0,r.jsx)(ea.TextInput,{size:"xs",mt:4,value:p,onChange:e=>{let t=e.currentTarget.value;m(t),h(t)},styles:{input:{fontFamily:'"JetBrains Mono", "Fira Code", Consolas, monospace',fontSize:"12px",background:"#f8f8f8ff"}}})]}),c&&(0,r.jsx)(A.Box,{pl:"md",style:{borderLeft:"2px solid var(--mantine-color-gray-3)"},children:(0,r.jsx)(l.Stack,{gap:"sm",children:t.children.map(e=>(0,r.jsx)(es,{expression:e,path:[...n,e.raw],depth:0,getValue:i,onChange:s},e.id))})}),o&&(0,r.jsx)(I.E,{c:"gray.6",bg:"gray.1",fz:"xs",children:"{{/"+t.helperName+"}}"})]})})}M.Z.registerLanguage("handlebars",en.Z);var eo=n(76029),el=n(75865),ec=n(3741),eu=n(77303),ed=n(92034),ep=n(42870),em=n(59406),eh=n(29728),ef=n(77255),eg=n(56651),ex=n(21119),ey=n(12921),ev=n(22975),eb=n(72375);function ej(e){let{opened:t,onClose:n,data:a,onImported:i}=e,{template:o}=L(),[c,{isLoading:u}]=(0,s.wD)(),[m,{isLoading:h}]=(0,s.pi)(),f="string"==typeof(null==a?void 0:a.html),g=(null==a?void 0:a.expressionMap)!==void 0&&(null==a?void 0:a.expressionMap)!==null,y="string"==typeof(null==a?void 0:a.transformFunction),v=(null==a?void 0:a.dummyData)!==void 0&&(null==a?void 0:a.dummyData)!==null,b=f&&g&&y&&v,[j,w]=(0,x.useState)(!1),[T,S]=(0,x.useState)(!1),[k,M]=(0,x.useState)(!1),[z,D]=(0,x.useState)(!1);(0,x.useEffect)(()=>{t&&(w(f),S(g),M(y),D(v&&!o.category.dummyData))},[t,f,g,v,o.category.dummyData,y,b]);let E=u||h,H=(0,x.useMemo)(()=>j||T||k||z,[j,T,k,z]);async function P(){if(!a){C.toast.error("No import data available");return}if(!H){C.toast.error("Select at least one field to import");return}let e=[],t={id:o.id};if(j&&f&&(t.html=a.html),T&&g&&(t.expressionMap=a.expressionMap),k&&y&&(t.transformFunction=a.transformFunction),Object.keys(t).length>1&&e.push(c(t).unwrap()),z&&v&&e.push(m({ctgId:o.category.name,dummyData:a.dummyData}).unwrap()),0===e.length){C.toast.error("No valid fields selected for import");return}try{await Promise.all(e),C.toast.success("Template has been updated"),null==i||i(),n()}catch(e){C.toast.error(function(e,t){if(e instanceof Error)return e.message;if("object"==typeof e&&e&&"data"in e){var n;if(null===(n=e.data)||void 0===n?void 0:n.message)return e.data.message}return t}(e,"Failed to update template"))}}return(0,r.jsx)(ev.u,{opened:t,onClose:n,title:"Import Template",centered:!0,children:(0,r.jsxs)(l.Stack,{gap:"sm",children:[(0,r.jsx)(d.Text,{size:"sm",c:"dimmed",children:"Select which fields you want to import."}),(0,r.jsx)(eb.X,{label:"Import HTML",checked:j,onChange:e=>w(e.currentTarget.checked),disabled:!f}),(0,r.jsx)(eb.X,{label:"Import Expression Map",checked:T,onChange:e=>S(e.currentTarget.checked),disabled:!g}),(0,r.jsx)(eb.X,{label:"Import Transform Function",checked:k,onChange:e=>M(e.currentTarget.checked),disabled:!y}),(0,r.jsx)(eb.X,{label:"Import DummyData",checked:z,onChange:e=>D(e.currentTarget.checked),disabled:!v}),z&&!!o.category.dummyData&&(0,r.jsxs)(d.Text,{c:"red",size:"sm",children:["Warning: It will overwrite the ",(0,r.jsx)(I.E,{children:"DummyData"})," for the"," ",(0,r.jsx)(I.E,{children:o.category.name})," category."]}),(0,r.jsxs)(R.Group,{justify:"flex-end",mt:"sm",children:[(0,r.jsx)(p.Button,{variant:"default",onClick:n,disabled:E,children:"Cancel"}),(0,r.jsx)(p.Button,{onClick:P,loading:E,disabled:!H,children:"Import"})]})]})})}let ew=e=>{let{pageSizeName:t,pageWidth:n,pageHeight:r}=e;return'You are an expert HTML template generator. Generate HTML templates following these strict rules:\n\n## Document Structure\n\n1. **Page Container**: Use `<section>` tags as page containers\n   - Each `<section>` represents a single page\n   - Must have predefined width and height (e.g., `style="width: '.concat(n,"mm; height: ").concat(r,'mm;"` for ').concat(t,")\n   - DON'T Include HTML tags like `<html>`, `<head>`, `<body>`, `<!DOCTYPE html>`\n   - Put the style tags outside and before sections  \n\n2. **Multiple Pages**: Use multiple `<section>` tags for multi-page documents\n   ```html\n   <section style=\"width: ").concat(n,"mm; height: ").concat(r,'mm;">\n     <!-- Page 1 content -->\n   </section>\n   <section style="width: ').concat(n,"mm; height: ").concat(r,"mm;\">\n     <!-- Page 2 content -->\n   </section>\n   ```\n\n3. **Document Header**: Use `<header>` inside each `<section>` for page headers\n   - Headers repeat on each page\n   \n4. **Document Footer**: Use `<footer>` inside each `<section>` for page footers\n   - Footers appear at the bottom of each page\n   \n5. **Page Body**: Use `<article>` for the main content area\n   - Contains the primary document content\n   - Placed between header and footer\n   - Should have `margin-bottom: auto;` to push footer down\n\n## Section CSS Structure\n   - Strictly use inline css or style tags within the HTML document, no external CSS files or classnames.\n\n```css\nsection {\n  box-sizing: border-box;\n  display: flex;\n  flex-flow: column nowrap;\n  position: relative;\n  overflow: hidden;\n}\nsection > article {\n  margin-bottom: auto;\n  z-index: 1;\n}\nsection > footer {\n  z-index: 1;\n}\n```\n\n## Handlebars Templating\n\nOnly use built-in Handlebars helpers and the custom 'table' helper, avoid very long variable names.\n\n1. **Variables**: `{{variableName}}` or `{{object.property}}`\n2. **Each loops**: `{{#each items}}...{{/each}}`\n3. **Conditionals**: `{{#if condition}}...{{/if}}`\n4. **Raw HTML**: Use triple braces `{{{rawHtmlContent}}}`\n\n### Table Helper (for dynamic tables)\n```html\n{{#table arrayData}}\n  <table>\n    <tr><th>Name</th><th>Amount</th></tr>\n    <tr><td>\\{{name}}</td><td>\\{{amount}}</td></tr>\n  </table>\n{{/table}}\n```\nNote: The table helper automatically targets the first `<table>` element in the block. Use `\\{{}}` (single backslash) for row template variables inside table.\n\n## Styling Guidelines\n\n1. Use inline styles or `<style>` tags (no external CSS files)\n2. Use print-friendly units: pt, mm, in, cm\n3. Avoid px for print layouts (use pt instead: 1pt ≈ 1.333px)\n4. Use `box-sizing: border-box;` on all elements\n5. Set explicit widths for table columns\n\n## Example Template Structure\n```html\n<style>\n  section {\n    box-sizing: border-box;\n    display: flex;\n    flex-flow: column nowrap;\n    padding: 14pt;\n  }\n  section > article { margin-bottom: auto; }\n</style>\n\n<section style=\"width: ").concat(n,"mm; height: ").concat(r,'mm;">\n  <header>\n    <h1>{{documentTitle}}</h1>\n    <p>{{organization.name}}</p>\n  </header>\n  \n  <article>\n    <p>Patient: {{patient.name}}</p>\n    {{#table items}}\n      <table>\n        <tr><th>Item</th><th>Price</th></tr>\n        <tr><td>\\{{name}}</td><td>\\{{price}}</td></tr>\n      </table>\n    {{/table}}\n  </article>\n  \n  <footer>\n    <p>Page 1 | Printed: {{printDate}}</p>\n  </footer>\n</section>\n```\n\n## Important Notes\n- Always include the section flex CSS for proper layout\n- Use semantic HTML elements (header, footer, article)\n- Keep styles inline or in style tags for portability\n- Test with ').concat(t," dimensions (").concat(n,"mm \xd7 ").concat(r,"mm) as default if no template is provided")};function eT(){let e=(0,D.C)(e=>e.auth.diagnostic),{template:t,expressionMap:n}=L(),[a,i]=(0,x.useState)(""),[s,o]=(0,x.useState)(!1),c=(0,x.useRef)(null),[u,m]=(0,x.useState)(!1),[h,f]=(0,x.useState)(null);function g(){let e={html:t.html};return n&&(e.expressionMap=n),t.category.dummyData&&(e.dummyData=t.category.dummyData),t.transformFunction&&(e.transformFunction=t.transformFunction),e}async function y(){let e=JSON.stringify(g(),null,2);try{await navigator.clipboard.writeText(e),o(!0),setTimeout(()=>o(!1),2e3),C.toast.success("Template JSON copied to clipboard")}catch(e){C.toast.error("Failed to copy to clipboard")}}async function v(){let r=JSON.stringify({expressionMap:n,transformFunction:t.transformFunction,dummyData:{...t.category.dummyData||{},diagnosticInfo:(0,E.B)(e)}},null,2),a="".concat('# System Instruction\n\nYou are a **Handlebars Data Mapping Engine**. Your goal is to map a provided `dummyData` object to a specific `expressionMap` structure.\n\n## Input\n\nA JSON object containing:\n\n1. `expressionMap`: A template structure with Handlebars keys.\n\n2. `dummyData`: A JSON object containing raw data.\n\n3. `transformFunction` (Optional): A string field to be filled if data processing is required.\n\n## Output\n\nA valid JSON object containing the filled `expressionMap` and a stringified `transformFunction` (if needed).\n\n## CRITICAL RULES\n\n### 1. Immutable Keys\n\n* You must **strictly preserve** the keys (left-side) of the `expressionMap`.\n\n* **Never** modify, delete, or "fix" the Handlebars syntax in the keys (e.g., leave `{{value}}` exactly as `{{value}}`).\n\n* Your task is only to fill the values (right-side) with the correct logical path.\n\n### 2. Path Syntax\n\n* Use dot notation for standard nesting: `user.profile.name`.\n\n* Use bracket notation for specific array indices: `users.[0].name`.\n\n### 3. Handlebars Context & Scope (CRITICAL)\n\n* **Context Switching:** The helper `{{#table arrayName}}` (or `{{#each}}`) indicates an iteration over an array.\n\n* **Relative Paths:** Inside a table/loop block in the `expressionMap`, the paths must be **relative** to the current item in the array, **NOT** the absolute root path.\n\n* *Example:* * If `dummyData` is `{ "invoices": [{ "amount": 100 }] }`.\n\n  * And the map is `{{#table invoices}}`.\n\n  * The correct path for amount is `"amount"`.\n\n  * The **WRONG** path is `"invoices.[0].amount"`.\n\n### 4. Transform Function (`customFields`)\n\n* **When to use:** Analyze the `expressionMap` keys against `dummyData`. If a required data point is **missing** (e.g., `fullName` when only `first`/`last` exist) or requires calculation (e.g., `totalSum`, `amountInWords`), you **MUST** generate a JavaScript function to create it.\n\n* **Function Structure:** * Name: `run(data)`\n\n  * Input: `data` (the root `dummyData` object).\n\n  * Output: An object containing the calculated fields.\n\n* **Precedence:** The object returned by this function is accessible via the prefix `customFields.`. If a field exists in both `dummyData` and the generated `customFields`, the `customFields` path takes precedence.\n\n* **Format:** The function must be a valid, **stringified** JavaScript function inside the JSON output. Ensure all internal quotes are properly escaped (`"`).\n* **Formatting Requirement:** The function body must be **readable and properly formatted** with line breaks and 2-space indentation. Do **not** return the function as a single line.\n\n### 5. Missing Data\n\n* If a field is missing in `dummyData` and cannot be calculated via a transform function, map the value to an empty string `""`. Do not hallucinate paths that do not exist.\n\n## Output Format Example\n\n**Input:**\n\n```\n{\n  "expressionMap": {\n    "{{fullName}}": "",\n    "{{#table orders}}": {\n       "{{id}}": "", \n       "{{cost}}": "" \n    }\n  },\n  "dummyData": {\n    "fname": "John",\n    "lname": "Doe",\n    "orders": [{ "id": 1, "price": 50 }]\n  }\n}\n```\n\n**Response:**\n\n```\n{\n  "transformFunction": "function run(data) { return { fullName: data.fname + \' \' + data.lname }; }",\n  "expressionMap": {\n    "{{fullName}}": "customFields.fullName",\n    "{{#table orders}}": {\n       "{{id}}": "id", \n       "{{cost}}": "price" \n    }\n  }\n}\n```\n\nNOTE: NEVER include the dummyData in your rensponse JSON! \n\n## Task\n\nAnalyze the user provided JSON and generate the response following the rules above.'," \n ").concat(r);try{await navigator.clipboard.writeText(a),C.toast.success("AI prompt copied to clipboard")}catch(e){C.toast.error("Failed to copy to clipboard")}}async function b(){try{await navigator.clipboard.writeText(t.html),C.toast.success("HTML copied to clipboard")}catch(e){C.toast.error("Failed to copy to clipboard")}}async function j(){if(!n){C.toast.error("Expression map is empty");return}try{await navigator.clipboard.writeText(JSON.stringify(n,null,2)),C.toast.success("Expression map copied to clipboard")}catch(e){C.toast.error("Failed to copy to clipboard")}}function w(e){if("object"!=typeof e||null===e)return{isValid:!1,errorMessage:"Template data must be a JSON object"};let t={};if("html"in e){if("string"!=typeof e.html)return{isValid:!1,errorMessage:"The 'html' field must be a string"};t.html=e.html}if("expressionMap"in e){if(null!==e.expressionMap&&"object"!=typeof e.expressionMap||Array.isArray(e.expressionMap))return{isValid:!1,errorMessage:"The 'expressionMap' field must be an object"};t.expressionMap=e.expressionMap}if("transformFunction"in e){if(null!==e.transformFunction&&"string"!=typeof e.transformFunction)return{isValid:!1,errorMessage:"The 'transformFunction' field must be a string"};t.transformFunction=e.transformFunction}if("dummyData"in e){if(null!==e.dummyData&&"object"!=typeof e.dummyData||Array.isArray(e.dummyData))return{isValid:!1,errorMessage:"The 'dummyData' field must be an object"};t.dummyData=e.dummyData}return{isValid:!0,data:t}}async function T(){if(!a.trim()){C.toast.error("Please enter template JSON to import");return}try{var e,t,n;let r=JSON.parse(a),i=w(r);if(!i.isValid){C.toast.error(null!==(e=i.errorMessage)&&void 0!==e?e:"Invalid template data");return}n=null!==(t=i.data)&&void 0!==t?t:{},f(n),m(!0)}catch(t){let e=t instanceof Error?t.message:"Please enter valid JSON";C.toast.error(e)}}async function S(e){var t,n,r,a,i,s;if(e)try{let i=await e.text(),o=JSON.parse(i),l=w(o);if(!l.isValid){C.toast.error(null!==(r=l.errorMessage)&&void 0!==r?r:"Invalid template data"),null===(n=c.current)||void 0===n||n.call(c);return}s=null!==(a=l.data)&&void 0!==a?a:{},f(s),m(!0),null===(t=c.current)||void 0===t||t.call(c)}catch(t){let e=t instanceof Error?t.message:"Please upload a valid JSON file";C.toast.error(e),null===(i=c.current)||void 0===i||i.call(c)}}return(0,r.jsxs)(l.Stack,{gap:"lg",px:"md",mt:"md",pb:"lg",children:[(0,r.jsxs)(l.Stack,{gap:"md",children:[(0,r.jsxs)(A.Box,{children:[(0,r.jsx)(d.Text,{size:"sm",fw:600,c:"gray.7",children:"Export Template"}),(0,r.jsx)(d.Text,{size:"xs",c:"dimmed",children:"Download or copy your template configuration"})]}),(0,r.jsxs)(R.Group,{gap:"xs",children:[(0,r.jsx)(eo.u,{label:"Download as JSON file",children:(0,r.jsx)(p.Button,{variant:"light",leftSection:(0,r.jsx)(ep.Z,{size:16}),onClick:function(){let e=JSON.stringify(g(),null,2),n=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download="".concat(t.category.name,".template.json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},size:"sm",children:"Download"})}),(0,r.jsx)(eo.u,{label:s?"Copied!":"Copy JSON to clipboard",children:(0,r.jsx)(p.Button,{variant:"light",leftSection:s?(0,r.jsx)(em.Z,{size:16}):(0,r.jsx)(eh.Z,{size:16}),onClick:y,size:"sm",color:s?"green":"blue",children:"Copy"})}),(0,r.jsxs)(el.v,{shadow:"md",width:200,position:"bottom-end",children:[(0,r.jsx)(el.v.Target,{children:(0,r.jsx)(ec.A,{variant:"light",size:"lg",children:(0,r.jsx)(ef.Z,{size:16})})}),(0,r.jsxs)(el.v.Dropdown,{children:[(0,r.jsx)(el.v.Item,{leftSection:(0,r.jsx)(K.Z,{size:16}),onClick:b,children:"Copy HTML"}),(0,r.jsx)(el.v.Item,{leftSection:(0,r.jsx)(eg.Z,{size:16}),onClick:j,children:"Copy Exp Map"}),(0,r.jsx)(el.v.Item,{leftSection:(0,r.jsx)(ex.Z,{size:16}),onClick:v,children:"Copy AI prompt"})]})]})]})]}),(0,r.jsx)(eu.Divider,{}),(0,r.jsxs)(l.Stack,{gap:"md",children:[(0,r.jsxs)(A.Box,{children:[(0,r.jsx)(d.Text,{size:"sm",fw:600,c:"gray.7",children:"Import Template"}),(0,r.jsx)(d.Text,{size:"xs",c:"dimmed",children:"Paste template JSON or upload a file"})]}),(0,r.jsx)(_,{value:a,onChange:e=>i(e),language:"json",style:{maxHeight:"450px",minHeight:"250px"}}),(0,r.jsxs)(R.Group,{gap:"xs",children:[(0,r.jsx)(p.Button,{variant:"filled",onClick:T,disabled:!a.trim(),size:"sm",children:"Import from Text"}),(0,r.jsx)(ed.S,{onChange:S,accept:".json,application/json",resetRef:c,children:e=>(0,r.jsx)(p.Button,{variant:"light",leftSection:(0,r.jsx)(ey.Z,{size:16}),...e,size:"sm",children:"Upload .json File"})})]})]}),(0,r.jsx)(ej,{opened:u,onClose:()=>{m(!1),f(null)},data:h,onImported:function(){var e;i(""),null===(e=c.current)||void 0===e||e.call(c),f(null)}})]})}function eS(e){let{sidebarCollapsed:t,sidebarWidth:n}=e,[a,i]=(0,x.useState)("data");return(0,r.jsx)(A.Box,{style:{minWidth:t?n:void 0},children:(0,r.jsxs)(N.m,{defaultValue:"data",value:a,onChange:e=>i(e),children:[(0,r.jsxs)(N.m.List,{children:[(0,r.jsx)(N.m.Tab,{value:"data",children:"Data"}),(0,r.jsx)(N.m.Tab,{value:"transform",children:"Transform"}),(0,r.jsx)(N.m.Tab,{value:"junction",children:"Junction"})]}),"junction"!==a&&(0,r.jsxs)(F.P,{h:"calc(100vh - 105px)",orientation:n>700?"vertical":"horizontal",children:[(0,r.jsx)(F.P.Pane,{minHeight:"30px",mt:"md",initialHeight:"50%",initialWidth:"50%",minWidth:"300px",children:(0,r.jsxs)(O.x,{h:"100%",children:["data"===a&&(0,r.jsx)(ei,{}),"transform"===a&&(0,r.jsx)(V,{})]})}),(0,r.jsx)(F.P.Resizer,{}),(0,r.jsx)(F.P.Pane,{minHeight:"20px",mt:"md",grow:!0,initialHeight:"50%",initialWidth:"50%",children:(0,r.jsx)(O.x,{h:"100%",children:(0,r.jsx)(et,{})})})]}),"junction"==a&&(0,r.jsx)(O.x,{h:"calc(100vh - 105px)",children:(0,r.jsx)(eT,{})})]})})}var eC=n(16391),ek=n(9722),eM=n(60711),ez=n(45437),eD=n(58185),eE=n(78900),eH=n(46557),eL=n(2534),eP=n(21203),eF=n(9326),eO=n(27183),eA=n(62152),eN=n.n(eA),eI=n(67486);async function eR(e){let t=document.createElement("div");await (0,eO.j3)(e,t,void 0,{inWrapper:!1,useBase64URL:!0});let n=eI.Z.sanitize(t.innerHTML,{ADD_TAGS:["style"],FORCE_BODY:!0});return{html:(0,k.jY)(n),images:{}}}async function eZ(e){let t=await eN().loadAsync(e),n="",r={},a=Object.keys(t.files).filter(e=>e.endsWith(".html"));if(0===a.length)throw Error("No HTML file found in the ZIP archive");a.length>1&&console.warn("Multiple HTML files found, using the first one:",a[0]);let i=t.file(a[0]);for(let e of(i&&(n=await i.async("string")),Object.keys(t.files).filter(e=>e.startsWith("images/")&&e.toLowerCase().endsWith(".png")&&!t.files[e].dir))){let n=t.file(e);if(n){let t=await n.async("base64"),a=e.split("/").pop()||e,i="data:image/png;base64,".concat(t);r[a]=i}}let s=n;for(let[e,t]of Object.entries(r))for(let n of[RegExp("src=[\"']images/".concat(e,"[\"']"),"g"),RegExp("src=[\"']\\./images/".concat(e,"[\"']"),"g"),RegExp("src=[\"']".concat(e,"[\"']"),"g")])s=s.replace(n,'src="'.concat(t,'"'));let o=new DOMParser().parseFromString(s,"text/html"),l=Array.from(o.querySelectorAll("style")).map(e=>e.outerHTML).join("\n"),c=o.querySelector("body"),u=(null==c?void 0:c.className)||"",d=o.querySelector("div"),p=(null==d?void 0:d.className)||"";null==d||d.remove();let m=o.querySelector("div"),h=(null==m?void 0:m.className)||"";null==m||m.remove();let f=c?c.innerHTML:s,g=d?'<header class="'.concat(p,'">').concat(d.innerHTML,"</header>"):"",x=m?'<footer class="'.concat(h,'">').concat(m.innerHTML,"</footer>"):"",y='<section class="'.concat(u,'">').concat(g).concat('<article">'.concat(f,"</article>")).concat(x,"</section>"),v=eI.Z.sanitize(l+"\n"+y,{ADD_TAGS:["style"],FORCE_BODY:!0});return{html:(0,k.jY)(v),images:r}}async function eB(e){if(!e.trim())throw Error("HTML string cannot be empty");let t=eI.Z.sanitize(e,{ADD_TAGS:["style"],FORCE_BODY:!0});return{html:(0,k.jY)(t),images:{}}}function eW(e){let{onUploadSuccess:t}=e,{template:n}=L(),[a,{open:i,close:s}]=(0,eH.q)(!1),[o,c]=(0,x.useState)("docx"),[u,m]=(0,x.useState)(""),[h,f]=(0,x.useState)(!1),[g,y]=(0,x.useState)(null),[v,b]=(0,x.useState)(!1),j=(0,x.useRef)(null),w=(0,x.useRef)(null);async function T(){try{let{pageHeight:e,pageWidth:t}=n,r=(0,k.SX)(t,e),a=ew({pageSizeName:r?r.key:"A4",pageWidth:r?r.width:210,pageHeight:r?r.height:297});await navigator.clipboard.writeText(a),b(!0),setTimeout(()=>b(!1),2e3)}catch(e){console.error("Failed to copy to clipboard:",e)}}function S(e){var n;let r=null===(n=e.target.files)||void 0===n?void 0:n[0];r&&"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===r.type?(eR(r).then(e=>{null==t||t(e.html),z()}),j.current&&(j.current.value="")):r&&y("Please select a valid .docx file")}async function C(e){var n;let r=null===(n=e.target.files)||void 0===n?void 0:n[0];if(r){if(!r.name.toLowerCase().endsWith(".zip")){y("Please select a valid .zip file");return}f(!0),y(null);try{let e=await eZ(r);null==t||t(e.html),z()}catch(e){y(e instanceof Error?e.message:"Failed to process ZIP file")}finally{f(!1),w.current&&(w.current.value="")}}}async function M(){if(!u.trim()){y("HTML content cannot be empty");return}f(!0),y(null);try{let e=await eB(u);null==t||t(e.html),z()}catch(e){y(e instanceof Error?e.message:"Failed to process HTML")}finally{f(!1)}}function z(){s(),m(""),y(null),f(!1)}return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eo.u,{label:"Upload",children:(0,r.jsx)(ec.A,{variant:"subtle",color:"gray",size:"md",onClick:i,children:(0,r.jsx)(ey.Z,{size:18})})}),(0,r.jsx)(ev.u,{opened:a,onClose:z,title:"Upload Document",size:"lg",centered:!0,overlayProps:{opacity:.5,blur:4},children:(0,r.jsxs)(l.Stack,{gap:"md",children:[(0,r.jsx)(d.Text,{size:"sm",c:"dimmed",children:"Choose a document upload method to get started."}),(0,r.jsx)(X.s,{fullWidth:!0,value:o,onChange:e=>c(e),data:[{value:"docx",label:(0,r.jsxs)(R.Group,{gap:6,wrap:"nowrap",justify:"center",children:[(0,r.jsx)(eL.Z,{size:16}),(0,r.jsx)("span",{children:"DOCX"})]})},{value:"zip",label:(0,r.jsxs)(R.Group,{gap:6,wrap:"nowrap",justify:"center",children:[(0,r.jsx)(eP.Z,{size:16}),(0,r.jsx)("span",{children:"ZIP"})]})},{value:"html",label:(0,r.jsxs)(R.Group,{gap:6,wrap:"nowrap",justify:"center",children:[(0,r.jsx)(K.Z,{size:16}),(0,r.jsx)("span",{children:"HTML"})]})}]}),(0,r.jsx)(A.Box,{mt:"md",children:function(){switch(o){case"docx":return(0,r.jsxs)(A.Box,{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"2rem",border:"2px dashed var(--mantine-color-gray-4)",borderRadius:"var(--mantine-radius-md)",transition:"border-color 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.borderColor="var(--mantine-color-gray-6)"},onMouseLeave:e=>{e.currentTarget.style.borderColor="var(--mantine-color-gray-4)"},children:[(0,r.jsx)(eL.Z,{size:48,color:"var(--mantine-color-gray-5)",style:{marginBottom:"1rem"}}),(0,r.jsx)(d.Text,{size:"sm",c:"dimmed",mb:"md",children:"Upload a .docx file to convert to HTML"}),(0,r.jsx)(p.Button,{variant:"outline",onClick:()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.click()},children:"Select DOCX File"}),(0,r.jsx)("input",{ref:j,type:"file",accept:".docx",onChange:S,style:{display:"none"}})]});case"zip":return(0,r.jsxs)(A.Box,{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"2rem",border:"2px dashed var(--mantine-color-gray-4)",borderRadius:"var(--mantine-radius-md)",transition:"border-color 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.borderColor="var(--mantine-color-gray-6)"},onMouseLeave:e=>{e.currentTarget.style.borderColor="var(--mantine-color-gray-4)"},children:[h?(0,r.jsx)(er.Loader,{size:48,color:"gray",style:{marginBottom:"1rem"}}):(0,r.jsx)(eP.Z,{size:48,color:"var(--mantine-color-gray-5)",style:{marginBottom:"1rem"}}),(0,r.jsx)(d.Text,{size:"sm",c:"dimmed",mb:"xs",children:"Upload a .zip file containing HTML and images"}),(0,r.jsx)(d.Text,{size:"xs",c:"dimmed",mb:"md",children:"ZIP should contain: *.html file + images/*.png files"}),(0,r.jsx)(p.Button,{variant:"outline",onClick:()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.click()},disabled:h,children:h?"Processing...":"Select ZIP File"}),(0,r.jsx)("input",{ref:w,type:"file",accept:".zip",onChange:C,style:{display:"none"}}),g&&(0,r.jsxs)(R.Group,{gap:"xs",mt:"sm",children:[(0,r.jsx)(eF.Z,{size:16,color:"var(--mantine-color-red-6)"}),(0,r.jsx)(d.Text,{size:"sm",c:"red",children:g})]})]});case"html":return(0,r.jsxs)(l.Stack,{gap:"md",children:[(0,r.jsx)(R.Group,{justify:"space-between",align:"center",children:(0,r.jsx)(d.Text,{size:"sm",fw:500,children:"Raw HTML"})}),(0,r.jsx)(_,{value:u,onChange:m,language:"html",placeholder:"Paste your HTML here",readOnly:h}),g&&(0,r.jsxs)(R.Group,{gap:"xs",children:[(0,r.jsx)(eF.Z,{size:16,color:"var(--mantine-color-red-6)"}),(0,r.jsx)(d.Text,{size:"sm",c:"red",children:g})]}),(0,r.jsxs)(R.Group,{justify:"space-between",children:[(0,r.jsx)(eo.u,{label:v?"Copied!":"Copy AI Prompt",children:(0,r.jsx)(p.Button,{variant:"light",size:"xs",leftSection:v?(0,r.jsx)(em.Z,{size:14}):(0,r.jsx)(eh.Z,{size:14}),onClick:T,color:v?"green":"blue",children:v?"Copied!":"Copy AI Prompt"})}),(0,r.jsx)(p.Button,{onClick:M,disabled:!u.trim()||h,leftSection:h&&(0,r.jsx)(er.Loader,{size:14}),children:h?"Processing...":"Upload HTML"})]})]})}}()}),(0,r.jsx)(R.Group,{justify:"flex-end",mt:"md",children:(0,r.jsx)(p.Button,{variant:"outline",onClick:z,children:"Cancel"})})]})})]})}var eU=n(88412);function eJ(e){let{mode:t,setMode:n,onHtmlChange:a,onToggleSidebar:i,containerRef:o,template:l}=e,c=(0,eU.useReactToPrint)({}),[u]=(0,s.wD)(),[d,p]=(0,x.useState)("A4"),m=(0,Q.y)(e=>{u({id:l.id,name:e})},500);return(0,x.useEffect)(()=>{var e;let t=(0,k.SX)(l.pageWidth,l.pageHeight);p(null!==(e=null==t?void 0:t.key)&&void 0!==e?e:"Custom")},[l.pageHeight,l.pageWidth]),(0,r.jsxs)(R.Group,{mb:"xs",gap:"xs",children:[(0,r.jsx)(ek.I,{placeholder:"Untitled template",size:"xs",defaultValue:l.name,onChange:e=>m(e.currentTarget.value),styles:{input:{backgroundColor:"white"}}}),(0,r.jsx)(X.s,{size:"xs",mx:"auto",w:200,value:t,onChange:e=>n(e),data:[{value:"preview",label:(0,r.jsxs)(R.Group,{gap:4,wrap:"nowrap",justify:"center",children:[(0,r.jsx)(eM.Z,{size:14}),"Preview"]})},{value:"edit",label:(0,r.jsxs)(R.Group,{gap:4,wrap:"nowrap",justify:"center",children:[(0,r.jsx)(ez.Z,{size:14}),"Edit"]})}]}),(0,r.jsxs)(el.v,{shadow:"md",width:200,position:"bottom-end",children:[(0,r.jsx)(el.v.Target,{children:(0,r.jsx)(ec.A,{variant:"subtle",color:"gray",size:"md",style:{fontWeight:"500",fontSize:"14px"},children:d})}),(0,r.jsx)(el.v.Dropdown,{children:k.M7.map(e=>(0,r.jsx)(el.v.Item,{onClick:()=>(function(e){let t=(0,k.ar)(e);p(e),u({id:l.id,pageWidth:t.pageWidth,pageHeight:t.pageHeight})})(e.key),children:(0,k.l1)(e)},e.key))})]}),(0,r.jsx)(eW,{onUploadSuccess:a}),(0,r.jsx)(eo.u,{label:"Print",children:(0,r.jsx)(ec.A,{variant:"subtle",color:"gray",size:"md",onClick:function(){c(void 0,()=>o.current)},children:(0,r.jsx)(eD.Z,{size:18})})}),(0,r.jsx)(eo.u,{label:"Hide Sidebar",children:(0,r.jsx)(ec.A,{variant:"subtle",color:"gray",size:"md",onClick:i,children:(0,r.jsx)(eE.Z,{size:18})})})]})}var eq=n(47137),eG=n(2929),e_=n(72226),eV=n(36083);function eY(e){let{onToggleSidebar:t}=e;(0,eV.wj)();let{template:a,customFields:i,expressionMap:o}=L(),[l,c]=(0,x.useState)("preview"),[u,d]=(0,x.useState)(a.html);(0,x.useEffect)(()=>{d(a.html)},[a.html]);let p=(0,x.useRef)(null),[m]=(0,s.wD)(),h=(0,x.useCallback)(async e=>{d(e);try{setTimeout(()=>t(),10)}catch(e){d(u),C.toast.error("Failed to save template. Changes have been reverted."),console.error("Template update error:",e)}async function t(){let t=await r();await m({id:a.id,html:e,previewImage:t}).unwrap()}async function r(){var e;let t=null==p?void 0:null===(e=p.current)||void 0===e?void 0:e.querySelector("section");if(!t)return;let{snapdom:r}=await n.e(9993).then(n.bind(n,99993));"rgba(0, 0, 0, 0)"==getComputedStyle(t).backgroundColor&&(t.style.backgroundColor="#fff");let a=t.offsetWidth/t.offsetHeight;return(await r.toPng(t,{width:200,height:200/a,type:"png"})).src}},[a.id,u,m]);return(0,r.jsxs)(eC.k,{direction:"column",px:"md",py:20,mx:"auto",w:"max-content",children:[(0,r.jsx)(eJ,{mode:l,setMode:c,onHtmlChange:h,containerRef:p,onToggleSidebar:t,template:a}),(0,r.jsx)("div",{style:{marginInline:"auto",width:"max-content"},children:(0,r.jsx)(function(){let e=(0,D.C)(e=>e.auth.diagnostic),t=(0,k.b3)(a.category.dummyData,i),n=(0,e_.s)({...t,diagnosticInfo:e},null!=o?o:{});return u?"preview"==l?(0,r.jsx)(eG.M,{html:u,containerRef:p,data:n,pageHeight:a.pageHeight,pageWidth:a.pageWidth}):(0,r.jsx)(eq.i,{html:u,containerRef:p,contentEditable:!0,setHtml:h,pageHeight:a.pageHeight,pageWidth:a.pageWidth}):(0,r.jsx)(eX,{})},{})})]})}function eX(){return(0,r.jsx)("div",{style:{width:"210mm",height:"297mm",border:"1px solid #ccc",display:"flex",justifyContent:"center",paddingTop:"12rem"},children:(0,r.jsxs)(l.Stack,{align:"center",gap:"xs",children:[(0,r.jsx)(ey.Z,{size:48,stroke:1.5,color:"var(--mantine-color-dimmed)"}),(0,r.jsx)(d.Text,{c:"dimmed",children:"Upload a template"})]})})}function e$(){let[e,t]=(0,x.useState)(!1),[n,a]=(0,x.useState)(!1),[i,s]=(0,x.useState)(400);return(0,r.jsxs)(F.P,{children:[(0,r.jsx)(F.P.Pane,{grow:!0,minWidth:"100px",children:(0,r.jsx)(O.x,{h:"calc(100dvh - 64px)",children:(0,r.jsx)(eY,{onToggleSidebar:()=>t(e=>!e)})})}),(0,r.jsx)(F.P.Resizer,{onDoubleClick:()=>t(e=>!e),onResizeStart:()=>a(!0),onResizeEnd:e=>{a(!1),s(e.afterPane.width)}}),(0,r.jsx)(F.P.Pane,{initialWidth:i,w:e?0:i,style:{transition:n?"none":"width ".concat(i/2,"ms ease-in-out")},minWidth:200,children:(0,r.jsx)(eS,{sidebarWidth:i,sidebarCollapsed:e})})]})}function eK(){let e=(0,i.useSearchParams)().get("template-id"),{data:t,isLoading:n}=(0,s.A9)(null!=e?e:"",{skip:!e}),o=null==t?void 0:t.data;return n?(0,r.jsx)(a.f,{visible:n}):o?(0,r.jsx)(P,{template:o,children:(0,r.jsx)(e$,{})}):(0,r.jsx)(g,{})}},54133:function(e,t,n){"use strict";function r(e){return(function(e){let t=new DOMParser;return e.replace(/{{2,}([\s\S]*?)}{2,}/gm,e=>t.parseFromString(e,"text/html").body.textContent||"")})(e).replace(/[“”]/g,'"')}function a(e,t){return t?e?"object"==typeof e&&"object"==typeof t?{customFields:t,...e}:{}:t||{}:e||{}}n.d(t,{M7:function(){return i},SX:function(){return o},ar:function(){return l},b3:function(){return a},jY:function(){return r},l1:function(){return c},o4:function(){return u}});let i=[{key:"A4",width:210,height:297},{key:"A5",width:148,height:210}],s=e=>{if(null==e)return null;if("number"==typeof e)return e;let t=e.trim();if(!t)return null;let n=parseFloat(t.replace("mm",""));return Number.isNaN(n)?null:n};function o(e,t){var n;let r=s(e),a=s(t);return r&&a&&null!==(n=i.find(e=>e.width===r&&e.height===a))&&void 0!==n?n:null}function l(e){let t=i.find(t=>t.key===e);return t?{pageWidth:t.width,pageHeight:t.height}:{pageWidth:210,pageHeight:297}}function c(e){return"".concat(e.key," (").concat(e.width," x ").concat(e.height,"mm)")}function u(e){let t=[],n=null,r=null,a=!1,i=[],s=[],o=e=>e.map((e,t)=>"string"==typeof e&&e.startsWith("[")?".".concat(e):0===t?e:".".concat(e)).join(""),l=(e,t)=>{t&&(e.setAttribute("data-path",t),e.style.cursor="pointer")},c=e=>{if(e.nodeType===Node.ELEMENT_NODE){var u,d;let p=null!==(d=null===(u=e.textContent)||void 0===u?void 0:u.trim())&&void 0!==d?d:"";if(e.classList.contains("hljs-punctuation")){if("{"===p){if(null!==n)t.push(n),r&&(l(r,o(t)),r=null),n=null;else if(a){let e=i[i.length-1];t.push("[".concat(e,"]")),i[i.length-1]++}s.push("object")}else if("}"===p)"object"===s[s.length-1]&&(s.pop(),t.length>0&&t.pop());else if("["===p){if(null!==n)t.push(n),r&&(l(r,o(t)),r=null),n=null;else if(a){let e=i[i.length-1];t.push("[".concat(e,"]")),i[i.length-1]++}s.push("array"),i.push(0),a=!0}else"]"===p&&"array"===s[s.length-1]&&(s.pop(),i.pop(),a=i.length>0,t.length>0&&t.pop())}else if(e.classList.contains("hljs-attr"))n=p.replace(/^"|"$/g,""),r=e;else if(e.classList.contains("hljs-string")||e.classList.contains("hljs-number")||e.classList.contains("hljs-literal")){let s=[...t];if(null!==n)s.push(n),n=null;else if(a){let e=i[i.length-1];s.push("[".concat(e,"]")),i[i.length-1]++}let c=o(s);l(e,c),r&&(l(r,c),r=null)}for(let t of Array.from(e.childNodes))c(t)}};c(e)}},94441:function(e,t,n){"use strict";function r(e){if(null==e)return null;let{name:t,smsPhone:n,activeLogo:r,phone1:a,phone2:i,address:s,division:o,city:l,middleDate:c,firstDeliveryDate:u,secondDeliveryDate:d,roomCheckInDate:p,serviceCharge:m,indoorServiceCharge:h,serviceChargePaymentPeriod:f,serviceChargePaymentDate:g}=e;return{name:t,smsPhone:n,activeLogo:r,phone1:a,phone2:i,address:s,division:o,city:l,middleDate:c,firstDeliveryDate:u,secondDeliveryDate:d,roomCheckInDate:p,serviceCharge:m,indoorServiceCharge:h,serviceChargePaymentPeriod:f,serviceChargePaymentDate:g}}n.d(t,{B:function(){return r}})},72940:function(e,t,n){"use strict";n.d(t,{FD:function(){return a},Hn:function(){return r},y4:function(){return i}});let r={headers:{"Content-Type":"application/json"}},a={withCredentials:!0},i={headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}},62717:function(e,t,n){"use strict";n.d(t,{U:function(){return a}});var r=n(4505);function a(){let e=(0,r.useRef)(null),[t,a]=(0,r.useState)(!1),[i,s]=(0,r.useState)(null),o=(0,r.useRef)(null);return{executeFunction:(0,r.useCallback)((t,r)=>new Promise((i,l)=>{a(!0),s(null),e.current||(e.current=new Worker(n.tu(new URL(n.p+n.u(832),n.b))));let c=e.current,u=e=>{if(o.current&&(clearTimeout(o.current),o.current=null),a(!1),c.removeEventListener("message",u),c.removeEventListener("error",d),e.data.success&&e.data.result)i(e.data.result);else{let t=e.data.error||"Execution failed";s(t),l(t)}},d=e=>{o.current&&(clearTimeout(o.current),o.current=null),a(!1),c.removeEventListener("message",u),c.removeEventListener("error",d);let t=e.message||"Worker error";s(t),l(t)};c.addEventListener("message",u),c.addEventListener("error",d),o.current=setTimeout(()=>{c.terminate(),e.current=null,o.current=null,a(!1);let t="Execution timed out (10s)";s(t),l(t)},1e4),c.postMessage({code:t,data:r})}),[]),isExecuting:t,lastError:i,terminate:(0,r.useCallback)(()=>{o.current&&(clearTimeout(o.current),o.current=null),e.current&&(e.current.terminate(),e.current=null),a(!1)},[])}}},70103:function(e,t,n){"use strict";n.d(t,{$Q:function(){return d},A9:function(){return s},JF:function(){return a},JT:function(){return u},ZM:function(){return r},pi:function(){return p},rg:function(){return c},wD:function(){return o}});let{useCreateAdminTemplateMutation:r,useGetAdminTemplatesQuery:a,useGetAvailableTemplatesQuery:i,useGetAdminTemplateQuery:s,useUpdateAdminTemplateMutation:o,useAssignTemplateMutation:l,useUnassignTemplateMutation:c,useSetDefaultTemplateMutation:u,useGetTemplatesByCategoryQuery:d,useUpdateCategoryMutation:p}=n(78101).g.injectEndpoints({overrideExisting:!0,endpoints:e=>({createAdminTemplate:e.mutation({query:e=>({url:"/template/admin",method:"POST",body:e}),invalidatesTags:["template"]}),getAdminTemplates:e.query({query:e=>({url:"/template/admin",method:"GET",params:e||void 0}),providesTags:["template"],transformResponse:e=>({data:e.data})}),getAvailableTemplates:e.query({query:e=>({url:"/template/admin/available",method:"GET",params:e||void 0}),providesTags:["template"],transformResponse:e=>({data:e.data})}),getAdminTemplate:e.query({query:e=>({url:"/template/admin/".concat(e),method:"GET"}),providesTags:(e,t,n)=>[{type:"template",id:n}],transformResponse:e=>({data:e.data})}),updateAdminTemplate:e.mutation({query:e=>{let{id:t,...n}=e;return{url:"/template/admin/".concat(t),method:"PATCH",body:n}},invalidatesTags:(e,t,n)=>{let{id:r}=n;return["template",{type:"template",id:r}]}}),assignTemplate:e.mutation({query:e=>({url:"/template/admin/assign",method:"POST",body:e}),invalidatesTags:["template"]}),unassignTemplate:e.mutation({query:e=>({url:"/template/admin/".concat(e),method:"DELETE"}),invalidatesTags:(e,t,n)=>["template",{type:"template",id:n}]}),setDefaultTemplate:e.mutation({query:e=>({url:"/template/admin/".concat(e,"/default"),method:"PATCH"}),invalidatesTags:["template"]}),getTemplatesByCategory:e.query({query:e=>({url:"/template/category/".concat(e),method:"GET"}),providesTags:(e,t,n)=>[{type:"template",id:"category-".concat(n)}],transformResponse:e=>({data:e.data})}),updateCategory:e.mutation({query:e=>{let{ctgId:t,...n}=e;return{url:"/template/category/".concat(t),method:"PATCH",body:n}},invalidatesTags:(e,t,n)=>{let{ctgId:r}=n;return["template",{type:"template",id:"category-".concat(r)}]}})})})},78101:function(e,t,n){"use strict";n.d(t,{g:function(){return o}});var r=n(49854),a=n(68240),i=n(94183),s=n(28317);let o=(0,a.LC)({baseQuery:(0,i.ni)({baseUrl:"http://sasthotech.local:5000/api/v1",credentials:"include",fetchFn:(e,t)=>fetch(e,t).then(async n=>{let a="string"==typeof e?e:e.url;return a.includes("?")||(null==t?void 0:t.body)||"string"!=typeof e&&e.body||await (0,s.t8)(a,await n.clone().json().catch(()=>null),(0,r.x)()),n}).catch(async n=>{if(n instanceof TypeError){let n="string"==typeof e?e:e.url;if(!n.includes("?")&&!(null==t?void 0:t.body)&&!("string"!=typeof e&&e.body)){let e=await (0,s.U2)(n,(0,r.x)());if(e)return new Response(e,{headers:new Headers({"Content-Type":"application/json"})})}}throw n})}),endpoints:()=>({}),tagTypes:["BillTest","doctor","hospitalBill","inventory","appointment","patient","sms","sms-dashboard","sms-messages","sms-analytics","sms-status","notice","template","versionAdmin-services","versionAdmin-versions","versionAdmin-hospitals","versionAdmin-logs","versionAdmin-sessions","versionAdmin-devices","versionAdmin-notifications","versionAdmin-notification-stats","PCMeetup","MarketerTarget","Marketer"]})},25499:function(e,t,n){"use strict";n.d(t,{C:function(){return i},T:function(){return a}});var r=n(53502);let a=()=>(0,r.I0)(),i=r.v9},49854:function(e,t,n){"use strict";let r;n.d(t,{d:function(){return c},x:function(){return l}});var a=n(72940),i=n(6780),s=n(67732),o=n(28317);function l(){return r||(r=(0,o.MT)("cached-responses-store","cached-responses")),r}async function c(e,t){try{let n=await i.default.get(e,{baseURL:"http://sasthotech.local:5000/api/v1",params:t,...a.FD});return await (0,o.t8)(e,n.data,l()),n.data}catch(t){if(t instanceof s.d7&&[s.d7.ERR_NETWORK,s.d7.ETIMEDOUT].includes(t.code)){let t=await (0,o.U2)(e,l());if(t)return t}throw t instanceof s.d7&&t.response&&401===t.response.status||console.error(t),t}}}},function(e){e.O(0,[1601,8297,3069,6945,3852,1656,9722,4670,9258,9533,966,12,7538,6029,154,4927,7125,729,1291,4548,5865,7956,2748,9175,7402,1744],function(){return e(e.s=40104)}),_N_E=e.O()}]);
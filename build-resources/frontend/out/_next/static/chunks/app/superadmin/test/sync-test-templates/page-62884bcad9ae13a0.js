(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9003],{49484:function(e,t,a){Promise.resolve().then(a.bind(a,59662))},59662:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return X}});var s=a(68328),r=a(3291),i=a(69593),n=a(72940),l=a(6780),o=a(67732);let d=async(e,t)=>{try{let a={};"null"!==t&&(a={sourceDiagnosticId:t});let s=await l.default.get("".concat("http://sasthotech.local:5000/api/v1","/test/previously-synced-template/").concat(e),{...n.FD,...n.Hn,params:a});return{success:!0,data:s.data.data}}catch(e){if(e instanceof o.d7){var a;return{success:!1,data:null===(a=e.response)||void 0===a?void 0:a.data.message}}return{success:!1,data:"An error occurred"}}},c=async(e,t)=>{try{let a=await l.default.post("".concat("http://sasthotech.local:5000/api/v1","/test/sync-templates/").concat(e),JSON.stringify(t),{...n.FD,...n.Hn});return{success:!0,data:a.data.data}}catch(e){if(e instanceof o.d7){var a;return{success:!1,data:null===(a=e.response)||void 0===a?void 0:a.data.message}}return{success:!1,data:"An error occurred"}}};var u=a(16201),m=a(25499),p=a(25626),h=a(48709),g=a(43495),y=a(22041),f=a(22614),v=a(32451),C=a(85033),x=a(13822),T=a(89043),S=a(41224),j=a(68242),A=a(48604),b=a(87967),w=a(72375),k=a(31204),P=a(46373),F=a(22115),I=a(59406),D=a(9654),Z=a(9326),E=a(4505),N=a(90660),z=a.n(N);let M=(0,E.memo)(e=>{let{tests:t}=e;return 0===t.length?null:(0,s.jsx)(h.U,{variant:"separated",children:(0,s.jsxs)(h.U.Item,{value:"previously-synced",children:[(0,s.jsxs)(h.U.Control,{children:["Previously Synced Tests (",t.length,")"]}),(0,s.jsx)(h.U.Panel,{children:(0,s.jsx)(g.a,{children:t.map(e=>(0,s.jsxs)(g.a.Item,{children:[(0,s.jsx)(y.Text,{fw:500,children:e.name}),(0,s.jsxs)(y.Text,{size:"sm",c:"dimmed",children:["Templates: ",e.testTemplates.length," (includes super admin templates)"]})]},e.id))})})]})})});M.displayName="PreviouslySyncedTests";let H=(0,E.memo)(e=>{let{options:t,value:a,onChange:r,disabled:i,previouslySyncedTestIds:n}=e,l=(0,E.useCallback)(e=>{let{option:t}=e,a=n.has(t.label);return(0,s.jsxs)(f.Group,{justify:"space-between",children:[(0,s.jsxs)(v.Box,{children:[(0,s.jsx)(y.Text,{size:"sm",children:t.label}),a&&(0,s.jsx)(y.Text,{size:"xs",c:"dimmed",children:"Has existing superadmin templates"})]}),a?(0,s.jsx)(I.Z,{size:"1rem",color:"blue"}):(0,s.jsx)(D.Z,{size:"1rem",color:"gray"})]})},[n]);return(0,s.jsx)(C.N,{label:"Select tests to sync",placeholder:"Choose tests",data:t,searchable:!0,renderOption:l,value:a,onChange:r,disabled:i})});H.displayName="TestSelector";let R=(e,t)=>{let[a,r]=(0,E.useState)(!1),[i,n]=(0,E.useState)(null);return{loading:a,syncResult:i,syncTemplates:async(a,i)=>{r(!0);try{let r=await c(e,{...a,testIds:i,sourceDiagnosticId:"null"===t?void 0:t});if(!r.success)throw Error("Sync failed");return n(r.data),F.N9.show({title:"Success",message:"Templates synchronized successfully",color:"green",icon:(0,s.jsx)(I.Z,{size:16})}),!0}catch(e){throw F.N9.show({title:"Error",message:"Failed to sync templates",color:"red",icon:(0,s.jsx)(Z.Z,{size:16})}),e}finally{r(!1)}}}};function X(){let e=(0,m.T)(),t=(0,m.C)(e=>e.tests),a=(0,m.C)(e=>e.diagnostic.diagnostics),[n,l]=(0,E.useState)([]),[o,c]=(0,E.useState)(null),[h,C]=(0,E.useState)(null),[I,D]=(0,E.useState)([]),[N,X]=(0,E.useState)(new Set),[_,q]=(0,E.useState)(!1),[B,U]=(0,E.useState)({addSample:!1,includeSubCategory:!1,syncAllTest:!0,removePreviousSuperadminTemplates:!0}),[G,O]=(0,E.useState)(0),{loading:L,syncResult:W,syncTemplates:Y}=R(null!=o?o:"",null!=h?h:"");(0,E.useEffect)(()=>{(async()=>{let[t,a]=await Promise.all([(0,r.X)(h),(0,i.h)()]);if(t.success&&e((0,p.gu)(t.data)),a.success){var s;e((0,u.Yr)(null===(s=a.data)||void 0===s?void 0:s.items))}})().catch(e=>{z().fire("Error","Failed to load initial data","error")})},[h]),(0,E.useEffect)(()=>{o&&h&&(async()=>{q(!0);try{let e=await d(o,h);if(!e.success)throw Error("Failed to fetch synced tests");D(e.data)}catch(e){F.N9.show({title:"Error",message:"Failed to load previously synced tests",color:"red",icon:(0,s.jsx)(Z.Z,{size:16})})}finally{q(!1)}})()},[o,h]),(0,E.useEffect)(()=>{X(new Set(I.filter(e=>{var t;return(null===(t=e.testTemplates)||void 0===t?void 0:t.length)>0}).map(e=>e.name)))},[I]);let J=(0,E.useMemo)(()=>t.superAdminCategories.flatMap(e=>e.tests.map(e=>({value:e.id,label:e.name,hasPreviousTemplates:N.has(e.name)}))),[t.superAdminCategories,N]),V=(0,E.useMemo)(()=>a.map(e=>({value:e.id,label:e.name})),[a]),K=(0,E.useCallback)(e=>t=>{U(a=>{var s;return{...a,[e]:null==t?void 0:null===(s=t.currentTarget)||void 0===s?void 0:s.checked}})},[]);return(0,s.jsxs)(v.Box,{pos:"relative",children:[(0,s.jsx)(x.f,{visible:L||_}),(0,s.jsx)(T.X,{p:"md",radius:"md",withBorder:!0,children:(0,s.jsxs)(S.Stack,{gap:"md",children:[(0,s.jsx)(j.Title,{order:2,children:"Sync Test Templates"}),(0,s.jsx)(A.Z,{withBorder:!0,children:(0,s.jsxs)(S.Stack,{children:[(0,s.jsx)(b.P,{label:"Source diagnostic",placeholder:"Choose Diagnostic / Superadmin",data:[{label:"Superadmin",value:"null"},...V],searchable:!0,value:h,onChange:C,clearable:!0}),(0,s.jsx)(b.P,{label:"Select diagnostic",placeholder:"Choose Diagnostic",data:V.map(e=>e.value===h?{...e,disabled:!0}:e),searchable:!0,value:o,onChange:c,disabled:!h,clearable:!0}),(0,s.jsx)(M,{tests:I}),(0,s.jsx)(w.X,{label:"Sync all tests",checked:B.syncAllTest,onChange:K("syncAllTest")}),!B.syncAllTest&&(0,s.jsx)(H,{options:J,value:n,onChange:l,disabled:B.syncAllTest,previouslySyncedTestIds:N}),(0,s.jsxs)(S.Stack,{gap:"xs",children:[(0,s.jsx)(w.X,{label:"Include sample data",checked:B.addSample,onChange:K("addSample")}),(0,s.jsx)(w.X,{label:"Include subcategories",checked:B.includeSubCategory,onChange:K("includeSubCategory")}),I.length>0&&(0,s.jsx)(w.X,{label:"Remove previous ".concat(h?"Source Diagnostic":"super admin"," templates if they exist"),checked:B.removePreviousSuperadminTemplates,onChange:K("removePreviousSuperadminTemplates")})]})]})}),(0,s.jsx)(f.Group,{children:(0,s.jsx)(k.Button,{onClick:async()=>{!0===await Y(B,n)&&O(Math.random())},loading:L,disabled:!o,children:"Sync Templates"})}),W&&(0,s.jsxs)(P.b,{title:"Sync Results",color:"green",variant:"filled",children:[(0,s.jsxs)(y.Text,{children:["Successfully synchronized ",null==W?void 0:W.matchCount," tests"]}),(0,s.jsx)(g.a,{children:null==W?void 0:W.results.map((e,t)=>(0,s.jsxs)(g.a.Item,{children:[e.testName.name,": Added ",e.addedTemplates," templates, Removed"," ",e.deletedTemp.count," templates"]},t))})]})]})})]},G)}},72940:function(e,t,a){"use strict";a.d(t,{FD:function(){return r},Hn:function(){return s},y4:function(){return i}});let s={headers:{"Content-Type":"application/json"}},r={withCredentials:!0},i={headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}},3291:function(e,t,a){"use strict";a.d(t,{X:function(){return n}});var s=a(72940),r=a(6780),i=a(67732);let n=async e=>{try{let t=await r.default.get("".concat("http://sasthotech.local:5000/api/v1","/testCategory"),{...s.FD,params:e?{diagnosticId:e}:{}});return{success:!0,data:t.data.data}}catch(e){if(e instanceof i.d7){var t;return{success:!1,data:null===(t=e.response)||void 0===t?void 0:t.data.message}}return{success:!1,data:"An error occurred"}}}},69593:function(e,t,a){"use strict";a.d(t,{h:function(){return n}});var s=a(72940),r=a(6780),i=a(67732);let n=async()=>{try{let e=await r.default.get("".concat("http://sasthotech.local:5000/api/v1","/diagnostic"),s.FD);return{success:!0,data:e.data.data}}catch(t){if(t instanceof i.d7){var e;return{success:!1,data:null===(e=t.response)||void 0===e?void 0:e.data.message}}return{success:!1,data:"An error occurred"}}}},16201:function(e,t,a){"use strict";a.d(t,{C4:function(){return i},GU:function(){return o},WH:function(){return c},Yr:function(){return n},ZR:function(){return d},iw:function(){return u},kd:function(){return l},sI:function(){return r},tG:function(){return m}});let s=(0,a(79258).createSlice)({name:"diagnostic",initialState:{receptionist:[],diagnostics:[],pathologist:[],marketer:[]},reducers:{setReceptionist:(e,t)=>{Array.isArray(t.payload)?e.receptionist=t.payload:e.receptionist=[...e.receptionist,t.payload]},removeReceptionist:(e,t)=>{e.receptionist=e.receptionist.filter(e=>e.id!==t.payload)},setPathologist:(e,t)=>{Array.isArray(t.payload)?e.pathologist=t.payload:e.pathologist=[...e.pathologist,t.payload]},setMarketer:(e,t)=>{Array.isArray(t.payload)?e.marketer=t.payload:e.marketer=[...e.marketer,t.payload]},removeMarketer:(e,t)=>{e.marketer=e.marketer.filter(e=>e.id!==t.payload)},removePathologist:(e,t)=>{e.pathologist=e.pathologist.filter(e=>e.id!==t.payload)},setPathologistCategory:(e,t)=>{let{payload:{userId:a,categoryIds:s}}=t,r=e.pathologist.find(e=>e.id!==a);r&&(r.userTestCategory=s)},setDiagnosticList:(e,t)=>{Array.isArray(t.payload)?e.diagnostics=t.payload:e.diagnostics=[...e.diagnostics,t.payload]},removeFromDiagnosticLists:(e,t)=>{e.diagnostics=e.diagnostics.filter(e=>e.id!==t.payload)}}}),{setReceptionist:r,removeReceptionist:i,setDiagnosticList:n,removeFromDiagnosticLists:l,setPathologist:o,setMarketer:d,removeMarketer:c,removePathologist:u,setPathologistCategory:m}=s.actions;t.ZP=s.reducer},25499:function(e,t,a){"use strict";a.d(t,{C:function(){return i},T:function(){return r}});var s=a(53502);let r=()=>(0,s.I0)(),i=s.v9},25626:function(e,t,a){"use strict";let s;a.d(t,{H3:function(){return c},Z2:function(){return m},Zw:function(){return v},_W:function(){return d},gu:function(){return h},lF:function(){return g},mC:function(){return f},s9:function(){return p},se:function(){return y}});var r=a(79258),i=a(69192),n=a(28317);function l(){return s||(s=(0,n.MT)("test-frequency-store","test-frequency")),s}let o=new Intl.Collator,d=(0,r.createAsyncThunk)("tests/setAdminTests",async e=>{let t=await (0,n.qh)().catch(()=>[]);return t.length?(await (0,n.vw)(t,l()),(0,n.ZH)()):t=await (0,n.qh)(l()).catch(()=>[]),[e,t]}),c=(0,r.createAsyncThunk)("tests/increaseTestFrequencies",async e=>(await Promise.all(e.map(e=>(0,n.Vx)(e.id,e=>(e||0)+1),l())).catch(),await (0,n.qh)(l()).catch(()=>[]))),u=(0,r.createSlice)({name:"tests",initialState:{adminCategories:[],adminTests:null,superAdminCategories:[]},reducers:{setAdminCategories:(e,t)=>{e.adminCategories=t.payload},removeAdminCategories:(e,t)=>{var a;e.adminCategories=null===(a=e.adminCategories)||void 0===a?void 0:a.filter(e=>e.id!==t.payload.id)},updateTestsInAdminCategories:(e,t)=>{var a;let s=t.payload;console.log(s),e.adminCategories=null===(a=e.adminCategories)||void 0===a?void 0:a.map(e=>({...e,tests:e.tests.map(e=>s.find(t=>t.id===e.id)||e)}))},removeTestFromAdminCategories:(e,t)=>{var a;e.adminCategories=null===(a=e.adminCategories)||void 0===a?void 0:a.map(e=>({...e,tests:e.tests.filter(e=>e.id!==t.payload.id)}))},removeTestFromSuperAdminCategories:(e,t)=>{var a;e.superAdminCategories=null===(a=e.superAdminCategories)||void 0===a?void 0:a.map(e=>({...e,tests:e.tests.filter(e=>e.id!==t.payload.id)}))},setSuperAdminCategories:(e,t)=>{e.superAdminCategories=t.payload},removeSuperAdminCategories:(e,t)=>{var a;e.superAdminCategories=null===(a=e.superAdminCategories)||void 0===a?void 0:a.filter(e=>e.id!==t.payload.id)}},extraReducers:e=>{e.addCase(d.fulfilled,(e,t)=>{let a=t.payload[0],s=new Map(t.payload[1]);if(Array.isArray(a))e.adminTests=[...a];else{if(e.adminTests){let t=e.adminTests.findIndex(e=>e.id===a.id);t>=0?e.adminTests[t]=a:e.adminTests.push(a)}else e.adminTests=[a];if(e.adminCategories){for(let t=0;t<e.adminCategories.length;t++)for(let s=0;s<e.adminCategories[t].tests.length;s++)if(a.id===e.adminCategories[t].tests[s].id){e.adminCategories[t].tests[s]=a;break}}}e.adminTests.sort((e,t)=>{var a,r;return(null!==(a=s.get(t.id))&&void 0!==a?a:0)-(null!==(r=s.get(e.id))&&void 0!==r?r:0)||o.compare(e.name,t.name)})}),e.addCase(c.fulfilled,(e,t)=>{var a;let s=new Map(t.payload);null===(a=e.adminTests)||void 0===a||a.sort((e,t)=>{var a,r;return(null!==(a=s.get(t.id))&&void 0!==a?a:0)-(null!==(r=s.get(e.id))&&void 0!==r?r:0)||o.compare(e.name,t.name)})})}});(0,i.createSelector)([e=>e.tests.adminCategories],e=>new Map(null==e?void 0:e.map(e=>[+e.id,e])));let{setAdminCategories:m,removeAdminCategories:p,setSuperAdminCategories:h,removeSuperAdminCategories:g,removeTestFromAdminCategories:y,removeTestFromSuperAdminCategories:f,updateTestsInAdminCategories:v}=u.actions;t.ZP=u.reducer}},function(e){e.O(0,[1601,2975,3069,6945,3852,1656,9722,4670,9258,9533,1166,7967,4927,4347,8709,5533,9175,7402,1744],function(){return e(e.s=49484)}),_N_E=e.O()}]);
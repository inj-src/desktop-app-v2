(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4485],{79873:function(e,s,r){Promise.resolve().then(r.bind(r,24273))},24273:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return D}});var i=r(68328),n=r(22614),t=r(14587),o=r(46373),a=r(34473),l=r(41224),d=r(68242),c=r(31204),u=r(87967),v=r(72375),p=r(48604),m=r(22041),x=r(11114),h=r(77303),g=r(34022),j=r(9326),b=r(9654),y=r(5966),f=r(67030),S=r(4505),I=r(12450),T=r(22975),V=r(55911),k=r(29259),w=r(57956),P=r(67686),E=r(89043),N=r(3741),q=r(47720),A=r(12697),C=r(22115),G=r(81014),z=r(35294);function R(e){let{opened:s,onClose:r}=e,[t,{isLoading:o}]=(0,y.Rs)(),{data:a}=(0,f.NG)(),p=(null==a?void 0:a.data)||[],m=(0,q.c)({initialValues:{serviceId:"",serviceName:"",version:"",dockerImage:"",ecrRepository:"",imageSizeMb:0,port:0,isExposed:!0,allowed:!0,isMandatory:!1,isStable:!0,releaseNotes:"",configType:"service-defaults",environmentVariables:[],volumes:[]},validate:{serviceId:e=>e?null:"Service is required",version:e=>e?null:"Version is required",dockerImage:e=>e?null:"Docker image is required"}}),x=e=>{let s=p.find(s=>s.id===e);s&&(m.setFieldValue("serviceId",e),m.setFieldValue("serviceName",s.displayName||s.name))},g=async e=>{try{let s={serviceId:e.serviceId,serviceName:e.serviceName,version:e.version,dockerImage:e.dockerImage,ecrRepository:e.ecrRepository||void 0,imageSizeMb:e.imageSizeMb||void 0,port:e.port||void 0,isExposed:e.isExposed,allowed:e.allowed,isMandatory:e.isMandatory,isStable:e.isStable,releaseNotes:e.releaseNotes||void 0};"service-defaults"===e.configType?(s.useServiceEnv=!0,s.useServiceVolumes=!0):(s.useServiceEnv=!1,s.useServiceVolumes=!1,s.environmentVariables=e.environmentVariables,s.volumes=e.volumes),await t(s).unwrap(),C.N9.show({title:"Success",message:"Version released successfully",color:"green"}),m.reset(),r()}catch(e){var s;C.N9.show({title:"Error",message:(null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to release version",color:"red"})}},j=()=>{m.reset(),r()};return(0,i.jsx)(T.u,{opened:s,onClose:j,title:"Release New Version",size:"lg",children:(0,i.jsx)("form",{onSubmit:m.onSubmit(g),children:(0,i.jsxs)(l.Stack,{gap:"md",children:[(0,i.jsx)(u.P,{label:"Service",placeholder:"Select Service",data:p.map(e=>({value:e.id,label:e.displayName||e.name})),required:!0,searchable:!0,...m.getInputProps("serviceId"),onChange:e=>e&&x(e)}),(0,i.jsx)(V.TextInput,{label:"Version",placeholder:"v1.0.4",required:!0,...m.getInputProps("version")}),(0,i.jsx)(V.TextInput,{label:"Docker Image",placeholder:"sasthotech/hms-backend:v1.0.4",required:!0,...m.getInputProps("dockerImage")}),(0,i.jsx)(V.TextInput,{label:"ECR Repository",placeholder:"sasthotech/hms-backend",...m.getInputProps("ecrRepository")}),(0,i.jsxs)(n.Group,{grow:!0,children:[(0,i.jsx)(k.Y,{label:"Port",placeholder:"5000",min:0,max:65535,...m.getInputProps("port")}),(0,i.jsx)(k.Y,{label:"Image Size (MB)",placeholder:"245.8",min:0,step:.1,decimalScale:1,...m.getInputProps("imageSizeMb")})]}),(0,i.jsxs)(n.Group,{children:[(0,i.jsx)(v.X,{label:"Exposed",...m.getInputProps("isExposed",{type:"checkbox"})}),(0,i.jsx)(v.X,{label:"Mandatory",...m.getInputProps("isMandatory",{type:"checkbox"})}),(0,i.jsx)(v.X,{label:"Stable",...m.getInputProps("isStable",{type:"checkbox"})}),(0,i.jsx)(v.X,{label:"Allowed",...m.getInputProps("allowed",{type:"checkbox"})})]}),(0,i.jsx)(w.g,{label:"Release Notes",placeholder:"- Fixed authentication bug - Improved performance - Updated dependencies",minRows:3,...m.getInputProps("releaseNotes")}),(0,i.jsx)(h.Divider,{}),(0,i.jsx)(P.Y.Group,{label:"Configuration",...m.getInputProps("configType"),children:(0,i.jsxs)(l.Stack,{gap:"xs",mt:"xs",children:[(0,i.jsx)(P.Y,{value:"service-defaults",label:"Use service defaults"}),(0,i.jsx)(P.Y,{value:"custom",label:"Custom configuration"})]})}),"custom"===m.values.configType&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.Group,{justify:"space-between",children:[(0,i.jsx)(d.Title,{order:6,children:"Environment Variables"}),(0,i.jsxs)(n.Group,{gap:"xs",children:[(0,i.jsx)(z.Z,{environmentVariables:m.values.environmentVariables,filename:"".concat(m.values.serviceName||m.values.version||"version",".env")}),(0,i.jsx)(c.Button,{size:"xs",leftSection:(0,i.jsx)(b.Z,{size:14}),variant:"light",onClick:()=>m.insertListItem("environmentVariables",{key:"",value:"",description:"",isSecret:!1}),children:"Add Variable"})]})]}),(0,i.jsx)(G.Z,{onEnvVarsExtracted:e=>{e.forEach(e=>{m.insertListItem("environmentVariables",e)})}}),m.values.environmentVariables.map((e,s)=>(0,i.jsx)(E.X,{p:"md",withBorder:!0,children:(0,i.jsxs)(l.Stack,{gap:"xs",children:[(0,i.jsxs)(n.Group,{justify:"space-between",children:[(0,i.jsxs)(d.Title,{order:6,children:["Variable ",s+1]}),(0,i.jsx)(N.A,{color:"red",variant:"light",onClick:()=>m.removeListItem("environmentVariables",s),children:(0,i.jsx)(A.Z,{size:16})})]}),(0,i.jsx)(V.TextInput,{label:"Key",placeholder:"NODE_ENV",required:!0,...m.getInputProps("environmentVariables.".concat(s,".key"))}),(0,i.jsx)(V.TextInput,{label:"Value",placeholder:"production",required:!0,...m.getInputProps("environmentVariables.".concat(s,".value"))}),(0,i.jsx)(V.TextInput,{label:"Description",placeholder:"Environment setting",...m.getInputProps("environmentVariables.".concat(s,".description"))}),(0,i.jsx)(v.X,{label:"Is Secret",...m.getInputProps("environmentVariables.".concat(s,".isSecret"),{type:"checkbox"})})]})},s)),(0,i.jsxs)(n.Group,{justify:"space-between",children:[(0,i.jsx)(d.Title,{order:6,children:"Volumes"}),(0,i.jsx)(c.Button,{size:"xs",leftSection:(0,i.jsx)(b.Z,{size:14}),variant:"light",onClick:()=>m.insertListItem("volumes",{hostPath:"",containerPath:"",description:""}),children:"Add Volume"})]}),m.values.volumes.map((e,s)=>(0,i.jsx)(E.X,{p:"md",withBorder:!0,children:(0,i.jsxs)(l.Stack,{gap:"xs",children:[(0,i.jsxs)(n.Group,{justify:"space-between",children:[(0,i.jsxs)(d.Title,{order:6,children:["Volume ",s+1]}),(0,i.jsx)(N.A,{color:"red",variant:"light",onClick:()=>m.removeListItem("volumes",s),children:(0,i.jsx)(A.Z,{size:16})})]}),(0,i.jsx)(V.TextInput,{label:"Host Path",placeholder:"$(pwd)/nginx.conf",required:!0,...m.getInputProps("volumes.".concat(s,".hostPath"))}),(0,i.jsx)(V.TextInput,{label:"Container Path",placeholder:"/etc/nginx/nginx.conf",required:!0,...m.getInputProps("volumes.".concat(s,".containerPath"))}),(0,i.jsx)(V.TextInput,{label:"Description",placeholder:"Nginx configuration",...m.getInputProps("volumes.".concat(s,".description"))})]})},s))]}),(0,i.jsxs)(n.Group,{justify:"flex-end",mt:"md",children:[(0,i.jsx)(c.Button,{variant:"default",onClick:j,children:"Cancel"}),(0,i.jsx)(c.Button,{type:"submit",loading:o,children:"Release Version"})]})]})})})}var B=r(34703),M=r(71530);function D(){let e=(0,I.useRouter)(),[s,r]=(0,S.useState)(!1),[x,h]=(0,S.useState)(null),[g,T]=(0,S.useState)(!1),{data:V}=(0,f.NG)(),{data:k,isLoading:w,error:P}=(0,y.a6)({serviceId:x||void 0,limit:50}),E=(null==V?void 0:V.data)||[],N=((null==k?void 0:k.data)||[]).filter(e=>!g||e.isStable),q=(0,I.useSearchParams)().get("id");return q?(0,i.jsx)(M.g,{id:q}):w?(0,i.jsx)(n.Group,{justify:"center",py:"xl",children:(0,i.jsx)(t.Loader,{size:"lg"})}):P?(0,i.jsx)(o.b,{icon:(0,i.jsx)(j.Z,{size:16}),title:"Error",color:"red",children:"Failed to load version releases. Please try again later."}):(0,i.jsxs)(a.Container,{fluid:!0,children:[(0,i.jsx)(B.Z,{}),(0,i.jsxs)(l.Stack,{gap:"lg",children:[(0,i.jsxs)(n.Group,{justify:"space-between",children:[(0,i.jsx)(d.Title,{order:2,children:"Version Releases"}),(0,i.jsx)(c.Button,{leftSection:(0,i.jsx)(b.Z,{size:16}),onClick:()=>r(!0),children:"Release Version"})]}),(0,i.jsxs)(n.Group,{children:[(0,i.jsx)(u.P,{placeholder:"All Services",data:[{value:"",label:"All Services"},...E.map(e=>({value:e.id,label:e.displayName||e.name}))],value:x||"",onChange:e=>h(e||null),style:{minWidth:200},clearable:!0}),(0,i.jsx)(v.X,{label:"Stable Only",checked:g,onChange:e=>T(e.currentTarget.checked)})]}),0===N.length?(0,i.jsx)(p.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:(0,i.jsx)(m.Text,{c:"dimmed",ta:"center",children:"No version releases found. Release your first version to get started."})}):(0,i.jsx)(l.Stack,{gap:"md",children:N.map(s=>(0,i.jsx)(F,{version:s,router:e},s.id))}),(0,i.jsx)(R,{opened:s,onClose:()=>r(!1)})]})]})}function F(e){let{version:s,router:r}=e,{data:t}=(0,y.Kp)({serviceId:s.serviceId,version:s.version},{skip:!s.serviceId||!s.version}),o=null==t?void 0:t.data,a=o?Math.round(o.hospitalsOnVersion/o.totalHospitals*100):0;return(0,i.jsx)(p.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:(0,i.jsxs)(l.Stack,{gap:"md",children:[(0,i.jsxs)(n.Group,{justify:"space-between",align:"flex-start",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)(n.Group,{gap:"xs",mb:"xs",children:[(0,i.jsxs)(d.Title,{order:4,children:[s.serviceName," ",s.version]}),s.isStable&&(0,i.jsx)(x.C,{color:"green",variant:"light",children:"Stable"}),s.isMandatory&&(0,i.jsx)(x.C,{color:"red",variant:"light",children:"Mandatory"}),s.allowed?(0,i.jsx)(x.C,{color:"blue",variant:"light",children:"Allowed"}):(0,i.jsx)(x.C,{color:"gray",variant:"light",children:"Not Allowed"})]}),(0,i.jsxs)(m.Text,{size:"sm",c:"dimmed",children:["Released: ",new Date(s.releasedAt).toLocaleDateString()," by ",s.releasedBy]}),(0,i.jsxs)(n.Group,{gap:"lg",mt:"xs",children:[(0,i.jsxs)(m.Text,{size:"sm",children:[(0,i.jsx)(m.Text,{component:"span",fw:500,children:"Docker:"})," ",s.dockerImage]}),s.port&&(0,i.jsxs)(m.Text,{size:"sm",children:[(0,i.jsx)(m.Text,{component:"span",fw:500,children:"Port:"})," ",s.port]}),(0,i.jsxs)(m.Text,{size:"sm",children:[(0,i.jsx)(m.Text,{component:"span",fw:500,children:"Exposed:"})," ",s.isExposed?"Yes":"No"]})]}),s.releaseNotes&&(0,i.jsxs)(m.Text,{size:"sm",mt:"xs",children:[(0,i.jsx)(m.Text,{component:"span",fw:500,children:"Release Notes:"})," ",s.releaseNotes]}),(0,i.jsx)(h.Divider,{my:"xs"}),(0,i.jsxs)(m.Text,{size:"sm",c:"dimmed",children:["Configuration:",s.useServiceEnv&&s.useServiceVolumes&&(0,i.jsx)(i.Fragment,{children:" Using service defaults for env vars & volumes"}),!s.useServiceEnv&&s.environmentVariables&&(0,i.jsxs)(i.Fragment,{children:[" Custom env vars (",s.environmentVariables.length,")"]}),!s.useServiceVolumes&&s.volumes&&(0,i.jsxs)(i.Fragment,{children:[" Custom volumes (",s.volumes.length,")"]})]})]}),(0,i.jsxs)(n.Group,{gap:"xs",children:[(0,i.jsx)(c.Button,{variant:"light",size:"xs",onClick:()=>r.push("/superadmin/version-admin/versions?id=".concat(s.id)),children:"View"}),(0,i.jsx)(c.Button,{variant:"outline",size:"xs",children:"Assign"})]})]}),o&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(m.Text,{size:"sm",fw:500,children:["Rollout: ",o.hospitalsOnVersion,"/",o.totalHospitals," hospitals (",a,"%)"]}),(0,i.jsx)(g.E,{value:a,size:"lg",radius:"xl"})]})]})})}},5966:function(e,s,r){"use strict";r.d(s,{Kp:function(){return o},Rs:function(){return t},VQ:function(){return c},a6:function(){return i},ai:function(){return l},nL:function(){return d}});let{useGetAllVersionReleasesQuery:i,useGetVersionConfigQuery:n,useReleaseVersionMutation:t,useGetRolloutStatusQuery:o,useAssignVersionToHospitalMutation:a,useGetUpdateHistoryQuery:l,useGetAllUpdateLogsQuery:d,useCheckForUpdatesQuery:c,useGetAvailableVersionsQuery:u,useGetDashboardStatsQuery:v,useLogUpdateMutation:p}=r(78101).g.injectEndpoints({endpoints:e=>({getAllVersionReleases:e.query({query:e=>({url:"/version-admin/versions/releases",method:"GET",params:e||{limit:50,offset:0}}),providesTags:["versionAdmin-versions"]}),getVersionConfig:e.query({query:e=>({url:"/version-admin/versions/".concat(e,"/config"),method:"GET"}),providesTags:(e,s,r)=>[{type:"versionAdmin-versions",id:r}]}),releaseVersion:e.mutation({query:e=>({url:"/version-admin/versions/release",method:"POST",body:e}),invalidatesTags:["versionAdmin-versions","versionAdmin-services"]}),getRolloutStatus:e.query({query:e=>{let{serviceId:s,version:r}=e;return{url:"/version-admin/versions/rollout-status/".concat(s,"/").concat(r),method:"GET"}},providesTags:(e,s,r)=>{let{serviceId:i,version:n}=r;return[{type:"versionAdmin-versions",id:"".concat(i,"-").concat(n)}]}}),assignVersionToHospital:e.mutation({query:e=>({url:"/version-admin/versions/assign-hospital",method:"POST",body:e}),invalidatesTags:["versionAdmin-versions","versionAdmin-hospitals","versionAdmin-logs"]}),getUpdateHistory:e.query({query:e=>{let{diagnosticId:s,limit:r=20,offset:i=0}=e;return{url:"/version-admin/versions/history/".concat(s),method:"GET",params:{limit:r,offset:i}}},providesTags:(e,s,r)=>{let{diagnosticId:i}=r;return[{type:"versionAdmin-logs",id:i}]}}),getAllUpdateLogs:e.query({query:e=>({url:"/version-admin/versions/logs",method:"GET",params:e||{limit:50,offset:0}}),providesTags:["versionAdmin-logs"]}),checkForUpdates:e.query({query:e=>({url:"/version-admin/versions/check",method:"GET",params:{diagnosticId:e}})}),getAvailableVersions:e.query({query:e=>({url:"/version-admin/versions/available/".concat(e),method:"GET"})}),getDashboardStats:e.query({query:()=>({url:"/version-admin/dashboard/stats",method:"GET"}),providesTags:["versionAdmin-services","versionAdmin-versions","versionAdmin-logs"]}),logUpdate:e.mutation({query:e=>({url:"/version-admin/versions/update-log",method:"POST",body:e}),invalidatesTags:["versionAdmin-logs"]})})})}},function(e){e.O(0,[1601,3069,6945,3852,1656,9722,4670,9258,9533,966,12,7538,1166,7967,6306,4927,9645,5978,1036,7686,2539,3369,9175,7402,1744],function(){return e(e.s=79873)}),_N_E=e.O()}]);